<html>
<head>
<title>Simpletest Coverage - sites/all/modules/date/date_api/date_api.module</title>
</head>
<style type="text/css">
body {
  font-family: "Gill Sans MT", "Gill Sans", GillSans, Arial, Helvetica, sans-serif;
}
h1 {
  font-size: medium;
}
#code {
  border-spacing: 0;
}
.lineNo {
  color: #ccc;
}
.code, .lineNo {
  white-space: pre;
  font-family: monospace;
}
.covered {
  color: #090;
}
.missed {
  color: #f00;
}
.dead {
  color: #00f;
}
.comment {
  color: #333;
}
</style>
<body>
<h1 id="title">Simpletest Coverage - sites/all/modules/date/date_api/date_api.module</h1>
<table id="code">
  <tbody>
    <tr>
       <td><span class="lineNo">1</span></td>
       <td><span class="comment code">&lt;?php
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">4</span></td>
       <td><span class="comment code"> * @file
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">5</span></td>
       <td><span class="comment code"> * This module will make the date API available to other modules.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">6</span></td>
       <td><span class="comment code"> * Designed to provide a light but flexible assortment of functions
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">7</span></td>
       <td><span class="comment code"> * and constants, with more functionality in additional files that
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">8</span></td>
       <td><span class="comment code"> * are not loaded unless other modules specifically include them.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">9</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">10</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">11</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">12</span></td>
       <td><span class="comment code"> * Set up some constants.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">13</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">14</span></td>
       <td><span class="comment code"> * Includes standard date types, format strings, strict regex strings for ISO
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">15</span></td>
       <td><span class="comment code"> * and DATETIME formats (seconds are optional).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">16</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">17</span></td>
       <td><span class="comment code"> * The loose regex will find any variety of ISO date and time, with or
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">18</span></td>
       <td><span class="comment code"> * without time, with or without dashes and colons separating the elements,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">19</span></td>
       <td><span class="comment code"> * and with either a 'T' or a space separating date and time.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">20</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">21</span></td>
       <td><span class="covered code">define('DATE_ISO', 'date');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">22</span></td>
       <td><span class="covered code">define('DATE_UNIX', 'datestamp');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">23</span></td>
       <td><span class="covered code">define('DATE_DATETIME', 'datetime');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">24</span></td>
       <td><span class="covered code">define('DATE_ARRAY', 'array');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">25</span></td>
       <td><span class="covered code">define('DATE_OBJECT', 'object');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">26</span></td>
       <td><span class="covered code">define('DATE_ICAL', 'ical');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">27</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">28</span></td>
       <td><span class="covered code">define('DATE_FORMAT_ISO', &quot;Y-m-d\TH:i:s&quot;);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">29</span></td>
       <td><span class="covered code">define('DATE_FORMAT_UNIX', &quot;U&quot;);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">30</span></td>
       <td><span class="covered code">define('DATE_FORMAT_DATETIME', &quot;Y-m-d H:i:s&quot;);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">31</span></td>
       <td><span class="covered code">define('DATE_FORMAT_ICAL', &quot;Ymd\THis&quot;);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">32</span></td>
       <td><span class="covered code">define('DATE_FORMAT_ICAL_DATE', &quot;Ymd&quot;);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">33</span></td>
       <td><span class="covered code">define('DATE_FORMAT_DATE', 'Y-m-d');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">34</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">35</span></td>
       <td><span class="covered code">define('DATE_REGEX_ISO', '/(\d{4})?(-(\d{2}))?(-(\d{2}))?([T\s](\d{2}))?(:(\d{2}))?(:(\d{2}))?/');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">36</span></td>
       <td><span class="covered code">define('DATE_REGEX_DATETIME', '/(\d{4})-(\d{2})-(\d{2})\s(\d{2}):(\d{2}):?(\d{2})?/');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">37</span></td>
       <td><span class="covered code">define('DATE_REGEX_LOOSE', '/(\d{4})-?(\d{1,2})-?(\d{1,2})([T\s]?(\d{2}):?(\d{2}):?(\d{2})?(\.\d+)?(Z|[\+\-]\d{2}:?\d{2})?)?/');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">38</span></td>
       <td><span class="covered code">define('DATE_REGEX_ICAL_DATE', '/(\d{4})(\d{2})(\d{2})/');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">39</span></td>
       <td><span class="covered code">define('DATE_REGEX_ICAL_DATETIME', '/(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})(Z)?/');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">40</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">41</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">42</span></td>
       <td><span class="comment code"> * Core DateTime extension module used for as many date operations as possible.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">43</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">44</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">45</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">46</span></td>
       <td><span class="comment code"> * Implements hook_help().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">47</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">48</span></td>
       <td><span class="covered code">function date_help($path, $arg) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">49</span></td>
       <td><span class="comment code">  switch ($path) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">50</span></td>
       <td><span class="missed code">    case 'admin/help#date':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">51</span></td>
       <td><span class="missed code">      $output = '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">52</span></td>
       <td><span class="missed code">      $messages = date_api_status();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">53</span></td>
       <td><span class="missed code">      $output = '&lt;h2&gt;Date API Status&lt;/h2&gt;';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">54</span></td>
       <td><span class="missed code">      if (!empty($messages['success'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">55</span></td>
       <td><span class="missed code">        $output .= '&lt;ul&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $messages['success']) . '&lt;/li&gt;&lt;/ul&gt;';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">56</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">57</span></td>
       <td><span class="missed code">      if (!empty($messages['errors'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">58</span></td>
       <td><span class="missed code">        $output .= '&lt;h3&gt;Errors&lt;/h3&gt;&lt;ul class=&quot;error&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $messages['errors']) . '&lt;/li&gt;&lt;/ul&gt;';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">59</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">60</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">61</span></td>
       <td><span class="missed code">      if (module_exists('date_tools')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">62</span></td>
       <td><span class="missed code">        $output .= '&lt;h3&gt;Date Tools&lt;/h3&gt;' . t('Dates and calendars can be complicated to set up. The !date_wizard makes it easy to create a simple date content type and with a date field.', array('!date_wizard' =&gt; l(t('Date wizard'), 'admin/config/date/tools/date_wizard')));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">63</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">64</span></td>
       <td><span class="comment code">      else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">65</span></td>
       <td><span class="missed code">        $output .= '&lt;h3&gt;Date Tools&lt;/h3&gt;' . t('Dates and calendars can be complicated to set up. If you enable the Date Tools module, it provides a Date Wizard that makes it easy to create a simple date content type with a date field.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">66</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">67</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">68</span></td>
       <td><span class="missed code">      $output .= '&lt;h2&gt;More Information&lt;/h2&gt;&lt;p&gt;' . t('Complete documentation for the Date and Date API modules is available at &lt;a href=&quot;@link&quot;&gt;http://drupal.org/node/92460&lt;/a&gt;.', array('@link' =&gt; 'http://drupal.org/node/262062')) . '&lt;/p&gt;';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">69</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">70</span></td>
       <td><span class="missed code">      return $output;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">71</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">72</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">73</span></td>
       <td><span class="missed code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">74</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">75</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">76</span></td>
       <td><span class="comment code"> * Helper function to retun the status of required date variables.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">77</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">78</span></td>
       <td><span class="covered code">function date_api_status() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">79</span></td>
       <td><span class="missed code">  $t = get_t();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">80</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">81</span></td>
       <td><span class="missed code">  $error_messages = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">82</span></td>
       <td><span class="missed code">  $success_messages = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">83</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">84</span></td>
       <td><span class="missed code">  $value = variable_get('date_default_timezone');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">85</span></td>
       <td><span class="missed code">  if (isset($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">86</span></td>
       <td><span class="missed code">    $success_messages[] = $t('The timezone has been set to &lt;a href=&quot;@regional_settings&quot;&gt;@timezone&lt;/a&gt;.', array('@regional_settings' =&gt; url('admin/config/regional/settings'), '@timezone' =&gt; $value));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">87</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">88</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">89</span></td>
       <td><span class="missed code">    $error_messages[] = $t('The Date API requires that you set up the &lt;a href=&quot;@regional_settings&quot;&gt;site timezone&lt;/a&gt; to function correctly.', array('@regional_settings' =&gt; url('admin/config/regional/settings')));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">90</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">91</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">92</span></td>
       <td><span class="missed code">  $value = variable_get('date_first_day');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">93</span></td>
       <td><span class="missed code">  if (isset($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">94</span></td>
       <td><span class="missed code">    $days = date_week_days();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">95</span></td>
       <td><span class="missed code">    $success_messages[] = $t('The first day of the week has been set to &lt;a href=&quot;@regional_settings&quot;&gt;@day&lt;/a&gt;.', array('@regional_settings' =&gt; url('admin/config/regional/settings'), '@day' =&gt; $days[$value]));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">96</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">97</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">98</span></td>
       <td><span class="missed code">    $error_messages[] = $t('The Date API requires that you set up the &lt;a href=&quot;@regional_settings&quot;&gt;site first day of week settings&lt;/a&gt; to function correctly.', array('@regional_settings' =&gt; url('admin/config/regional/settings')));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">99</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">100</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">101</span></td>
       <td><span class="missed code">  $value = variable_get('date_format_medium');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">102</span></td>
       <td><span class="missed code">  if (isset($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">103</span></td>
       <td><span class="missed code">    $now = date_now();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">104</span></td>
       <td><span class="missed code">    $success_messages[] = $t('The medium date format type has been set to @value. You may find it helpful to add new format types like Date, Time, Month, or Year, with appropriate formats, at &lt;a href=&quot;@regional_date_time&quot;&gt;Date and time&lt;/a&gt; settings.', array('@value' =&gt; $now-&gt;format($value), '@regional_date_time' =&gt; url('admin/config/regional/date-time')));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">105</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">106</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">107</span></td>
       <td><span class="missed code">    $error_messages[] = $t('The Date API requires that you set up the &lt;a href=&quot;@regional_date_time&quot;&gt;system date formats&lt;/a&gt; to function correctly.', array('@regional_date_time' =&gt; url('admin/config/regional/date-time')));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">108</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">109</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">110</span></td>
       <td><span class="missed code">  return array('errors', $error_messages, 'success' =&gt; $success_messages);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">111</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">112</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">113</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">114</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">115</span></td>
       <td><span class="comment code"> * Implements hook_menu().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">116</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">117</span></td>
       <td><span class="comment code"> * Creates a 'Date API' section on the administration page for Date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">118</span></td>
       <td><span class="comment code"> * modules to use for their configuration and settings.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">119</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">120</span></td>
       <td><span class="covered code">function date_api_menu() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">121</span></td>
       <td><span class="covered code">  $items['admin/config/date'] = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">122</span></td>
       <td><span class="covered code">    'title' =&gt; 'Date API',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">123</span></td>
       <td><span class="covered code">    'description' =&gt; 'Settings for modules the use the Date API.',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">124</span></td>
       <td><span class="covered code">    'position' =&gt; 'left',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">125</span></td>
       <td><span class="covered code">    'weight' =&gt; -10,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">126</span></td>
       <td><span class="covered code">    'page callback' =&gt; 'system_admin_menu_block_page',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">127</span></td>
       <td><span class="covered code">    'access arguments' =&gt; array('administer site configuration'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">128</span></td>
       <td><span class="covered code">    'file' =&gt; 'system.admin.inc',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">129</span></td>
       <td><span class="covered code">    'file path' =&gt; drupal_get_path('module', 'system'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">130</span></td>
       <td><span class="comment code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">131</span></td>
       <td><span class="covered code">  return $items;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">132</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">133</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">134</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">135</span></td>
       <td><span class="comment code"> * Extend PHP DateTime class with granularity handling, merge functionality and
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">136</span></td>
       <td><span class="comment code"> * slightly more flexible initialization parameters.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">137</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">138</span></td>
       <td><span class="comment code"> * This class is a Drupal independent extension of the &gt;= PHP 5.2 DateTime
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">139</span></td>
       <td><span class="comment code"> * class.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">140</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">141</span></td>
       <td><span class="comment code"> * @see FeedsDateTimeElement class
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">142</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">143</span></td>
       <td><span class="covered code">class DateObject extends DateTime {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">144</span></td>
       <td><span class="comment code">  public $granularity = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">145</span></td>
       <td><span class="comment code">  public $errors = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">146</span></td>
       <td><span class="comment code">  protected static $allgranularity = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">147</span></td>
       <td><span class="comment code">    'year',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">148</span></td>
       <td><span class="comment code">    'month',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">149</span></td>
       <td><span class="comment code">    'day',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">150</span></td>
       <td><span class="comment code">    'hour',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">151</span></td>
       <td><span class="comment code">    'minute',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">152</span></td>
       <td><span class="comment code">    'second',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">153</span></td>
       <td><span class="comment code">    'timezone'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">154</span></td>
       <td><span class="comment code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">155</span></td>
       <td><span class="comment code">  private $serializedTime;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">156</span></td>
       <td><span class="comment code">  private $serializedTimezone;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">157</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">158</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">159</span></td>
       <td><span class="comment code">   * Prepares the object during serialization.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">160</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">161</span></td>
       <td><span class="comment code">   * We are extending a core class and core classes cannot be serialized.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">162</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">163</span></td>
       <td><span class="comment code">   * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">164</span></td>
       <td><span class="comment code">   *   Returns an array with the names of the variables that were serialized.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">165</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">166</span></td>
       <td><span class="comment code">   * @see http://bugs.php.net/41334
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">167</span></td>
       <td><span class="comment code">   * @see http://bugs.php.net/39821
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">168</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">169</span></td>
       <td><span class="comment code">  public function __sleep() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">170</span></td>
       <td><span class="missed code">    $this-&gt;serializedTime = $this-&gt;format('c');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">171</span></td>
       <td><span class="missed code">    $this-&gt;serializedTimezone = $this-&gt;getTimezone()-&gt;getName();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">172</span></td>
       <td><span class="missed code">    return array('serializedTime', 'serializedTimezone');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">173</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">174</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">175</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">176</span></td>
       <td><span class="comment code">   * Re-builds the object using local variables.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">177</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">178</span></td>
       <td><span class="comment code">  public function __wakeup() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">179</span></td>
       <td><span class="missed code">    $this-&gt;__construct($this-&gt;serializedTime, new DateTimeZone($this-&gt;serializedTimezone));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">180</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">181</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">182</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">183</span></td>
       <td><span class="comment code">   * Returns the date object as a string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">184</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">185</span></td>
       <td><span class="comment code">   * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">186</span></td>
       <td><span class="comment code">   *   The date object formatted as a string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">187</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">188</span></td>
       <td><span class="comment code">  public function __toString() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">189</span></td>
       <td><span class="missed code">    return $this-&gt;format(DATE_FORMAT_DATETIME) . ' ' . $this-&gt;getTimeZone()-&gt;getName();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">190</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">191</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">192</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">193</span></td>
       <td><span class="comment code">   * Constructs a date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">194</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">195</span></td>
       <td><span class="comment code">   * @param string $time
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">196</span></td>
       <td><span class="comment code">   *   A date/time string or array. Defaults to 'now'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">197</span></td>
       <td><span class="comment code">   * @param object|string|null $tz
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">198</span></td>
       <td><span class="comment code">   *   PHP DateTimeZone object, string or NULL allowed. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">199</span></td>
       <td><span class="comment code">   * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">200</span></td>
       <td><span class="comment code">   *   PHP date() type format for parsing. Doesn't support timezones; if you
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">201</span></td>
       <td><span class="comment code">   *   have a timezone, send NULL and the default constructor method will
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">202</span></td>
       <td><span class="comment code">   *   hopefully parse it. $format is recommended in order to use negative or
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">203</span></td>
       <td><span class="comment code">   *   large years, which php's parser fails on.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">204</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">205</span></td>
       <td><span class="comment code">  public function __construct($time = 'now', $tz = NULL, $format = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">206</span></td>
       <td><span class="missed code">    $this-&gt;timeOnly = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">207</span></td>
       <td><span class="missed code">    $this-&gt;dateOnly = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">208</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">209</span></td>
       <td><span class="comment code">    // Store the raw time input so it is available for validation.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">210</span></td>
       <td><span class="missed code">    $this-&gt;originalTime = $time;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">211</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">212</span></td>
       <td><span class="comment code">    // Allow string timezones.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">213</span></td>
       <td><span class="missed code">    if (!empty($tz) &amp;&amp; !is_object($tz)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">214</span></td>
       <td><span class="missed code">      $tz = new DateTimeZone($tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">215</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">216</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">217</span></td>
       <td><span class="comment code">    // Default to the site timezone when not explicitly provided.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">218</span></td>
       <td><span class="missed code">    elseif (empty($tz)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">219</span></td>
       <td><span class="missed code">      $tz = date_default_timezone_object();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">220</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">221</span></td>
       <td><span class="comment code">    // Special handling for Unix timestamps expressed in the local timezone.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">222</span></td>
       <td><span class="comment code">    // Create a date object in UTC and convert it to the local timezone. Don't
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">223</span></td>
       <td><span class="comment code">    // try to turn things like '2010' with a format of 'Y' into a timestamp.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">224</span></td>
       <td><span class="missed code">    if (is_numeric($time) &amp;&amp; (empty($format) || $format == 'U')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">225</span></td>
       <td><span class="comment code">      // Assume timestamp.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">226</span></td>
       <td><span class="missed code">      $time = &quot;@&quot; . $time;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">227</span></td>
       <td><span class="missed code">      $date = new DateObject($time, 'UTC');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">228</span></td>
       <td><span class="missed code">      if ($tz-&gt;getName() != 'UTC') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">229</span></td>
       <td><span class="missed code">        $date-&gt;setTimezone($tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">230</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">231</span></td>
       <td><span class="missed code">      $time = $date-&gt;format(DATE_FORMAT_DATETIME);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">232</span></td>
       <td><span class="missed code">      $format = DATE_FORMAT_DATETIME;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">233</span></td>
       <td><span class="missed code">      $this-&gt;addGranularity('timezone');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">234</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">235</span></td>
       <td><span class="missed code">    elseif (is_array($time)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">236</span></td>
       <td><span class="comment code">      // Assume we were passed an indexed array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">237</span></td>
       <td><span class="missed code">      if (empty($time['year']) &amp;&amp; empty($time['month']) &amp;&amp; empty($time['day'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">238</span></td>
       <td><span class="missed code">        $this-&gt;timeOnly = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">239</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">240</span></td>
       <td><span class="missed code">      if (empty($time['hour']) &amp;&amp; empty($time['minute']) &amp;&amp; empty($time['second'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">241</span></td>
       <td><span class="missed code">        $this-&gt;dateOnly = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">242</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">243</span></td>
       <td><span class="missed code">      $this-&gt;errors = $this-&gt;arrayErrors($time);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">244</span></td>
       <td><span class="comment code">      // Make this into an ISO date, forcing a full ISO date even if some values
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">245</span></td>
       <td><span class="comment code">      // are missing.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">246</span></td>
       <td><span class="missed code">      $time = $this-&gt;toISO($time, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">247</span></td>
       <td><span class="comment code">      // We checked for errors already, skip parsing the input values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">248</span></td>
       <td><span class="missed code">      $format = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">249</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">250</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">251</span></td>
       <td><span class="comment code">      // Make sure dates like 2010-00-00T00:00:00 get converted to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">252</span></td>
       <td><span class="comment code">      // 2010-01-01T00:00:00 before creating a date object
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">253</span></td>
       <td><span class="comment code">      // to avoid unintended changes in the month or day.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">254</span></td>
       <td><span class="missed code">      $time = date_make_iso_valid($time);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">255</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">256</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">257</span></td>
       <td><span class="comment code">    // The parse function will also set errors on the date parts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">258</span></td>
       <td><span class="missed code">    if (!empty($format)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">259</span></td>
       <td><span class="missed code">      $arg = self::$allgranularity;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">260</span></td>
       <td><span class="missed code">      $element = array_pop($arg);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">261</span></td>
       <td><span class="missed code">      while (!$this-&gt;parse($time, $tz, $format) &amp;&amp; $element != 'year') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">262</span></td>
       <td><span class="missed code">        $element = array_pop($arg);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">263</span></td>
       <td><span class="missed code">        $format = date_limit_format($format, $arg);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">264</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">265</span></td>
       <td><span class="missed code">      if ($element == 'year') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">266</span></td>
       <td><span class="missed code">        return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">267</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">268</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">269</span></td>
       <td><span class="missed code">    elseif (is_string($time)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">270</span></td>
       <td><span class="comment code">      // PHP &lt; 5.3 doesn't like the GMT- notation for parsing timezones.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">271</span></td>
       <td><span class="missed code">      $time = str_replace(&quot;GMT-&quot;, &quot;-&quot;, $time);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">272</span></td>
       <td><span class="missed code">      $time = str_replace(&quot;GMT+&quot;, &quot;+&quot;, $time);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">273</span></td>
       <td><span class="comment code">      // We are going to let the parent dateObject do a best effort attempt to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">274</span></td>
       <td><span class="comment code">      // turn this string into a valid date. It might fail and we want to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">275</span></td>
       <td><span class="comment code">      // control the error messages.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">276</span></td>
       <td><span class="comment code">      try {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">277</span></td>
       <td><span class="missed code">        @parent::__construct($time, $tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">278</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">279</span></td>
       <td><span class="missed code">      catch (Exception $e) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">280</span></td>
       <td><span class="missed code">        $this-&gt;errors['date'] = $e;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">281</span></td>
       <td><span class="missed code">        return;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">282</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">283</span></td>
       <td><span class="missed code">      if (empty($this-&gt;granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">284</span></td>
       <td><span class="missed code">        $this-&gt;setGranularityFromTime($time, $tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">285</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">286</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">287</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">288</span></td>
       <td><span class="comment code">    // If we haven't got a valid timezone name yet, we need to set one or
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">289</span></td>
       <td><span class="comment code">    // we will get undefined index errors.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">290</span></td>
       <td><span class="comment code">    // This can happen if $time had an offset or no timezone.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">291</span></td>
       <td><span class="missed code">    if (!$this-&gt;getTimezone() || !preg_match('/[a-zA-Z]/', $this-&gt;getTimezone()-&gt;getName())) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">292</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">293</span></td>
       <td><span class="comment code">      // If the original $tz has a name, use it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">294</span></td>
       <td><span class="missed code">      if (preg_match('/[a-zA-Z]/', $tz-&gt;getName())) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">295</span></td>
       <td><span class="missed code">        $this-&gt;setTimezone($tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">296</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">297</span></td>
       <td><span class="comment code">      // We have no information about the timezone so must fallback to a default.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">298</span></td>
       <td><span class="comment code">      else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">299</span></td>
       <td><span class="missed code">        $this-&gt;setTimezone(new DateTimeZone(&quot;UTC&quot;));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">300</span></td>
       <td><span class="missed code">        $this-&gt;errors['timezone'] = t('No valid timezone name was provided.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">301</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">302</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">303</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">304</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">305</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">306</span></td>
       <td><span class="comment code">   * Merges two date objects together using the current date values as defaults.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">307</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">308</span></td>
       <td><span class="comment code">   * @param object $other
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">309</span></td>
       <td><span class="comment code">   *   Another date object to merge with.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">310</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">311</span></td>
       <td><span class="comment code">   * @return object
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">312</span></td>
       <td><span class="comment code">   *   A merged date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">313</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">314</span></td>
       <td><span class="comment code">  public function merge(FeedsDateTime $other) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">315</span></td>
       <td><span class="missed code">    $other_tz = $other-&gt;getTimezone();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">316</span></td>
       <td><span class="missed code">    $this_tz = $this-&gt;getTimezone();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">317</span></td>
       <td><span class="comment code">    // Figure out which timezone to use for combination.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">318</span></td>
       <td><span class="missed code">    $use_tz = ($this-&gt;hasGranularity('timezone') || !$other-&gt;hasGranularity('timezone')) ? $this_tz : $other_tz;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">319</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">320</span></td>
       <td><span class="missed code">    $this2 = clone $this;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">321</span></td>
       <td><span class="missed code">    $this2-&gt;setTimezone($use_tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">322</span></td>
       <td><span class="missed code">    $other-&gt;setTimezone($use_tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">323</span></td>
       <td><span class="missed code">    $val = $this2-&gt;toArray(TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">324</span></td>
       <td><span class="missed code">    $otherval = $other-&gt;toArray();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">325</span></td>
       <td><span class="missed code">    foreach (self::$allgranularity as $g) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">326</span></td>
       <td><span class="missed code">      if ($other-&gt;hasGranularity($g) &amp;&amp; !$this2-&gt;hasGranularity($g)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">327</span></td>
       <td><span class="comment code">        // The other class has a property we don't; steal it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">328</span></td>
       <td><span class="missed code">        $this2-&gt;addGranularity($g);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">329</span></td>
       <td><span class="missed code">        $val[$g] = $otherval[$g];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">330</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">331</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">332</span></td>
       <td><span class="missed code">    $other-&gt;setTimezone($other_tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">333</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">334</span></td>
       <td><span class="missed code">    $this2-&gt;setDate($val['year'], $val['month'], $val['day']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">335</span></td>
       <td><span class="missed code">    $this2-&gt;setTime($val['hour'], $val['minute'], $val['second']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">336</span></td>
       <td><span class="missed code">    return $this2;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">337</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">338</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">339</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">340</span></td>
       <td><span class="comment code">   * Sets the time zone for the current date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">341</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">342</span></td>
       <td><span class="comment code">   * Overrides default DateTime function. Only changes output values if
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">343</span></td>
       <td><span class="comment code">   * actually had time granularity. This should be used as a &quot;converter&quot; for
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">344</span></td>
       <td><span class="comment code">   * output, to switch tzs.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">345</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">346</span></td>
       <td><span class="comment code">   * In order to set a timezone for a datetime that doesn't have such
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">347</span></td>
       <td><span class="comment code">   * granularity, merge() it with one that does.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">348</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">349</span></td>
       <td><span class="comment code">   * @param object $tz
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">350</span></td>
       <td><span class="comment code">   *   A timezone object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">351</span></td>
       <td><span class="comment code">   * @param bool $force
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">352</span></td>
       <td><span class="comment code">   *   Whether or not to skip a date with no time. Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">353</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">354</span></td>
       <td><span class="comment code">  public function setTimezone($tz, $force = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">355</span></td>
       <td><span class="comment code">    // PHP 5.2.6 has a fatal error when setting a date's timezone to itself.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">356</span></td>
       <td><span class="comment code">    // http://bugs.php.net/bug.php?id=45038
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">357</span></td>
       <td><span class="missed code">    if (version_compare(PHP_VERSION, '5.2.7', '&lt;') &amp;&amp; $tz == $this-&gt;getTimezone()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">358</span></td>
       <td><span class="missed code">      $tz = new DateTimeZone($tz-&gt;getName());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">359</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">360</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">361</span></td>
       <td><span class="missed code">    if (!$this-&gt;hasTime() || !$this-&gt;hasGranularity('timezone') || $force) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">362</span></td>
       <td><span class="comment code">      // This has no time or timezone granularity, so timezone doesn't mean
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">363</span></td>
       <td><span class="comment code">      // much. We set the timezone using the method, which will change the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">364</span></td>
       <td><span class="comment code">      // day/hour, but then we switch back.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">365</span></td>
       <td><span class="missed code">      $arr = $this-&gt;toArray(TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">366</span></td>
       <td><span class="missed code">      parent::setTimezone($tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">367</span></td>
       <td><span class="missed code">      $this-&gt;setDate($arr['year'], $arr['month'], $arr['day']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">368</span></td>
       <td><span class="missed code">      $this-&gt;setTime($arr['hour'], $arr['minute'], $arr['second']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">369</span></td>
       <td><span class="missed code">      $this-&gt;addGranularity('timezone');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">370</span></td>
       <td><span class="missed code">      return;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">371</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">372</span></td>
       <td><span class="missed code">    return parent::setTimezone($tz);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">373</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">374</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">375</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">376</span></td>
       <td><span class="comment code">   * Returns date formatted according to given format.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">377</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">378</span></td>
       <td><span class="comment code">   * Overrides base format function, formats this date according to its
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">379</span></td>
       <td><span class="comment code">   * available granularity, unless $force'ed not to limit to granularity.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">380</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">381</span></td>
       <td><span class="comment code">   * @TODO Add translation into this so translated names will be provided.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">382</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">383</span></td>
       <td><span class="comment code">   * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">384</span></td>
       <td><span class="comment code">   *   A date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">385</span></td>
       <td><span class="comment code">   * @param bool $force
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">386</span></td>
       <td><span class="comment code">   *   Whether or not to limit the granularity. Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">387</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">388</span></td>
       <td><span class="comment code">   * @return string|false
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">389</span></td>
       <td><span class="comment code">   *   Returns the formatted date string on success or FALSE on failure.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">390</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">391</span></td>
       <td><span class="comment code">  public function format($format, $force = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">392</span></td>
       <td><span class="missed code">    return parent::format($force ? $format : date_limit_format($format, $this-&gt;granularity));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">393</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">394</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">395</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">396</span></td>
       <td><span class="comment code">   * Adds a granularity entry to the array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">397</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">398</span></td>
       <td><span class="comment code">   * @param string $g
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">399</span></td>
       <td><span class="comment code">   *   A single date part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">400</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">401</span></td>
       <td><span class="comment code">  public function addGranularity($g) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">402</span></td>
       <td><span class="missed code">    $this-&gt;granularity[] = $g;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">403</span></td>
       <td><span class="missed code">    $this-&gt;granularity = array_unique($this-&gt;granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">404</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">405</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">406</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">407</span></td>
       <td><span class="comment code">   * Removes a granularity entry from the array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">408</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">409</span></td>
       <td><span class="comment code">   * @param string $g
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">410</span></td>
       <td><span class="comment code">   *   A single date part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">411</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">412</span></td>
       <td><span class="comment code">  public function removeGranularity($g) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">413</span></td>
       <td><span class="missed code">    if (($key = array_search($g, $this-&gt;granularity)) !== FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">414</span></td>
       <td><span class="missed code">      unset($this-&gt;granularity[$key]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">415</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">416</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">417</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">418</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">419</span></td>
       <td><span class="comment code">   * Checks granularity array for a given entry.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">420</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">421</span></td>
       <td><span class="comment code">   * @param array|null $g
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">422</span></td>
       <td><span class="comment code">   *   An array of date parts. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">423</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">424</span></td>
       <td><span class="comment code">   * @returns bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">425</span></td>
       <td><span class="comment code">   *   TRUE if the date part is present in the date's granularity.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">426</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">427</span></td>
       <td><span class="comment code">  public function hasGranularity($g = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">428</span></td>
       <td><span class="missed code">    if ($g === NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">429</span></td>
       <td><span class="comment code">      // Just want to know if it has something valid means no lower
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">430</span></td>
       <td><span class="comment code">      // granularities without higher ones.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">431</span></td>
       <td><span class="missed code">      $last = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">432</span></td>
       <td><span class="missed code">      foreach (self::$allgranularity as $arg) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">433</span></td>
       <td><span class="missed code">        if ($arg == 'timezone') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">434</span></td>
       <td><span class="missed code">          continue;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">435</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">436</span></td>
       <td><span class="missed code">        if (in_array($arg, $this-&gt;granularity) &amp;&amp; !$last) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">437</span></td>
       <td><span class="missed code">          return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">438</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">439</span></td>
       <td><span class="missed code">        $last = in_array($arg, $this-&gt;granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">440</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">441</span></td>
       <td><span class="missed code">      return in_array('year', $this-&gt;granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">442</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">443</span></td>
       <td><span class="missed code">    if (is_array($g)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">444</span></td>
       <td><span class="missed code">      foreach ($g as $gran) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">445</span></td>
       <td><span class="missed code">        if (!in_array($gran, $this-&gt;granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">446</span></td>
       <td><span class="missed code">          return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">447</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">448</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">449</span></td>
       <td><span class="missed code">      return TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">450</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">451</span></td>
       <td><span class="missed code">    return in_array($g, $this-&gt;granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">452</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">453</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">454</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">455</span></td>
       <td><span class="comment code">   * Determines if a a date is valid for a given granularity.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">456</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">457</span></td>
       <td><span class="comment code">   * @param array|null $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">458</span></td>
       <td><span class="comment code">   *   An array of date parts. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">459</span></td>
       <td><span class="comment code">   * @param bool $flexible
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">460</span></td>
       <td><span class="comment code">   *   TRUE if the granuliarty is flexible, FALSE otherwise. Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">461</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">462</span></td>
       <td><span class="comment code">   * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">463</span></td>
       <td><span class="comment code">   *   Whether a date is valid for a given granularity.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">464</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">465</span></td>
       <td><span class="comment code">  public function validGranularity($granularity = NULL, $flexible = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">466</span></td>
       <td><span class="missed code">    $true = $this-&gt;hasGranularity() &amp;&amp; (!$granularity || $flexible || $this-&gt;hasGranularity($granularity));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">467</span></td>
       <td><span class="missed code">    if (!$true &amp;&amp; $granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">468</span></td>
       <td><span class="missed code">      foreach ((array) $granularity as $part) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">469</span></td>
       <td><span class="missed code">        if (!$this-&gt;hasGranularity($part) &amp;&amp; in_array($part, array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">470</span></td>
       <td><span class="missed code">          'second',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">471</span></td>
       <td><span class="missed code">          'minute',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">472</span></td>
       <td><span class="missed code">          'hour',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">473</span></td>
       <td><span class="missed code">          'day',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">474</span></td>
       <td><span class="missed code">          'month',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">475</span></td>
       <td><span class="missed code">          'year')
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">476</span></td>
       <td><span class="missed code">        )) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">477</span></td>
       <td><span class="comment code">          switch ($part) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">478</span></td>
       <td><span class="missed code">            case 'second':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">479</span></td>
       <td><span class="missed code">              $this-&gt;errors[$part] = t('The second is missing.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">480</span></td>
       <td><span class="missed code">              break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">481</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">482</span></td>
       <td><span class="missed code">            case 'minute':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">483</span></td>
       <td><span class="missed code">              $this-&gt;errors[$part] = t('The minute is missing.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">484</span></td>
       <td><span class="missed code">              break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">485</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">486</span></td>
       <td><span class="missed code">            case 'hour':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">487</span></td>
       <td><span class="missed code">              $this-&gt;errors[$part] = t('The hour is missing.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">488</span></td>
       <td><span class="missed code">              break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">489</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">490</span></td>
       <td><span class="missed code">            case 'day':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">491</span></td>
       <td><span class="missed code">              $this-&gt;errors[$part] = t('The day is missing.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">492</span></td>
       <td><span class="missed code">              break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">493</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">494</span></td>
       <td><span class="missed code">            case 'month':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">495</span></td>
       <td><span class="missed code">              $this-&gt;errors[$part] = t('The month is missing.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">496</span></td>
       <td><span class="missed code">              break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">497</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">498</span></td>
       <td><span class="missed code">            case 'year':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">499</span></td>
       <td><span class="missed code">              $this-&gt;errors[$part] = t('The year is missing.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">500</span></td>
       <td><span class="missed code">              break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">501</span></td>
       <td><span class="dead code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">502</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">503</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">504</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">505</span></td>
       <td><span class="missed code">    return $true;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">506</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">507</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">508</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">509</span></td>
       <td><span class="comment code">   * Returns whether this object has time set.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">510</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">511</span></td>
       <td><span class="comment code">   * Used primarily for timezone conversion and formatting.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">512</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">513</span></td>
       <td><span class="comment code">   * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">514</span></td>
       <td><span class="comment code">   *   TRUE if the date contains time parts, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">515</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">516</span></td>
       <td><span class="comment code">  public function hasTime() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">517</span></td>
       <td><span class="missed code">    return $this-&gt;hasGranularity('hour');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">518</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">519</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">520</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">521</span></td>
       <td><span class="comment code">   * Returns whether the input values included a year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">522</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">523</span></td>
       <td><span class="comment code">   * Useful to use pseudo date objects when we only are interested in the time.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">524</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">525</span></td>
       <td><span class="comment code">   * @todo $this-&gt;completeDate does not actually exist?
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">526</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">527</span></td>
       <td><span class="comment code">  public function completeDate() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">528</span></td>
       <td><span class="missed code">    return $this-&gt;completeDate;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">529</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">530</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">531</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">532</span></td>
       <td><span class="comment code">   * Removes unwanted date parts from a date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">533</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">534</span></td>
       <td><span class="comment code">   * In common usage we should not unset timezone through this.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">535</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">536</span></td>
       <td><span class="comment code">   * @param array $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">537</span></td>
       <td><span class="comment code">   *   An array of date parts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">538</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">539</span></td>
       <td><span class="comment code">  public function limitGranularity($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">540</span></td>
       <td><span class="missed code">    foreach ($this-&gt;granularity as $key =&gt; $val) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">541</span></td>
       <td><span class="missed code">      if ($val != 'timezone' &amp;&amp; !in_array($val, $granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">542</span></td>
       <td><span class="missed code">        unset($this-&gt;granularity[$key]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">543</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">544</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">545</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">546</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">547</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">548</span></td>
       <td><span class="comment code">   * Determines the granularity of a date based on the constructor's arguments.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">549</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">550</span></td>
       <td><span class="comment code">   * @param string $time
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">551</span></td>
       <td><span class="comment code">   *   A date string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">552</span></td>
       <td><span class="comment code">   * @param bool $tz
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">553</span></td>
       <td><span class="comment code">   *   TRUE if the date has a timezone, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">554</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">555</span></td>
       <td><span class="comment code">  protected function setGranularityFromTime($time, $tz) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">556</span></td>
       <td><span class="missed code">    $this-&gt;granularity = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">557</span></td>
       <td><span class="missed code">    $temp = date_parse($time);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">558</span></td>
       <td><span class="comment code">    // Special case for 'now'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">559</span></td>
       <td><span class="missed code">    if ($time == 'now') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">560</span></td>
       <td><span class="missed code">      $this-&gt;granularity = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">561</span></td>
       <td><span class="missed code">        'year',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">562</span></td>
       <td><span class="missed code">        'month',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">563</span></td>
       <td><span class="missed code">        'day',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">564</span></td>
       <td><span class="missed code">        'hour',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">565</span></td>
       <td><span class="missed code">        'minute',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">566</span></td>
       <td><span class="missed code">        'second',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">567</span></td>
       <td><span class="comment code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">568</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">569</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">570</span></td>
       <td><span class="comment code">      // This PHP date_parse() method currently doesn't have resolution down to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">571</span></td>
       <td><span class="comment code">      // seconds, so if there is some time, all will be set.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">572</span></td>
       <td><span class="missed code">      foreach (self::$allgranularity as $g) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">573</span></td>
       <td><span class="missed code">        if ((isset($temp[$g]) &amp;&amp; is_numeric($temp[$g])) || ($g == 'timezone' &amp;&amp; (isset($temp['zone_type']) &amp;&amp; $temp['zone_type'] &gt; 0))) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">574</span></td>
       <td><span class="missed code">          $this-&gt;granularity[] = $g;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">575</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">576</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">577</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">578</span></td>
       <td><span class="missed code">    if ($tz) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">579</span></td>
       <td><span class="missed code">      $this-&gt;addGranularity('timezone');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">580</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">581</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">582</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">583</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">584</span></td>
       <td><span class="comment code">   * Converts a date string into a date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">585</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">586</span></td>
       <td><span class="comment code">   * @param string $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">587</span></td>
       <td><span class="comment code">   *   The date string to parse.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">588</span></td>
       <td><span class="comment code">   * @param object $tz
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">589</span></td>
       <td><span class="comment code">   *   A timezone object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">590</span></td>
       <td><span class="comment code">   * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">591</span></td>
       <td><span class="comment code">   *   The date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">592</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">593</span></td>
       <td><span class="comment code">   * @return object
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">594</span></td>
       <td><span class="comment code">   *   Returns the date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">595</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">596</span></td>
       <td><span class="comment code">  protected function parse($date, $tz, $format) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">597</span></td>
       <td><span class="missed code">    $array = date_format_patterns();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">598</span></td>
       <td><span class="missed code">    foreach ($array as $key =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">599</span></td>
       <td><span class="comment code">      // The letter with no preceding '\'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">600</span></td>
       <td><span class="missed code">      $patterns[] = &quot;`(^|[^\\\\\\\\])&quot; . $key . &quot;`&quot;;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">601</span></td>
       <td><span class="comment code">      // A single character.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">602</span></td>
       <td><span class="missed code">      $repl1[] = '${1}(.)';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">603</span></td>
       <td><span class="comment code">      // The.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">604</span></td>
       <td><span class="missed code">      $repl2[] = '${1}(' . $value . ')';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">605</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">606</span></td>
       <td><span class="missed code">    $patterns[] = &quot;`\\\\\\\\([&quot; . implode(array_keys($array)) . &quot;])`&quot;;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">607</span></td>
       <td><span class="missed code">    $repl1[] = '${1}';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">608</span></td>
       <td><span class="missed code">    $repl2[] = '${1}';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">609</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">610</span></td>
       <td><span class="missed code">    $format_regexp = preg_quote($format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">611</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">612</span></td>
       <td><span class="comment code">    // Extract letters.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">613</span></td>
       <td><span class="missed code">    $regex1 = preg_replace($patterns, $repl1, $format_regexp, 1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">614</span></td>
       <td><span class="missed code">    $regex1 = str_replace('A', '(.)', $regex1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">615</span></td>
       <td><span class="missed code">    $regex1 = str_replace('a', '(.)', $regex1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">616</span></td>
       <td><span class="missed code">    preg_match('`^' . $regex1 . '$`', stripslashes($format), $letters);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">617</span></td>
       <td><span class="missed code">    array_shift($letters);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">618</span></td>
       <td><span class="comment code">    // Extract values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">619</span></td>
       <td><span class="missed code">    $regex2 = preg_replace($patterns, $repl2, $format_regexp, 1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">620</span></td>
       <td><span class="missed code">    $regex2 = str_replace('A', '(AM|PM)', $regex2);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">621</span></td>
       <td><span class="missed code">    $regex2 = str_replace('a', '(am|pm)', $regex2);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">622</span></td>
       <td><span class="missed code">    preg_match('`^' . $regex2 . '$`u', $date, $values);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">623</span></td>
       <td><span class="missed code">    array_shift($values);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">624</span></td>
       <td><span class="comment code">    // If we did not find all the values for the patterns in the format, abort.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">625</span></td>
       <td><span class="missed code">    if (count($letters) != count($values)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">626</span></td>
       <td><span class="missed code">      $this-&gt;errors['invalid'] = t('The value @date does not match the expected format.', array('@date' =&gt; $date));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">627</span></td>
       <td><span class="missed code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">628</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">629</span></td>
       <td><span class="missed code">    $this-&gt;granularity = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">630</span></td>
       <td><span class="comment code">    $final_date = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">631</span></td>
       <td><span class="missed code">      'hour' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">632</span></td>
       <td><span class="missed code">      'minute' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">633</span></td>
       <td><span class="missed code">      'second' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">634</span></td>
       <td><span class="missed code">      'month' =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">635</span></td>
       <td><span class="missed code">      'day' =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">636</span></td>
       <td><span class="missed code">      'year' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">637</span></td>
       <td><span class="missed code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">638</span></td>
       <td><span class="missed code">    foreach ($letters as $i =&gt; $letter) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">639</span></td>
       <td><span class="missed code">      $value = $values[$i];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">640</span></td>
       <td><span class="comment code">      switch ($letter) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">641</span></td>
       <td><span class="missed code">        case 'd':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">642</span></td>
       <td><span class="missed code">        case 'j':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">643</span></td>
       <td><span class="missed code">          $final_date['day'] = intval($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">644</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('day');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">645</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">646</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">647</span></td>
       <td><span class="missed code">        case 'n':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">648</span></td>
       <td><span class="missed code">        case 'm':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">649</span></td>
       <td><span class="missed code">          $final_date['month'] = intval($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">650</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('month');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">651</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">652</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">653</span></td>
       <td><span class="missed code">        case 'F':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">654</span></td>
       <td><span class="missed code">          $array_month_long = array_flip(date_month_names());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">655</span></td>
       <td><span class="missed code">          $final_date['month'] = array_key_exists($value, $array_month_long) ? $array_month_long[$value] : -1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">656</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('month');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">657</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">658</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">659</span></td>
       <td><span class="missed code">        case 'M':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">660</span></td>
       <td><span class="missed code">          $array_month = array_flip(date_month_names_abbr());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">661</span></td>
       <td><span class="missed code">          $final_date['month'] = array_key_exists($value, $array_month) ? $array_month[$value] : -1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">662</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('month');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">663</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">664</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">665</span></td>
       <td><span class="missed code">        case 'Y':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">666</span></td>
       <td><span class="missed code">          $final_date['year'] = $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">667</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('year');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">668</span></td>
       <td><span class="missed code">          if (strlen($value) &lt; 4) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">669</span></td>
       <td><span class="missed code">            $this-&gt;errors['year'] = t('The year is invalid. Please check that entry includes four digits.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">670</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">671</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">672</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">673</span></td>
       <td><span class="missed code">        case 'y':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">674</span></td>
       <td><span class="missed code">          $year = $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">675</span></td>
       <td><span class="comment code">          // If no century, we add the current one (&quot;06&quot; =&gt; &quot;2006&quot;).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">676</span></td>
       <td><span class="missed code">          $final_date['year'] = str_pad($year, 4, substr(date(&quot;Y&quot;), 0, 2), STR_PAD_LEFT);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">677</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('year');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">678</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">679</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">680</span></td>
       <td><span class="missed code">        case 'a':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">681</span></td>
       <td><span class="missed code">        case 'A':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">682</span></td>
       <td><span class="missed code">          $ampm = strtolower($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">683</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">684</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">685</span></td>
       <td><span class="missed code">        case 'g':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">686</span></td>
       <td><span class="missed code">        case 'h':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">687</span></td>
       <td><span class="missed code">        case 'G':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">688</span></td>
       <td><span class="missed code">        case 'H':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">689</span></td>
       <td><span class="missed code">          $final_date['hour'] = intval($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">690</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('hour');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">691</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">692</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">693</span></td>
       <td><span class="missed code">        case 'i':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">694</span></td>
       <td><span class="missed code">          $final_date['minute'] = intval($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">695</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('minute');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">696</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">697</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">698</span></td>
       <td><span class="missed code">        case 's':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">699</span></td>
       <td><span class="missed code">          $final_date['second'] = intval($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">700</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('second');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">701</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">702</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">703</span></td>
       <td><span class="missed code">        case 'U':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">704</span></td>
       <td><span class="missed code">          parent::__construct($value, $tz ? $tz : new DateTimeZone(&quot;UTC&quot;));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">705</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('year');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">706</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('month');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">707</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('day');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">708</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('hour');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">709</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('minute');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">710</span></td>
       <td><span class="missed code">          $this-&gt;addGranularity('second');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">711</span></td>
       <td><span class="missed code">          return $this;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">712</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">713</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">714</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">715</span></td>
       <td><span class="missed code">    if (isset($ampm) &amp;&amp; $ampm == 'pm' &amp;&amp; $final_date['hour'] &lt; 12) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">716</span></td>
       <td><span class="missed code">      $final_date['hour'] += 12;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">717</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">718</span></td>
       <td><span class="missed code">    elseif (isset($ampm) &amp;&amp; $ampm == 'am' &amp;&amp; $final_date['hour'] == 12) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">719</span></td>
       <td><span class="missed code">      $final_date['hour'] -= 12;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">720</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">721</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">722</span></td>
       <td><span class="comment code">    // Blank becomes current time, given TZ.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">723</span></td>
       <td><span class="missed code">    parent::__construct('', $tz ? $tz : new DateTimeZone(&quot;UTC&quot;));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">724</span></td>
       <td><span class="missed code">    if ($tz) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">725</span></td>
       <td><span class="missed code">      $this-&gt;addGranularity('timezone');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">726</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">727</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">728</span></td>
       <td><span class="comment code">    // SetDate expects an integer value for the year, results can be unexpected
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">729</span></td>
       <td><span class="comment code">    // if we feed it something like '0100' or '0000'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">730</span></td>
       <td><span class="missed code">    $final_date['year'] = intval($final_date['year']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">731</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">732</span></td>
       <td><span class="missed code">    $this-&gt;errors += $this-&gt;arrayErrors($final_date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">733</span></td>
       <td><span class="missed code">    $granularity = drupal_map_assoc($this-&gt;granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">734</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">735</span></td>
       <td><span class="comment code">    // If the input value is '0000-00-00', PHP's date class will later
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">736</span></td>
       <td><span class="comment code">    // incorrectly convert it to something like '-0001-11-30' if we do setDate()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">737</span></td>
       <td><span class="comment code">    // here. If we don't do setDate() here, it will default to the current date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">738</span></td>
       <td><span class="comment code">    // and we will lose any way to tell that there was no date in the orignal
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">739</span></td>
       <td><span class="comment code">    // input values. So set a flag we can use later to tell that this date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">740</span></td>
       <td><span class="comment code">    // object was created using only time values, and that the date values are
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">741</span></td>
       <td><span class="comment code">    // artifical.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">742</span></td>
       <td><span class="missed code">    if (empty($final_date['year']) &amp;&amp; empty($final_date['month']) &amp;&amp; empty($final_date['day'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">743</span></td>
       <td><span class="missed code">      $this-&gt;timeOnly = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">744</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">745</span></td>
       <td><span class="missed code">    elseif (empty($this-&gt;errors)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">746</span></td>
       <td><span class="comment code">      // setDate() expects a valid year, month, and day.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">747</span></td>
       <td><span class="comment code">      // Set some defaults for dates that don't use this to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">748</span></td>
       <td><span class="comment code">      // keep PHP from interpreting it as the last day of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">749</span></td>
       <td><span class="comment code">      // the previous month or last month of the previous year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">750</span></td>
       <td><span class="missed code">      if (empty($granularity['month'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">751</span></td>
       <td><span class="missed code">        $final_date['month'] = 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">752</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">753</span></td>
       <td><span class="missed code">      if (empty($granularity['day'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">754</span></td>
       <td><span class="missed code">        $final_date['day'] = 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">755</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">756</span></td>
       <td><span class="missed code">      $this-&gt;setDate($final_date['year'], $final_date['month'], $final_date['day']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">757</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">758</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">759</span></td>
       <td><span class="missed code">    if (!isset($final_date['hour']) &amp;&amp; !isset($final_date['minute']) &amp;&amp; !isset($final_date['second'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">760</span></td>
       <td><span class="missed code">      $this-&gt;dateOnly = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">761</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">762</span></td>
       <td><span class="missed code">    elseif (empty($this-&gt;errors)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">763</span></td>
       <td><span class="missed code">      $this-&gt;setTime($final_date['hour'], $final_date['minute'], $final_date['second']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">764</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">765</span></td>
       <td><span class="missed code">    return $this;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">766</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">767</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">768</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">769</span></td>
       <td><span class="comment code">   * Returns all standard date parts in an array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">770</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">771</span></td>
       <td><span class="comment code">   * Will return '' for parts in which it lacks granularity.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">772</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">773</span></td>
       <td><span class="comment code">   * @param bool $force
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">774</span></td>
       <td><span class="comment code">   *   Whether or not to limit the granularity. Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">775</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">776</span></td>
       <td><span class="comment code">   * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">777</span></td>
       <td><span class="comment code">   *   An array of formatted date part values, keyed by date parts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">778</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">779</span></td>
       <td><span class="comment code">  public function toArray($force = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">780</span></td>
       <td><span class="comment code">    return array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">781</span></td>
       <td><span class="missed code">      'year' =&gt; $this-&gt;format('Y', $force),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">782</span></td>
       <td><span class="missed code">      'month' =&gt; $this-&gt;format('n', $force),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">783</span></td>
       <td><span class="missed code">      'day' =&gt; $this-&gt;format('j', $force),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">784</span></td>
       <td><span class="missed code">      'hour' =&gt; intval($this-&gt;format('H', $force)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">785</span></td>
       <td><span class="missed code">      'minute' =&gt; intval($this-&gt;format('i', $force)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">786</span></td>
       <td><span class="missed code">      'second' =&gt; intval($this-&gt;format('s', $force)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">787</span></td>
       <td><span class="missed code">      'timezone' =&gt; $this-&gt;format('e', $force),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">788</span></td>
       <td><span class="missed code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">789</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">790</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">791</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">792</span></td>
       <td><span class="comment code">   * Creates an ISO date from an array of values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">793</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">794</span></td>
       <td><span class="comment code">   * @param array $arr
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">795</span></td>
       <td><span class="comment code">   *   An array of date values keyed by date part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">796</span></td>
       <td><span class="comment code">   * @param bool $full
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">797</span></td>
       <td><span class="comment code">   *   (optional) Whether to force a full date by filling in missing values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">798</span></td>
       <td><span class="comment code">   *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">799</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">800</span></td>
       <td><span class="comment code">  public function toISO($arr, $full = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">801</span></td>
       <td><span class="comment code">    // Add empty values to avoid errors. The empty values must create a valid
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">802</span></td>
       <td><span class="comment code">    // date or we will get date slippage, i.e. a value of 2011-00-00 will get
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">803</span></td>
       <td><span class="comment code">    // interpreted as November of 2010 by PHP.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">804</span></td>
       <td><span class="missed code">    if ($full) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">805</span></td>
       <td><span class="comment code">      $arr += array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">806</span></td>
       <td><span class="missed code">        'year' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">807</span></td>
       <td><span class="missed code">        'month' =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">808</span></td>
       <td><span class="missed code">        'day' =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">809</span></td>
       <td><span class="missed code">        'hour' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">810</span></td>
       <td><span class="missed code">        'minute' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">811</span></td>
       <td><span class="missed code">        'second' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">812</span></td>
       <td><span class="missed code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">813</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">814</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">815</span></td>
       <td><span class="comment code">      $arr += array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">816</span></td>
       <td><span class="missed code">        'year' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">817</span></td>
       <td><span class="missed code">        'month' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">818</span></td>
       <td><span class="missed code">        'day' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">819</span></td>
       <td><span class="missed code">        'hour' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">820</span></td>
       <td><span class="missed code">        'minute' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">821</span></td>
       <td><span class="missed code">        'second' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">822</span></td>
       <td><span class="missed code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">823</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">824</span></td>
       <td><span class="missed code">    $datetime = '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">825</span></td>
       <td><span class="missed code">    if ($arr['year'] !== '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">826</span></td>
       <td><span class="missed code">      $datetime = date_pad(intval($arr['year']), 4);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">827</span></td>
       <td><span class="missed code">      if ($full || $arr['month'] !== '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">828</span></td>
       <td><span class="missed code">        $datetime .= '-' . date_pad(intval($arr['month']));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">829</span></td>
       <td><span class="missed code">        if ($full || $arr['day'] !== '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">830</span></td>
       <td><span class="missed code">          $datetime .= '-' . date_pad(intval($arr['day']));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">831</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">832</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">833</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">834</span></td>
       <td><span class="missed code">    if ($arr['hour'] !== '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">835</span></td>
       <td><span class="missed code">      $datetime .= $datetime ? 'T' : '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">836</span></td>
       <td><span class="missed code">      $datetime .= date_pad(intval($arr['hour']));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">837</span></td>
       <td><span class="missed code">      if ($full || $arr['minute'] !== '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">838</span></td>
       <td><span class="missed code">        $datetime .= ':' . date_pad(intval($arr['minute']));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">839</span></td>
       <td><span class="missed code">        if ($full || $arr['second'] !== '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">840</span></td>
       <td><span class="missed code">          $datetime .= ':' . date_pad(intval($arr['second']));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">841</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">842</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">843</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">844</span></td>
       <td><span class="missed code">    return $datetime;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">845</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">846</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">847</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">848</span></td>
       <td><span class="comment code">   * Forces an incomplete date to be valid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">849</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">850</span></td>
       <td><span class="comment code">   * E.g., add a valid year, month, and day if only the time has been defined.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">851</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">852</span></td>
       <td><span class="comment code">   * @param array|string $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">853</span></td>
       <td><span class="comment code">   *   An array of date parts or a datetime string with values to be massaged
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">854</span></td>
       <td><span class="comment code">   *   into a valid date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">855</span></td>
       <td><span class="comment code">   * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">856</span></td>
       <td><span class="comment code">   *   (optional) The format of the date. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">857</span></td>
       <td><span class="comment code">   * @param string $default
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">858</span></td>
       <td><span class="comment code">   *   (optional) If the fallback should use the first value of the date part,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">859</span></td>
       <td><span class="comment code">   *   or the current value of the date part. Defaults to 'first'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">860</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">861</span></td>
       <td><span class="comment code">  public function setFuzzyDate($date, $format = NULL, $default = 'first') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">862</span></td>
       <td><span class="missed code">    $timezone = $this-&gt;getTimeZone() ? $this-&gt;getTimeZone()-&gt;getName() : NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">863</span></td>
       <td><span class="missed code">    $comp = new DateObject($date, $timezone, $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">864</span></td>
       <td><span class="missed code">    $arr = $comp-&gt;toArray(TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">865</span></td>
       <td><span class="missed code">    foreach ($arr as $key =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">866</span></td>
       <td><span class="comment code">      // Set to intval here and then test that it is still an integer.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">867</span></td>
       <td><span class="comment code">      // Needed because sometimes valid integers come through as strings.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">868</span></td>
       <td><span class="missed code">      $arr[$key] = $this-&gt;forceValid($key, intval($value), $default, $arr['month'], $arr['year']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">869</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">870</span></td>
       <td><span class="missed code">    $this-&gt;setDate($arr['year'], $arr['month'], $arr['day']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">871</span></td>
       <td><span class="missed code">    $this-&gt;setTime($arr['hour'], $arr['minute'], $arr['second']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">872</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">873</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">874</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">875</span></td>
       <td><span class="comment code">   * Converts a date part into something that will produce a valid date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">876</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">877</span></td>
       <td><span class="comment code">   * @param string $part
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">878</span></td>
       <td><span class="comment code">   *   The date part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">879</span></td>
       <td><span class="comment code">   * @param int $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">880</span></td>
       <td><span class="comment code">   *   The date value for this part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">881</span></td>
       <td><span class="comment code">   * @param string $default
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">882</span></td>
       <td><span class="comment code">   *   (optional) If the fallback should use the first value of the date part,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">883</span></td>
       <td><span class="comment code">   *   or the current value of the date part. Defaults to 'first'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">884</span></td>
       <td><span class="comment code">   * @param int $month
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">885</span></td>
       <td><span class="comment code">   *   (optional) Used when the date part is less than 'month' to specify the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">886</span></td>
       <td><span class="comment code">   *   date. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">887</span></td>
       <td><span class="comment code">   * @param int $year
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">888</span></td>
       <td><span class="comment code">   *   (optional) Used when the date part is less than 'year' to specify the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">889</span></td>
       <td><span class="comment code">   *   date. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">890</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">891</span></td>
       <td><span class="comment code">   * @return int
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">892</span></td>
       <td><span class="comment code">   *   A valid date value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">893</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">894</span></td>
       <td><span class="comment code">  protected function forceValid($part, $value, $default = 'first', $month = NULL, $year = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">895</span></td>
       <td><span class="missed code">    $now = date_now();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">896</span></td>
       <td><span class="comment code">    switch ($part) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">897</span></td>
       <td><span class="missed code">      case 'year':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">898</span></td>
       <td><span class="missed code">        $fallback = $now-&gt;format('Y');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">899</span></td>
       <td><span class="missed code">        return !is_int($value) || empty($value) || $value &lt; variable_get('date_min_year', 1) || $value &gt; variable_get('date_max_year', 4000) ? $fallback : $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">900</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">901</span></td>
       <td><span class="missed code">      case 'month':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">902</span></td>
       <td><span class="missed code">        $fallback = $default == 'first' ? 1 : $now-&gt;format('n');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">903</span></td>
       <td><span class="missed code">        return !is_int($value) || empty($value) || $value &lt;= 0 || $value &gt; 12 ? $fallback : $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">904</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">905</span></td>
       <td><span class="missed code">      case 'day':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">906</span></td>
       <td><span class="missed code">        $fallback = $default == 'first' ? 1 : $now-&gt;format('j');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">907</span></td>
       <td><span class="missed code">        $max_day = isset($year) &amp;&amp; isset($month) ? date_days_in_month($year, $month) : 31;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">908</span></td>
       <td><span class="missed code">        return !is_int($value) || empty($value) || $value &lt;= 0 || $value &gt; $max_day ? $fallback : $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">909</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">910</span></td>
       <td><span class="missed code">      case 'hour':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">911</span></td>
       <td><span class="missed code">        $fallback = $default == 'first' ? 0 : $now-&gt;format('G');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">912</span></td>
       <td><span class="missed code">        return !is_int($value) || $value &lt; 0 || $value &gt; 23 ? $fallback : $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">913</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">914</span></td>
       <td><span class="missed code">      case 'minute':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">915</span></td>
       <td><span class="missed code">        $fallback = $default == 'first' ? 0 : $now-&gt;format('i');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">916</span></td>
       <td><span class="missed code">        return !is_int($value) || $value &lt; 0 || $value &gt; 59 ? $fallback : $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">917</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">918</span></td>
       <td><span class="missed code">      case 'second':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">919</span></td>
       <td><span class="missed code">        $fallback = $default == 'first' ? 0 : $now-&gt;format('s');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">920</span></td>
       <td><span class="missed code">        return !is_int($value) || $value &lt; 0 || $value &gt; 59 ? $fallback : $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">921</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">922</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">923</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">924</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">925</span></td>
       <td><span class="comment code">   * Finds possible errors in an array of date part values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">926</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">927</span></td>
       <td><span class="comment code">   * The forceValid() function will change an invalid value to a valid one, so
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">928</span></td>
       <td><span class="comment code">   * we just need to see if the value got altered.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">929</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">930</span></td>
       <td><span class="comment code">   * @param array $arr
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">931</span></td>
       <td><span class="comment code">   *   An array of date values, keyed by date part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">932</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">933</span></td>
       <td><span class="comment code">   * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">934</span></td>
       <td><span class="comment code">   *   An array of error messages, keyed by date part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">935</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">936</span></td>
       <td><span class="comment code">  public function arrayErrors($arr) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">937</span></td>
       <td><span class="missed code">    $errors = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">938</span></td>
       <td><span class="missed code">    $now = date_now();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">939</span></td>
       <td><span class="missed code">    $default_month = !empty($arr['month']) ? $arr['month'] : $now-&gt;format('n');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">940</span></td>
       <td><span class="missed code">    $default_year = !empty($arr['year']) ? $arr['year'] : $now-&gt;format('Y');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">941</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">942</span></td>
       <td><span class="missed code">    $this-&gt;granularity = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">943</span></td>
       <td><span class="missed code">    foreach ($arr as $part =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">944</span></td>
       <td><span class="comment code">      // Explicitly set the granularity to the values in the input array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">945</span></td>
       <td><span class="missed code">      if (is_numeric($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">946</span></td>
       <td><span class="missed code">        $this-&gt;addGranularity($part);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">947</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">948</span></td>
       <td><span class="comment code">      // Avoid false errors when a numeric value is input as a string by casting
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">949</span></td>
       <td><span class="comment code">      // as an integer.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">950</span></td>
       <td><span class="missed code">      $value = intval($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">951</span></td>
       <td><span class="missed code">      if (!empty($value) &amp;&amp; $this-&gt;forceValid($part, $value, 'now', $default_month, $default_year) != $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">952</span></td>
       <td><span class="comment code">        // Use a switch/case to make translation easier by providing a different
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">953</span></td>
       <td><span class="comment code">        // message for each part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">954</span></td>
       <td><span class="comment code">        switch ($part) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">955</span></td>
       <td><span class="missed code">          case 'year':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">956</span></td>
       <td><span class="missed code">            $errors['year'] = t('The year is invalid.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">957</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">958</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">959</span></td>
       <td><span class="missed code">          case 'month':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">960</span></td>
       <td><span class="missed code">            $errors['month'] = t('The month is invalid.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">961</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">962</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">963</span></td>
       <td><span class="missed code">          case 'day':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">964</span></td>
       <td><span class="missed code">            $errors['day'] = t('The day is invalid.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">965</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">966</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">967</span></td>
       <td><span class="missed code">          case 'hour':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">968</span></td>
       <td><span class="missed code">            $errors['hour'] = t('The hour is invalid.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">969</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">970</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">971</span></td>
       <td><span class="missed code">          case 'minute':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">972</span></td>
       <td><span class="missed code">            $errors['minute'] = t('The minute is invalid.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">973</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">974</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">975</span></td>
       <td><span class="missed code">          case 'second':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">976</span></td>
       <td><span class="missed code">            $errors['second'] = t('The second is invalid.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">977</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">978</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">979</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">980</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">981</span></td>
       <td><span class="missed code">    if ($this-&gt;hasTime()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">982</span></td>
       <td><span class="missed code">      $this-&gt;addGranularity('timezone');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">983</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">984</span></td>
       <td><span class="missed code">    return $errors;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">985</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">986</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">987</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">988</span></td>
       <td><span class="comment code">   * Computes difference between two days using a given measure.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">989</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">990</span></td>
       <td><span class="comment code">   * @param object $date2_in
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">991</span></td>
       <td><span class="comment code">   *   The stop date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">992</span></td>
       <td><span class="comment code">   * @param string $measure
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">993</span></td>
       <td><span class="comment code">   *   (optional) A granularity date part. Defaults to 'seconds'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">994</span></td>
       <td><span class="comment code">   * @param bool $absolute
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">995</span></td>
       <td><span class="comment code">   *   (optional) Indicate whether the absolute value of the difference should
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">996</span></td>
       <td><span class="comment code">   *   be returned or if the sign should be retained. Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">997</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">998</span></td>
       <td><span class="comment code">  public function difference($date2_in, $measure = 'seconds', $absolute = TRUE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">999</span></td>
       <td><span class="comment code">    // Create cloned objects or original dates will be impacted by the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1000</span></td>
       <td><span class="comment code">    // date_modify() operations done in this code.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1001</span></td>
       <td><span class="missed code">    $date1 = clone($this);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1002</span></td>
       <td><span class="missed code">    $date2 = clone($date2_in);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1003</span></td>
       <td><span class="missed code">    if (is_object($date1) &amp;&amp; is_object($date2)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1004</span></td>
       <td><span class="missed code">      $diff = date_format($date2, 'U') - date_format($date1, 'U');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1005</span></td>
       <td><span class="missed code">      if ($diff == 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1006</span></td>
       <td><span class="missed code">        return 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1007</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1008</span></td>
       <td><span class="missed code">      elseif ($diff &lt; 0 &amp;&amp; $absolute) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1009</span></td>
       <td><span class="comment code">        // Make sure $date1 is the smaller date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1010</span></td>
       <td><span class="missed code">        $temp = $date2;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1011</span></td>
       <td><span class="missed code">        $date2 = $date1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1012</span></td>
       <td><span class="missed code">        $date1 = $temp;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1013</span></td>
       <td><span class="missed code">        $diff = date_format($date2, 'U') - date_format($date1, 'U');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1014</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1015</span></td>
       <td><span class="missed code">      $year_diff = intval(date_format($date2, 'Y') - date_format($date1, 'Y'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1016</span></td>
       <td><span class="comment code">      switch ($measure) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1017</span></td>
       <td><span class="comment code">        // The easy cases first.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1018</span></td>
       <td><span class="missed code">        case 'seconds':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1019</span></td>
       <td><span class="missed code">          return $diff;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1020</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1021</span></td>
       <td><span class="missed code">        case 'minutes':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1022</span></td>
       <td><span class="missed code">          return $diff / 60;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1023</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1024</span></td>
       <td><span class="missed code">        case 'hours':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1025</span></td>
       <td><span class="missed code">          return $diff / 3600;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1026</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1027</span></td>
       <td><span class="missed code">        case 'years':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1028</span></td>
       <td><span class="missed code">          return $year_diff;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1029</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1030</span></td>
       <td><span class="missed code">        case 'months':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1031</span></td>
       <td><span class="missed code">          $format = 'n';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1032</span></td>
       <td><span class="missed code">          $item1 = date_format($date1, $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1033</span></td>
       <td><span class="missed code">          $item2 = date_format($date2, $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1034</span></td>
       <td><span class="missed code">          if ($year_diff == 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1035</span></td>
       <td><span class="missed code">            return intval($item2 - $item1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1036</span></td>
       <td><span class="dead code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1037</span></td>
       <td><span class="missed code">          elseif ($year_diff &lt; 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1038</span></td>
       <td><span class="missed code">            $item_diff = 0 - $item1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1039</span></td>
       <td><span class="missed code">            $item_diff -= intval((abs($year_diff) - 1) * 12);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1040</span></td>
       <td><span class="missed code">            return $item_diff - (12 - $item2);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1041</span></td>
       <td><span class="dead code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1042</span></td>
       <td><span class="comment code">          else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1043</span></td>
       <td><span class="missed code">            $item_diff = 12 - $item1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1044</span></td>
       <td><span class="missed code">            $item_diff += intval(($year_diff - 1) * 12);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1045</span></td>
       <td><span class="missed code">            return $item_diff + $item2;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1046</span></td>
       <td><span class="comment code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1047</span></td>
       <td><span class="dead code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1048</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1049</span></td>
       <td><span class="missed code">        case 'days':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1050</span></td>
       <td><span class="missed code">          $format = 'z';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1051</span></td>
       <td><span class="missed code">          $item1 = date_format($date1, $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1052</span></td>
       <td><span class="missed code">          $item2 = date_format($date2, $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1053</span></td>
       <td><span class="missed code">          if ($year_diff == 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1054</span></td>
       <td><span class="missed code">            return intval($item2 - $item1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1055</span></td>
       <td><span class="dead code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1056</span></td>
       <td><span class="missed code">          elseif ($year_diff &lt; 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1057</span></td>
       <td><span class="missed code">            $item_diff = 0 - $item1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1058</span></td>
       <td><span class="missed code">            for ($i = 1; $i &lt; abs($year_diff); $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1059</span></td>
       <td><span class="missed code">              date_modify($date1, '-1 year');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1060</span></td>
       <td><span class="missed code">              $item_diff -= date_days_in_year($date1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1061</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1062</span></td>
       <td><span class="missed code">            return $item_diff - (date_days_in_year($date2) - $item2);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1063</span></td>
       <td><span class="dead code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1064</span></td>
       <td><span class="comment code">          else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1065</span></td>
       <td><span class="missed code">            $item_diff = date_days_in_year($date1) - $item1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1066</span></td>
       <td><span class="missed code">            for ($i = 1; $i &lt; $year_diff; $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1067</span></td>
       <td><span class="missed code">              date_modify($date1, '+1 year');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1068</span></td>
       <td><span class="missed code">              $item_diff += date_days_in_year($date1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1069</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1070</span></td>
       <td><span class="missed code">            return $item_diff + $item2;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1071</span></td>
       <td><span class="comment code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1072</span></td>
       <td><span class="dead code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1073</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1074</span></td>
       <td><span class="missed code">        case 'weeks':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1075</span></td>
       <td><span class="missed code">          $week_diff = date_format($date2, 'W') - date_format($date1, 'W');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1076</span></td>
       <td><span class="missed code">          $year_diff = date_format($date2, 'o') - date_format($date1, 'o');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1077</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1078</span></td>
       <td><span class="missed code">          $sign = ($year_diff &lt; 0) ? -1 : 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1079</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1080</span></td>
       <td><span class="missed code">          for ($i = 1; $i &lt;= abs($year_diff); $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1081</span></td>
       <td><span class="missed code">            date_modify($date1, (($sign &gt; 0) ? '+' : '-') . '1 year');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1082</span></td>
       <td><span class="missed code">            $week_diff += (date_iso_weeks_in_year($date1) * $sign);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1083</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1084</span></td>
       <td><span class="missed code">          return $week_diff;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1085</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1086</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1087</span></td>
       <td><span class="missed code">    return NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1088</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1089</span></td>
       <td><span class="comment code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1090</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1091</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1092</span></td>
       <td><span class="comment code"> * Determines if the date element needs to be processed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1093</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1094</span></td>
       <td><span class="comment code"> * Helper function to see if date element has been hidden by FAPI to see if it
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1095</span></td>
       <td><span class="comment code"> * needs to be processed or just pass the value through. This is needed since
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1096</span></td>
       <td><span class="comment code"> * normal date processing explands the date element into parts and then
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1097</span></td>
       <td><span class="comment code"> * reconstructs it, which is not needed or desirable if the field is hidden.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1098</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1099</span></td>
       <td><span class="comment code"> * @param array $element
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1100</span></td>
       <td><span class="comment code"> *   The date element to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1101</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1102</span></td>
       <td><span class="comment code"> * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1103</span></td>
       <td><span class="comment code"> *   TRUE if the element is effectively hidden, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1104</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1105</span></td>
       <td><span class="covered code">function date_hidden_element($element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1106</span></td>
       <td><span class="comment code">  // @TODO What else needs to be tested to see if dates are hidden or disabled?
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1107</span></td>
       <td><span class="missed code">  if ((isset($element['#access']) &amp;&amp; empty($element['#access']))
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1108</span></td>
       <td><span class="missed code">    || !empty($element['#programmed'])
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1109</span></td>
       <td><span class="missed code">    || in_array($element['#type'], array('hidden', 'value'))) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1110</span></td>
       <td><span class="missed code">    return TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1111</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1112</span></td>
       <td><span class="missed code">  return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1113</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1114</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1115</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1116</span></td>
       <td><span class="comment code"> * Helper function for getting the format string for a date type.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1117</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1118</span></td>
       <td><span class="comment code"> * @param string $type
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1119</span></td>
       <td><span class="comment code"> *   A date type format name.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1120</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1121</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1122</span></td>
       <td><span class="comment code"> *   A date type format, like 'Y-m-d H:i:s'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1123</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1124</span></td>
       <td><span class="covered code">function date_type_format($type) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1125</span></td>
       <td><span class="comment code">  switch ($type) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1126</span></td>
       <td><span class="missed code">    case DATE_ISO:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1127</span></td>
       <td><span class="missed code">      return DATE_FORMAT_ISO;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1128</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1129</span></td>
       <td><span class="missed code">    case DATE_UNIX:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1130</span></td>
       <td><span class="missed code">      return DATE_FORMAT_UNIX;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1131</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1132</span></td>
       <td><span class="missed code">    case DATE_DATETIME:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1133</span></td>
       <td><span class="missed code">      return DATE_FORMAT_DATETIME;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1134</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1135</span></td>
       <td><span class="missed code">    case DATE_ICAL:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1136</span></td>
       <td><span class="missed code">      return DATE_FORMAT_ICAL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1137</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1138</span></td>
       <td><span class="missed code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1139</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1140</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1141</span></td>
       <td><span class="comment code"> * Constructs an untranslated array of month names.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1142</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1143</span></td>
       <td><span class="comment code"> * Needed for CSS, translation functions, strtotime(), and other places
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1144</span></td>
       <td><span class="comment code"> * that use the English versions of these words.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1145</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1146</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1147</span></td>
       <td><span class="comment code"> *   An array of month names.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1148</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1149</span></td>
       <td><span class="covered code">function date_month_names_untranslated() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1150</span></td>
       <td><span class="missed code">  static $month_names;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1151</span></td>
       <td><span class="missed code">  if (empty($month_names)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1152</span></td>
       <td><span class="comment code">    $month_names = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1153</span></td>
       <td><span class="missed code">      1 =&gt; 'January',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1154</span></td>
       <td><span class="missed code">      2 =&gt; 'February',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1155</span></td>
       <td><span class="missed code">      3 =&gt; 'March',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1156</span></td>
       <td><span class="missed code">      4 =&gt; 'April',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1157</span></td>
       <td><span class="missed code">      5 =&gt; 'May',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1158</span></td>
       <td><span class="missed code">      6 =&gt; 'June',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1159</span></td>
       <td><span class="missed code">      7 =&gt; 'July',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1160</span></td>
       <td><span class="missed code">      8 =&gt; 'August',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1161</span></td>
       <td><span class="missed code">      9 =&gt; 'September',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1162</span></td>
       <td><span class="missed code">      10 =&gt; 'October',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1163</span></td>
       <td><span class="missed code">      11 =&gt; 'November',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1164</span></td>
       <td><span class="missed code">      12 =&gt; 'December',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1165</span></td>
       <td><span class="missed code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1166</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1167</span></td>
       <td><span class="missed code">  return $month_names;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1168</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1169</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1170</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1171</span></td>
       <td><span class="comment code"> * Returns a translated array of month names.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1172</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1173</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1174</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1175</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1176</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1177</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1178</span></td>
       <td><span class="comment code"> *   An array of month names.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1179</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1180</span></td>
       <td><span class="covered code">function date_month_names($required = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1181</span></td>
       <td><span class="missed code">  $month_names = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1182</span></td>
       <td><span class="missed code">  foreach (date_month_names_untranslated() as $key =&gt; $month) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1183</span></td>
       <td><span class="missed code">    $month_names[$key] = t($month, array(), array('context' =&gt; 'Long month name'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1184</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1185</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1186</span></td>
       <td><span class="missed code">  return !$required ? $none + $month_names : $month_names;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1187</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1188</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1189</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1190</span></td>
       <td><span class="comment code"> * Constructs a translated array of month name abbreviations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1191</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1192</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1193</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1194</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1195</span></td>
       <td><span class="comment code"> * @param int $length
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1196</span></td>
       <td><span class="comment code"> *   (optional) The length of the abbreviation. Defaults to 3.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1197</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1198</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1199</span></td>
       <td><span class="comment code"> *   An array of month abbreviations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1200</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1201</span></td>
       <td><span class="covered code">function date_month_names_abbr($required = FALSE, $length = 3) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1202</span></td>
       <td><span class="missed code">  $month_names = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1203</span></td>
       <td><span class="missed code">  foreach (date_month_names_untranslated() as $key =&gt; $month) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1204</span></td>
       <td><span class="missed code">    if ($length == 3) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1205</span></td>
       <td><span class="missed code">      $month_names[$key] = t(substr($month, 0, $length), array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1206</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1207</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1208</span></td>
       <td><span class="missed code">      $month_names[$key] = t(substr($month, 0, $length), array(), array('context' =&gt; 'month_abbr'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1209</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1210</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1211</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1212</span></td>
       <td><span class="missed code">  return !$required ? $none + $month_names : $month_names;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1213</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1214</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1215</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1216</span></td>
       <td><span class="comment code"> * Constructs an untranslated array of week days.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1217</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1218</span></td>
       <td><span class="comment code"> * Needed for CSS, translation functions, strtotime(), and other places
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1219</span></td>
       <td><span class="comment code"> * that use the English versions of these words.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1220</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1221</span></td>
       <td><span class="comment code"> * @param bool $refresh
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1222</span></td>
       <td><span class="comment code"> *   (optional) Whether to refresh the list. Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1223</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1224</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1225</span></td>
       <td><span class="comment code"> *   An array of week day names
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1226</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1227</span></td>
       <td><span class="covered code">function date_week_days_untranslated($refresh = TRUE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1228</span></td>
       <td><span class="missed code">  static $weekdays;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1229</span></td>
       <td><span class="missed code">  if ($refresh || empty($weekdays)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1230</span></td>
       <td><span class="comment code">    $weekdays = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1231</span></td>
       <td><span class="missed code">      'Sunday',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1232</span></td>
       <td><span class="missed code">      'Monday',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1233</span></td>
       <td><span class="missed code">      'Tuesday',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1234</span></td>
       <td><span class="missed code">      'Wednesday',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1235</span></td>
       <td><span class="missed code">      'Thursday',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1236</span></td>
       <td><span class="missed code">      'Friday',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1237</span></td>
       <td><span class="missed code">      'Saturday',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1238</span></td>
       <td><span class="missed code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1239</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1240</span></td>
       <td><span class="missed code">  return $weekdays;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1241</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1242</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1243</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1244</span></td>
       <td><span class="comment code"> * Returns a translated array of week names.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1245</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1246</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1247</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1248</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1249</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1250</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1251</span></td>
       <td><span class="comment code"> *   An array of week day names
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1252</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1253</span></td>
       <td><span class="covered code">function date_week_days($required = FALSE, $refresh = TRUE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1254</span></td>
       <td><span class="missed code">  $weekdays = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1255</span></td>
       <td><span class="missed code">  foreach (date_week_days_untranslated() as $key =&gt; $day) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1256</span></td>
       <td><span class="missed code">    $weekdays[$key] = t($day, array(), array('context' =&gt; ''));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1257</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1258</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1259</span></td>
       <td><span class="missed code">  return !$required ? $none + $weekdays : $weekdays;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1260</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1261</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1262</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1263</span></td>
       <td><span class="comment code"> * Constructs a translated array of week day abbreviations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1264</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1265</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1266</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1267</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1268</span></td>
       <td><span class="comment code"> * @param bool $refresh
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1269</span></td>
       <td><span class="comment code"> *   (optional) Whether to refresh the list. Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1270</span></td>
       <td><span class="comment code"> * @param int $length
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1271</span></td>
       <td><span class="comment code"> *   (optional) The length of the abbreviation. Defaults to 3.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1272</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1273</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1274</span></td>
       <td><span class="comment code"> *   An array of week day abbreviations
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1275</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1276</span></td>
       <td><span class="covered code">function date_week_days_abbr($required = FALSE, $refresh = TRUE, $length = 3) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1277</span></td>
       <td><span class="missed code">  $weekdays = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1278</span></td>
       <td><span class="comment code">  switch ($length) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1279</span></td>
       <td><span class="missed code">    case 1:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1280</span></td>
       <td><span class="missed code">      $context = 'day_abbr1';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1281</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1282</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1283</span></td>
       <td><span class="missed code">    case 2:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1284</span></td>
       <td><span class="missed code">      $context = 'day_abbr2';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1285</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1286</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1287</span></td>
       <td><span class="missed code">    default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1288</span></td>
       <td><span class="missed code">      $context = '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1289</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1290</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1291</span></td>
       <td><span class="missed code">  foreach (date_week_days_untranslated() as $key =&gt; $day) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1292</span></td>
       <td><span class="missed code">    $weekdays[$key] = t(substr($day, 0, $length), array(), array('context' =&gt; $context));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1293</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1294</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1295</span></td>
       <td><span class="missed code">  return !$required ? $none + $weekdays : $weekdays;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1296</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1297</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1298</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1299</span></td>
       <td><span class="comment code"> * Reorders weekdays to match the first day of the week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1300</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1301</span></td>
       <td><span class="comment code"> * @param array $weekdays
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1302</span></td>
       <td><span class="comment code"> *   An array of weekdays.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1303</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1304</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1305</span></td>
       <td><span class="comment code"> *   An array of weekdays reordered to match the first day of the week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1306</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1307</span></td>
       <td><span class="covered code">function date_week_days_ordered($weekdays) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1308</span></td>
       <td><span class="missed code">  $first_day = variable_get('date_first_day', 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1309</span></td>
       <td><span class="missed code">  if ($first_day &gt; 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1310</span></td>
       <td><span class="missed code">    for ($i = 1; $i &lt;= $first_day; $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1311</span></td>
       <td><span class="missed code">      $last = array_shift($weekdays);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1312</span></td>
       <td><span class="missed code">      array_push($weekdays, $last);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1313</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1314</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1315</span></td>
       <td><span class="missed code">  return $weekdays;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1316</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1317</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1318</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1319</span></td>
       <td><span class="comment code"> * Constructs an array of years.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1320</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1321</span></td>
       <td><span class="comment code"> * @param int $start
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1322</span></td>
       <td><span class="comment code"> *   The start year in the array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1323</span></td>
       <td><span class="comment code"> * @param int $end
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1324</span></td>
       <td><span class="comment code"> *   The end year in the array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1325</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1326</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1327</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1328</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1329</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1330</span></td>
       <td><span class="comment code"> *   An array of years in the selected range.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1331</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1332</span></td>
       <td><span class="covered code">function date_years($start = 0, $end = 0, $required = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1333</span></td>
       <td><span class="comment code">  // Ensure $min and $max are valid values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1334</span></td>
       <td><span class="missed code">  if (empty($start)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1335</span></td>
       <td><span class="missed code">    $start = intval(date('Y', REQUEST_TIME) - 3);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1336</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1337</span></td>
       <td><span class="missed code">  if (empty($end)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1338</span></td>
       <td><span class="missed code">    $end = intval(date('Y', REQUEST_TIME) + 3);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1339</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1340</span></td>
       <td><span class="missed code">  $none = array(0 =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1341</span></td>
       <td><span class="missed code">  return !$required ? $none + drupal_map_assoc(range($start, $end)) : drupal_map_assoc(range($start, $end));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1342</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1343</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1344</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1345</span></td>
       <td><span class="comment code"> * Constructs an array of days in a month.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1346</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1347</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1348</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1349</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1350</span></td>
       <td><span class="comment code"> * @param int $month
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1351</span></td>
       <td><span class="comment code"> *   (optional) The month in which to find the number of days.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1352</span></td>
       <td><span class="comment code"> * @param int $year
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1353</span></td>
       <td><span class="comment code"> *   (optional) The year in which to find the number of days.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1354</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1355</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1356</span></td>
       <td><span class="comment code"> *   An array of days for the selected month.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1357</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1358</span></td>
       <td><span class="covered code">function date_days($required = FALSE, $month = NULL, $year = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1359</span></td>
       <td><span class="comment code">  // If we have a month and year, find the right last day of the month.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1360</span></td>
       <td><span class="missed code">  if (!empty($month) &amp;&amp; !empty($year)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1361</span></td>
       <td><span class="missed code">    $date = new DateObject($year . '-' . $month . '-01 00:00:00', 'UTC');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1362</span></td>
       <td><span class="missed code">    $max = $date-&gt;format('t');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1363</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1364</span></td>
       <td><span class="comment code">  // If there is no month and year given, default to 31.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1365</span></td>
       <td><span class="missed code">  if (empty($max)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1366</span></td>
       <td><span class="missed code">    $max = 31;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1367</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1368</span></td>
       <td><span class="missed code">  $none = array(0 =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1369</span></td>
       <td><span class="missed code">  return !$required ? $none + drupal_map_assoc(range(1, $max)) : drupal_map_assoc(range(1, $max));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1370</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1371</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1372</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1373</span></td>
       <td><span class="comment code"> * Constructs an array of hours.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1374</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1375</span></td>
       <td><span class="comment code"> * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1376</span></td>
       <td><span class="comment code"> *   A date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1377</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1378</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1379</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1380</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1381</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1382</span></td>
       <td><span class="comment code"> *   An array of hours in the selected format.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1383</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1384</span></td>
       <td><span class="covered code">function date_hours($format = 'H', $required = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1385</span></td>
       <td><span class="missed code">  $hours = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1386</span></td>
       <td><span class="missed code">  if ($format == 'h' || $format == 'g') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1387</span></td>
       <td><span class="missed code">    $min = 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1388</span></td>
       <td><span class="missed code">    $max = 12;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1389</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1390</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1391</span></td>
       <td><span class="missed code">    $min = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1392</span></td>
       <td><span class="missed code">    $max = 23;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1393</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1394</span></td>
       <td><span class="missed code">  for ($i = $min; $i &lt;= $max; $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1395</span></td>
       <td><span class="missed code">    $hours[$i] = $i &lt; 10 &amp;&amp; ($format == 'H' || $format == 'h') ? &quot;0$i&quot; : $i;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1396</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1397</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1398</span></td>
       <td><span class="missed code">  return !$required ? $none + $hours : $hours;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1399</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1400</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1401</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1402</span></td>
       <td><span class="comment code"> * Constructs an array of minutes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1403</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1404</span></td>
       <td><span class="comment code"> * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1405</span></td>
       <td><span class="comment code"> *   A date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1406</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1407</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1408</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1409</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1410</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1411</span></td>
       <td><span class="comment code"> *   An array of minutes in the selected format.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1412</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1413</span></td>
       <td><span class="covered code">function date_minutes($format = 'i', $required = FALSE, $increment = 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1414</span></td>
       <td><span class="missed code">  $minutes = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1415</span></td>
       <td><span class="comment code">  // Ensure $increment has a value so we don't loop endlessly.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1416</span></td>
       <td><span class="missed code">  if (empty($increment)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1417</span></td>
       <td><span class="missed code">    $increment = 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1418</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1419</span></td>
       <td><span class="missed code">  for ($i = 0; $i &lt; 60; $i += $increment) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1420</span></td>
       <td><span class="missed code">    $minutes[$i] = $i &lt; 10 &amp;&amp; $format == 'i' ? &quot;0$i&quot; : $i;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1421</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1422</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1423</span></td>
       <td><span class="missed code">  return !$required ? $none + $minutes : $minutes;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1424</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1425</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1426</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1427</span></td>
       <td><span class="comment code"> * Constructs an array of seconds.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1428</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1429</span></td>
       <td><span class="comment code"> * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1430</span></td>
       <td><span class="comment code"> *   A date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1431</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1432</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1433</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1434</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1435</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1436</span></td>
       <td><span class="comment code"> *   An array of seconds in the selected format.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1437</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1438</span></td>
       <td><span class="covered code">function date_seconds($format = 's', $required = FALSE, $increment = 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1439</span></td>
       <td><span class="missed code">  $seconds = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1440</span></td>
       <td><span class="comment code">  // Ensure $increment has a value so we don't loop endlessly.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1441</span></td>
       <td><span class="missed code">  if (empty($increment)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1442</span></td>
       <td><span class="missed code">    $increment = 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1443</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1444</span></td>
       <td><span class="missed code">  for ($i = 0; $i &lt; 60; $i += $increment) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1445</span></td>
       <td><span class="missed code">    $seconds[$i] = $i &lt; 10 &amp;&amp; $format == 's' ? &quot;0$i&quot; : $i;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1446</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1447</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1448</span></td>
       <td><span class="missed code">  return !$required ? $none + $seconds : $seconds;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1449</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1450</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1451</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1452</span></td>
       <td><span class="comment code"> * Constructs an array of AM and PM options.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1453</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1454</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1455</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1456</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1457</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1458</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1459</span></td>
       <td><span class="comment code"> *   An array of AM and PM options.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1460</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1461</span></td>
       <td><span class="covered code">function date_ampm($required = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1462</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1463</span></td>
       <td><span class="comment code">  $ampm = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1464</span></td>
       <td><span class="missed code">    'am' =&gt; t('am', array(), array('context' =&gt; 'ampm')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1465</span></td>
       <td><span class="missed code">    'pm' =&gt; t('pm', array(), array('context' =&gt; 'ampm')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1466</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1467</span></td>
       <td><span class="missed code">  return !$required ? $none + $ampm : $ampm;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1468</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1469</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1470</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1471</span></td>
       <td><span class="comment code"> * Constructs an array of regex replacement strings for date format elements.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1472</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1473</span></td>
       <td><span class="comment code"> * @param bool $strict
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1474</span></td>
       <td><span class="comment code"> *   Whether or not to force 2 digits for elements that sometimes allow either
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1475</span></td>
       <td><span class="comment code"> *   1 or 2 digits.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1476</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1477</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1478</span></td>
       <td><span class="comment code"> *   An array of date() format letters and their regex equivalents.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1479</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1480</span></td>
       <td><span class="covered code">function date_format_patterns($strict = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1481</span></td>
       <td><span class="comment code">  return array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1482</span></td>
       <td><span class="missed code">    'd' =&gt; '\d{' . ($strict ? '2' : '1,2') . '}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1483</span></td>
       <td><span class="missed code">    'm' =&gt; '\d{' . ($strict ? '2' : '1,2') . '}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1484</span></td>
       <td><span class="missed code">    'h' =&gt; '\d{' . ($strict ? '2' : '1,2') . '}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1485</span></td>
       <td><span class="missed code">    'H' =&gt; '\d{' . ($strict ? '2' : '1,2') . '}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1486</span></td>
       <td><span class="missed code">    'i' =&gt; '\d{' . ($strict ? '2' : '1,2') . '}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1487</span></td>
       <td><span class="missed code">    's' =&gt; '\d{' . ($strict ? '2' : '1,2') . '}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1488</span></td>
       <td><span class="missed code">    'j' =&gt; '\d{1,2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1489</span></td>
       <td><span class="missed code">    'N' =&gt; '\d',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1490</span></td>
       <td><span class="missed code">    'S' =&gt; '\w{2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1491</span></td>
       <td><span class="missed code">    'w' =&gt; '\d',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1492</span></td>
       <td><span class="missed code">    'z' =&gt; '\d{1,3}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1493</span></td>
       <td><span class="missed code">    'W' =&gt; '\d{1,2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1494</span></td>
       <td><span class="missed code">    'n' =&gt; '\d{1,2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1495</span></td>
       <td><span class="missed code">    't' =&gt; '\d{2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1496</span></td>
       <td><span class="missed code">    'L' =&gt; '\d',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1497</span></td>
       <td><span class="missed code">    'o' =&gt; '\d{4}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1498</span></td>
       <td><span class="missed code">    'Y' =&gt; '-?\d{1,6}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1499</span></td>
       <td><span class="missed code">    'y' =&gt; '\d{2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1500</span></td>
       <td><span class="missed code">    'B' =&gt; '\d{3}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1501</span></td>
       <td><span class="missed code">    'g' =&gt; '\d{1,2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1502</span></td>
       <td><span class="missed code">    'G' =&gt; '\d{1,2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1503</span></td>
       <td><span class="missed code">    'e' =&gt; '\w*',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1504</span></td>
       <td><span class="missed code">    'I' =&gt; '\d',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1505</span></td>
       <td><span class="missed code">    'T' =&gt; '\w*',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1506</span></td>
       <td><span class="missed code">    'U' =&gt; '\d*',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1507</span></td>
       <td><span class="missed code">    'z' =&gt; '[+-]?\d*',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1508</span></td>
       <td><span class="missed code">    'O' =&gt; '[+-]?\d{4}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1509</span></td>
       <td><span class="comment code">    // Using S instead of w and 3 as well as 4 to pick up non-ASCII chars like
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1510</span></td>
       <td><span class="comment code">    // German umlaut. Per http://drupal.org/node/1101284, we may need as little
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1511</span></td>
       <td><span class="comment code">    // as 2 and as many as 5 characters in some languages.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1512</span></td>
       <td><span class="missed code">    'D' =&gt; '\S{2,5}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1513</span></td>
       <td><span class="missed code">    'l' =&gt; '\S*',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1514</span></td>
       <td><span class="missed code">    'M' =&gt; '\S{2,5}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1515</span></td>
       <td><span class="missed code">    'F' =&gt; '\S*',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1516</span></td>
       <td><span class="missed code">    'P' =&gt; '[+-]?\d{2}\:\d{2}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1517</span></td>
       <td><span class="missed code">    'O' =&gt; '[+-]\d{4}',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1518</span></td>
       <td><span class="missed code">    'c' =&gt; '(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})([+-]?\d{2}\:\d{2})',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1519</span></td>
       <td><span class="missed code">    'r' =&gt; '(\w{3}), (\d{2})\s(\w{3})\s(\d{2,4})\s(\d{2}):(\d{2}):(\d{2})([+-]?\d{4})?',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1520</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1521</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1522</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1523</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1524</span></td>
       <td><span class="comment code"> * Constructs an array of granularity options and their labels.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1525</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1526</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1527</span></td>
       <td><span class="comment code"> *   An array of translated date parts, keyed by their machine name.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1528</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1529</span></td>
       <td><span class="covered code">function date_granularity_names() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1530</span></td>
       <td><span class="comment code">  return array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1531</span></td>
       <td><span class="missed code">    'year' =&gt; t('Year', array(), array('context' =&gt; 'datetime')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1532</span></td>
       <td><span class="missed code">    'month' =&gt; t('Month', array(), array('context' =&gt; 'datetime')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1533</span></td>
       <td><span class="missed code">    'day' =&gt; t('Day', array(), array('context' =&gt; 'datetime')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1534</span></td>
       <td><span class="missed code">    'hour' =&gt; t('Hour', array(), array('context' =&gt; 'datetime')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1535</span></td>
       <td><span class="missed code">    'minute' =&gt; t('Minute', array(), array('context' =&gt; 'datetime')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1536</span></td>
       <td><span class="missed code">    'second' =&gt; t('Second', array(), array('context' =&gt; 'datetime')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1537</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1538</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1539</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1540</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1541</span></td>
       <td><span class="comment code"> * Sorts a granularity array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1542</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1543</span></td>
       <td><span class="comment code"> * @param array $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1544</span></td>
       <td><span class="comment code"> *   An array of date parts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1545</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1546</span></td>
       <td><span class="covered code">function date_granularity_sorted($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1547</span></td>
       <td><span class="missed code">  return array_intersect(array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1548</span></td>
       <td><span class="missed code">    'year',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1549</span></td>
       <td><span class="missed code">    'month',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1550</span></td>
       <td><span class="missed code">    'day',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1551</span></td>
       <td><span class="missed code">    'hour',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1552</span></td>
       <td><span class="missed code">    'minute',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1553</span></td>
       <td><span class="missed code">    'second',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1554</span></td>
       <td><span class="missed code">  ), $granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1555</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1556</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1557</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1558</span></td>
       <td><span class="comment code"> * Constructs an array of granularity based on a given precision.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1559</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1560</span></td>
       <td><span class="comment code"> * @param string $precision
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1561</span></td>
       <td><span class="comment code"> *   A granularity item.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1562</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1563</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1564</span></td>
       <td><span class="comment code"> *   A granularity array containing the given precision and all those above it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1565</span></td>
       <td><span class="comment code"> *   For example, passing in 'month' will return array('year', 'month').
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1566</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1567</span></td>
       <td><span class="covered code">function date_granularity_array_from_precision($precision) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1568</span></td>
       <td><span class="missed code">  $granularity_array = array('year', 'month', 'day', 'hour', 'minute', 'second');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1569</span></td>
       <td><span class="comment code">  switch ($precision) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1570</span></td>
       <td><span class="missed code">    case 'year':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1571</span></td>
       <td><span class="missed code">      return array_slice($granularity_array, -6, 1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1572</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1573</span></td>
       <td><span class="missed code">    case 'month':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1574</span></td>
       <td><span class="missed code">      return array_slice($granularity_array, -6, 2);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1575</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1576</span></td>
       <td><span class="missed code">    case 'day':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1577</span></td>
       <td><span class="missed code">      return array_slice($granularity_array, -6, 3);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1578</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1579</span></td>
       <td><span class="missed code">    case 'hour':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1580</span></td>
       <td><span class="missed code">      return array_slice($granularity_array, -6, 4);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1581</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1582</span></td>
       <td><span class="missed code">    case 'minute':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1583</span></td>
       <td><span class="missed code">      return array_slice($granularity_array, -6, 5);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1584</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1585</span></td>
       <td><span class="missed code">    default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1586</span></td>
       <td><span class="missed code">      return $granularity_array;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1587</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1588</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1589</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1590</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1591</span></td>
       <td><span class="comment code"> * Give a granularity array, return the highest precision.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1592</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1593</span></td>
       <td><span class="comment code"> * @param array $granularity_array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1594</span></td>
       <td><span class="comment code"> *   An array of date parts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1595</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1596</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1597</span></td>
       <td><span class="comment code"> *   The most precise element in a granularity array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1598</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1599</span></td>
       <td><span class="covered code">function date_granularity_precision($granularity_array) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1600</span></td>
       <td><span class="missed code">  $input = date_granularity_sorted($granularity_array);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1601</span></td>
       <td><span class="missed code">  return array_pop($input);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1602</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1603</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1604</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1605</span></td>
       <td><span class="comment code"> * Constructs a valid DATETIME format string for the granularity of an item.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1606</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1607</span></td>
       <td><span class="comment code"> * @todo This function is no longer used as of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1608</span></td>
       <td><span class="comment code"> * http://drupalcode.org/project/date.git/commit/07efbb5.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1609</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1610</span></td>
       <td><span class="covered code">function date_granularity_format($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1611</span></td>
       <td><span class="missed code">  if (is_array($granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1612</span></td>
       <td><span class="missed code">    $granularity = date_granularity_precision($granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1613</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1614</span></td>
       <td><span class="missed code">  $format = 'Y-m-d H:i:s';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1615</span></td>
       <td><span class="comment code">  switch ($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1616</span></td>
       <td><span class="missed code">    case 'year':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1617</span></td>
       <td><span class="missed code">      return substr($format, 0, 1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1618</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1619</span></td>
       <td><span class="missed code">    case 'month':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1620</span></td>
       <td><span class="missed code">      return substr($format, 0, 3);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1621</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1622</span></td>
       <td><span class="missed code">    case 'day':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1623</span></td>
       <td><span class="missed code">      return substr($format, 0, 5);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1624</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1625</span></td>
       <td><span class="missed code">    case 'hour';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1626</span></td>
       <td><span class="missed code">      return substr($format, 0, 7);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1627</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1628</span></td>
       <td><span class="missed code">    case 'minute':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1629</span></td>
       <td><span class="missed code">      return substr($format, 0, 9);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1630</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1631</span></td>
       <td><span class="missed code">    default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1632</span></td>
       <td><span class="missed code">      return $format;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1633</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1634</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1635</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1636</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1637</span></td>
       <td><span class="comment code"> * Returns a translated array of timezone names.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1638</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1639</span></td>
       <td><span class="comment code"> * Cache the untranslated array, make the translated array a static variable.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1640</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1641</span></td>
       <td><span class="comment code"> * @param bool $required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1642</span></td>
       <td><span class="comment code"> *   (optional) If FALSE, the returned array will include a blank value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1643</span></td>
       <td><span class="comment code"> *   Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1644</span></td>
       <td><span class="comment code"> * @param bool $refresh
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1645</span></td>
       <td><span class="comment code"> *   (optional) Whether to refresh the list. Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1646</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1647</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1648</span></td>
       <td><span class="comment code"> *   An array of timezone names.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1649</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1650</span></td>
       <td><span class="covered code">function date_timezone_names($required = FALSE, $refresh = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1651</span></td>
       <td><span class="missed code">  static $zonenames;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1652</span></td>
       <td><span class="missed code">  if (empty($zonenames) || $refresh) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1653</span></td>
       <td><span class="missed code">    $cached = cache_get('date_timezone_identifiers_list');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1654</span></td>
       <td><span class="missed code">    $zonenames = !empty($cached) ? $cached-&gt;data : array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1655</span></td>
       <td><span class="missed code">    if ($refresh || empty($cached) || empty($zonenames)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1656</span></td>
       <td><span class="missed code">      $data = timezone_identifiers_list();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1657</span></td>
       <td><span class="missed code">      asort($data);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1658</span></td>
       <td><span class="missed code">      foreach ($data as $delta =&gt; $zone) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1659</span></td>
       <td><span class="comment code">        // Because many timezones exist in PHP only for backward compatibility
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1660</span></td>
       <td><span class="comment code">        // reasons and should not be used, the list is filtered by a regular
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1661</span></td>
       <td><span class="comment code">        // expression.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1662</span></td>
       <td><span class="missed code">        if (preg_match('!^((Africa|America|Antarctica|Arctic|Asia|Atlantic|Australia|Europe|Indian|Pacific)/|UTC$)!', $zone)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1663</span></td>
       <td><span class="missed code">          $zonenames[$zone] = $zone;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1664</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1665</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1666</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1667</span></td>
       <td><span class="missed code">      if (!empty($zonenames)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1668</span></td>
       <td><span class="missed code">        cache_set('date_timezone_identifiers_list', $zonenames);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1669</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1670</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1671</span></td>
       <td><span class="missed code">    foreach ($zonenames as $zone) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1672</span></td>
       <td><span class="missed code">      $zonenames[$zone] = t('!timezone', array('!timezone' =&gt; t($zone)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1673</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1674</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1675</span></td>
       <td><span class="missed code">  $none = array('' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1676</span></td>
       <td><span class="missed code">  return !$required ? $none + $zonenames : $zonenames;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1677</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1678</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1679</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1680</span></td>
       <td><span class="comment code"> * Returns an array of system-allowed timezone abbreviations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1681</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1682</span></td>
       <td><span class="comment code"> * Cache an array of just the abbreviation names because the whole
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1683</span></td>
       <td><span class="comment code"> * timezone_abbreviations_list() is huge, so we don't want to retrieve it more
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1684</span></td>
       <td><span class="comment code"> * than necessary.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1685</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1686</span></td>
       <td><span class="comment code"> * @param bool $refresh
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1687</span></td>
       <td><span class="comment code"> *   (optional) Whether to refresh the list. Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1688</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1689</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1690</span></td>
       <td><span class="comment code"> *   An array of allowed timezone abbreviations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1691</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1692</span></td>
       <td><span class="covered code">function date_timezone_abbr($refresh = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1693</span></td>
       <td><span class="missed code">  $cached = cache_get('date_timezone_abbreviations');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1694</span></td>
       <td><span class="missed code">  $data = isset($cached-&gt;data) ? $cached-&gt;data : array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1695</span></td>
       <td><span class="missed code">  if (empty($data) || $refresh) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1696</span></td>
       <td><span class="missed code">    $data = array_keys(timezone_abbreviations_list());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1697</span></td>
       <td><span class="missed code">    cache_set('date_timezone_abbreviations', $data);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1698</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1699</span></td>
       <td><span class="missed code">  return $data;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1700</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1701</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1702</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1703</span></td>
       <td><span class="comment code"> * Formats a date, using a date type or a custom date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1704</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1705</span></td>
       <td><span class="comment code"> * Reworked from Drupal's format_date function to handle pre-1970 and
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1706</span></td>
       <td><span class="comment code"> * post-2038 dates and accept a date object instead of a timestamp as input.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1707</span></td>
       <td><span class="comment code"> * Translates formatted date results, unlike PHP function date_format().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1708</span></td>
       <td><span class="comment code"> * Should only be used for display, not input, because it can't be parsed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1709</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1710</span></td>
       <td><span class="comment code"> * @param object $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1711</span></td>
       <td><span class="comment code"> *   A date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1712</span></td>
       <td><span class="comment code"> * @param string $type
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1713</span></td>
       <td><span class="comment code"> *   (optional) The date format to use. Can be 'small', 'medium' or 'large' for
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1714</span></td>
       <td><span class="comment code"> *   the preconfigured date formats. If 'custom' is specified, then $format is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1715</span></td>
       <td><span class="comment code"> *   required as well. Defaults to 'medium'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1716</span></td>
       <td><span class="comment code"> * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1717</span></td>
       <td><span class="comment code"> *   (optional) A PHP date format string as required by date(). A backslash
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1718</span></td>
       <td><span class="comment code"> *   should be used before a character to avoid interpreting the character as
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1719</span></td>
       <td><span class="comment code"> *   part of a date format. Defaults to an empty string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1720</span></td>
       <td><span class="comment code"> * @param string $langcode
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1721</span></td>
       <td><span class="comment code"> *   (optional) Language code to translate to. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1722</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1723</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1724</span></td>
       <td><span class="comment code"> *   A translated date string in the requested format.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1725</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1726</span></td>
       <td><span class="comment code"> * @see format_date()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1727</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1728</span></td>
       <td><span class="covered code">function date_format_date($date, $type = 'medium', $format = '', $langcode = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1729</span></td>
       <td><span class="missed code">  if (empty($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1730</span></td>
       <td><span class="missed code">    return '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1731</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1732</span></td>
       <td><span class="missed code">  if ($type != 'custom') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1733</span></td>
       <td><span class="missed code">    $format = variable_get('date_format_' . $type);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1734</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1735</span></td>
       <td><span class="missed code">  if ($type != 'custom' &amp;&amp; empty($format)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1736</span></td>
       <td><span class="missed code">    $format = variable_get('date_format_medium', 'D, m/d/Y - H:i');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1737</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1738</span></td>
       <td><span class="missed code">  $format = date_limit_format($format, $date-&gt;granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1739</span></td>
       <td><span class="missed code">  $max = strlen($format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1740</span></td>
       <td><span class="missed code">  $datestring = '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1741</span></td>
       <td><span class="missed code">  for ($i = 0; $i &lt; $max; $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1742</span></td>
       <td><span class="missed code">    $c = $format[$i];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1743</span></td>
       <td><span class="comment code">    switch ($c) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1744</span></td>
       <td><span class="missed code">      case 'l':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1745</span></td>
       <td><span class="missed code">        $datestring .= t($date-&gt;format('l'), array(), array('context' =&gt; '', 'langcode' =&gt; $langcode));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1746</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1747</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1748</span></td>
       <td><span class="missed code">      case 'D':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1749</span></td>
       <td><span class="missed code">        $datestring .= t($date-&gt;format('D'), array(), array('context' =&gt; '', 'langcode' =&gt; $langcode));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1750</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1751</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1752</span></td>
       <td><span class="missed code">      case 'F':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1753</span></td>
       <td><span class="missed code">        $datestring .= t($date-&gt;format('F'), array(), array('context' =&gt; 'Long month name', 'langcode' =&gt; $langcode));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1754</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1755</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1756</span></td>
       <td><span class="missed code">      case 'M':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1757</span></td>
       <td><span class="missed code">        $datestring .= t($date-&gt;format('M'), array(), array('langcode' =&gt; $langcode));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1758</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1759</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1760</span></td>
       <td><span class="missed code">      case 'A':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1761</span></td>
       <td><span class="missed code">      case 'a':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1762</span></td>
       <td><span class="missed code">        $datestring .= t($date-&gt;format($c), array(), array('context' =&gt; 'ampm', 'langcode' =&gt; $langcode));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1763</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1764</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1765</span></td>
       <td><span class="comment code">      // The timezone name translations can use t().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1766</span></td>
       <td><span class="missed code">      case 'e':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1767</span></td>
       <td><span class="missed code">      case 'T':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1768</span></td>
       <td><span class="missed code">        $datestring .= t($date-&gt;format($c));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1769</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1770</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1771</span></td>
       <td><span class="comment code">      // Remaining date parts need no translation.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1772</span></td>
       <td><span class="missed code">      case 'O':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1773</span></td>
       <td><span class="missed code">        $datestring .= sprintf('%s%02d%02d', (date_offset_get($date) &lt; 0 ? '-' : '+'), abs(date_offset_get($date) / 3600), abs(date_offset_get($date) % 3600) / 60);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1774</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1775</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1776</span></td>
       <td><span class="missed code">      case 'P':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1777</span></td>
       <td><span class="missed code">        $datestring .= sprintf('%s%02d:%02d', (date_offset_get($date) &lt; 0 ? '-' : '+'), abs(date_offset_get($date) / 3600), abs(date_offset_get($date) % 3600) / 60);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1778</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1779</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1780</span></td>
       <td><span class="missed code">      case 'Z':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1781</span></td>
       <td><span class="missed code">        $datestring .= date_offset_get($date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1782</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1783</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1784</span></td>
       <td><span class="missed code">      case '\\':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1785</span></td>
       <td><span class="missed code">        $datestring .= $format[++$i];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1786</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1787</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1788</span></td>
       <td><span class="missed code">      case 'r':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1789</span></td>
       <td><span class="missed code">        $datestring .= date_format_date($date, 'custom', 'D, d M Y H:i:s O', 'en');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1790</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1791</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1792</span></td>
       <td><span class="missed code">      default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1793</span></td>
       <td><span class="missed code">        if (strpos('BdcgGhHiIjLmnNosStTuUwWYyz', $c) !== FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1794</span></td>
       <td><span class="missed code">          $datestring .= $date-&gt;format($c);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1795</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1796</span></td>
       <td><span class="comment code">        else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1797</span></td>
       <td><span class="missed code">          $datestring .= $c;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1798</span></td>
       <td><span class="comment code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1799</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1800</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1801</span></td>
       <td><span class="missed code">  return $datestring;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1802</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1803</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1804</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1805</span></td>
       <td><span class="comment code"> * Formats a time interval with granularity, including past and future context.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1806</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1807</span></td>
       <td><span class="comment code"> * @param object $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1808</span></td>
       <td><span class="comment code"> *   The current date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1809</span></td>
       <td><span class="comment code"> * @param int $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1810</span></td>
       <td><span class="comment code"> *   (optional) Number of units to display in the string. Defaults to 2.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1811</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1812</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1813</span></td>
       <td><span class="comment code"> *   A translated string representation of the interval.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1814</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1815</span></td>
       <td><span class="comment code"> * @see format_interval()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1816</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1817</span></td>
       <td><span class="covered code">function date_format_interval($date, $granularity = 2, $display_ago = TRUE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1818</span></td>
       <td><span class="comment code">  // If no date is sent, then return nothing.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1819</span></td>
       <td><span class="missed code">  if (empty($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1820</span></td>
       <td><span class="missed code">    return NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1821</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1822</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1823</span></td>
       <td><span class="missed code">  $interval = REQUEST_TIME - $date-&gt;format('U');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1824</span></td>
       <td><span class="missed code">  if ($interval &gt; 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1825</span></td>
       <td><span class="missed code">    return $display_ago ? t('!time ago', array('!time' =&gt; format_interval($interval, $granularity))) :
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1826</span></td>
       <td><span class="missed code">      t('!time', array('!time' =&gt; format_interval($interval, $granularity)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1827</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1828</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1829</span></td>
       <td><span class="missed code">    return format_interval(abs($interval), $granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1830</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1831</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1832</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1833</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1834</span></td>
       <td><span class="comment code"> * A date object for the current time.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1835</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1836</span></td>
       <td><span class="comment code"> * @param object $timezone
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1837</span></td>
       <td><span class="comment code"> *   (optional) Optionally force time to a specific timezone, defaults to user
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1838</span></td>
       <td><span class="comment code"> *   timezone, if set, otherwise site timezone. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1839</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1840</span></td>
       <td><span class="comment code"> * @param bool $reset
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1841</span></td>
       <td><span class="comment code"> *   (optional) Static cache reset.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1842</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1843</span></td>
       <td><span class="comment code"> * @return object
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1844</span></td>
       <td><span class="comment code"> *   The current time as a date object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1845</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1846</span></td>
       <td><span class="covered code">function date_now($timezone = NULL, $reset = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1847</span></td>
       <td><span class="missed code">  if ($reset) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1848</span></td>
       <td><span class="missed code">    drupal_static_reset(__FUNCTION__ . $timezone);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1849</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1850</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1851</span></td>
       <td><span class="missed code">  $now = &amp;drupal_static(__FUNCTION__ . $timezone);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1852</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1853</span></td>
       <td><span class="missed code">  if (!isset($now)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1854</span></td>
       <td><span class="missed code">    $now = new DateObject('now', $timezone);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1855</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1856</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1857</span></td>
       <td><span class="comment code">  // Avoid unexpected manipulation of cached $now object
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1858</span></td>
       <td><span class="comment code">  // by subsequent code execution
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1859</span></td>
       <td><span class="comment code">  // @see https://drupal.org/node/2261395
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1860</span></td>
       <td><span class="missed code">  $clone = clone $now;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1861</span></td>
       <td><span class="missed code">  return $clone;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1862</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1863</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1864</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1865</span></td>
       <td><span class="comment code"> * Determines if a timezone string is valid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1866</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1867</span></td>
       <td><span class="comment code"> * @param string $timezone
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1868</span></td>
       <td><span class="comment code"> *   A potentially invalid timezone string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1869</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1870</span></td>
       <td><span class="comment code"> * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1871</span></td>
       <td><span class="comment code"> *   TRUE if the timezone is valid, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1872</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1873</span></td>
       <td><span class="covered code">function date_timezone_is_valid($timezone) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1874</span></td>
       <td><span class="missed code">  static $timezone_names;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1875</span></td>
       <td><span class="missed code">  if (empty($timezone_names)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1876</span></td>
       <td><span class="missed code">    $timezone_names = array_keys(date_timezone_names(TRUE));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1877</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1878</span></td>
       <td><span class="missed code">  return in_array($timezone, $timezone_names);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1879</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1880</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1881</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1882</span></td>
       <td><span class="comment code"> * Returns a timezone name to use as a default.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1883</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1884</span></td>
       <td><span class="comment code"> * @param bool $check_user
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1885</span></td>
       <td><span class="comment code"> *   (optional) Whether or not to check for a user-configured timezone.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1886</span></td>
       <td><span class="comment code"> *   Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1887</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1888</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1889</span></td>
       <td><span class="comment code"> *   The default timezone for a user, if available, otherwise the site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1890</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1891</span></td>
       <td><span class="covered code">function date_default_timezone($check_user = TRUE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1892</span></td>
       <td><span class="missed code">  global $user;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1893</span></td>
       <td><span class="missed code">  if ($check_user &amp;&amp; variable_get('configurable_timezones', 1) &amp;&amp; !empty($user-&gt;timezone)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1894</span></td>
       <td><span class="missed code">    return $user-&gt;timezone;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1895</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1896</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1897</span></td>
       <td><span class="missed code">    $default = variable_get('date_default_timezone', '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1898</span></td>
       <td><span class="missed code">    return empty($default) ? 'UTC' : $default;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1899</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1900</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1901</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1902</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1903</span></td>
       <td><span class="comment code"> * Returns a timezone object for the default timezone.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1904</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1905</span></td>
       <td><span class="comment code"> * @param bool $check_user
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1906</span></td>
       <td><span class="comment code"> *   (optional) Whether or not to check for a user-configured timezone.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1907</span></td>
       <td><span class="comment code"> *   Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1908</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1909</span></td>
       <td><span class="comment code"> * @return object
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1910</span></td>
       <td><span class="comment code"> *   The default timezone for a user, if available, otherwise the site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1911</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1912</span></td>
       <td><span class="covered code">function date_default_timezone_object($check_user = TRUE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1913</span></td>
       <td><span class="missed code">  return timezone_open(date_default_timezone($check_user));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1914</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1915</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1916</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1917</span></td>
       <td><span class="comment code"> * Identifies the number of days in a month for a date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1918</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1919</span></td>
       <td><span class="covered code">function date_days_in_month($year, $month) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1920</span></td>
       <td><span class="comment code">  // Pick a day in the middle of the month to avoid timezone shifts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1921</span></td>
       <td><span class="missed code">  $datetime = date_pad($year, 4) . '-' . date_pad($month) . '-15 00:00:00';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1922</span></td>
       <td><span class="missed code">  $date = new DateObject($datetime);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1923</span></td>
       <td><span class="missed code">  return $date-&gt;format('t');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1924</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1925</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1926</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1927</span></td>
       <td><span class="comment code"> * Identifies the number of days in a year for a date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1928</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1929</span></td>
       <td><span class="comment code"> * @param mixed $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1930</span></td>
       <td><span class="comment code"> *   (optional) The current date object, or a date string. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1931</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1932</span></td>
       <td><span class="comment code"> * @return int
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1933</span></td>
       <td><span class="comment code"> *   The number of days in the year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1934</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1935</span></td>
       <td><span class="covered code">function date_days_in_year($date = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1936</span></td>
       <td><span class="missed code">  if (empty($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1937</span></td>
       <td><span class="missed code">    $date = date_now();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1938</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1939</span></td>
       <td><span class="missed code">  elseif (!is_object($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1940</span></td>
       <td><span class="missed code">    $date = new DateObject($date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1941</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1942</span></td>
       <td><span class="missed code">  if (is_object($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1943</span></td>
       <td><span class="missed code">    if ($date-&gt;format('L')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1944</span></td>
       <td><span class="missed code">      return 366;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1945</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1946</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1947</span></td>
       <td><span class="missed code">      return 365;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1948</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1949</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1950</span></td>
       <td><span class="missed code">  return NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1951</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1952</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1953</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1954</span></td>
       <td><span class="comment code"> * Identifies the number of ISO weeks in a year for a date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1955</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1956</span></td>
       <td><span class="comment code"> * December 28 is always in the last ISO week of the year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1957</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1958</span></td>
       <td><span class="comment code"> * @param mixed $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1959</span></td>
       <td><span class="comment code"> *   (optional) The current date object, or a date string. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1960</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1961</span></td>
       <td><span class="comment code"> * @return int
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1962</span></td>
       <td><span class="comment code"> *   The number of ISO weeks in a year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1963</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1964</span></td>
       <td><span class="covered code">function date_iso_weeks_in_year($date = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1965</span></td>
       <td><span class="missed code">  if (empty($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1966</span></td>
       <td><span class="missed code">    $date = date_now();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1967</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1968</span></td>
       <td><span class="missed code">  elseif (!is_object($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1969</span></td>
       <td><span class="missed code">    $date = new DateObject($date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1970</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1971</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1972</span></td>
       <td><span class="missed code">  if (is_object($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1973</span></td>
       <td><span class="missed code">    date_date_set($date, $date-&gt;format('Y'), 12, 28);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1974</span></td>
       <td><span class="missed code">    return $date-&gt;format('W');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1975</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1976</span></td>
       <td><span class="missed code">  return NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1977</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1978</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1979</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1980</span></td>
       <td><span class="comment code"> * Returns day of week for a given date (0 = Sunday).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1981</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1982</span></td>
       <td><span class="comment code"> * @param mixed $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1983</span></td>
       <td><span class="comment code"> *   (optional) A date, default is current local day. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1984</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1985</span></td>
       <td><span class="comment code"> * @return int
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1986</span></td>
       <td><span class="comment code"> *   The number of the day in the week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1987</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1988</span></td>
       <td><span class="covered code">function date_day_of_week($date = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1989</span></td>
       <td><span class="missed code">  if (empty($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1990</span></td>
       <td><span class="missed code">    $date = date_now();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1991</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1992</span></td>
       <td><span class="missed code">  elseif (!is_object($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1993</span></td>
       <td><span class="missed code">    $date = new DateObject($date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1994</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1995</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1996</span></td>
       <td><span class="missed code">  if (is_object($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1997</span></td>
       <td><span class="missed code">    return $date-&gt;format('w');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1998</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1999</span></td>
       <td><span class="missed code">  return NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2000</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2001</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2002</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2003</span></td>
       <td><span class="comment code"> * Returns translated name of the day of week for a given date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2004</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2005</span></td>
       <td><span class="comment code"> * @param mixed $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2006</span></td>
       <td><span class="comment code"> *   (optional) A date, default is current local day. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2007</span></td>
       <td><span class="comment code"> * @param string $abbr
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2008</span></td>
       <td><span class="comment code"> *   (optional) Whether to return the abbreviated name for that day.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2009</span></td>
       <td><span class="comment code"> *   Defaults to TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2010</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2011</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2012</span></td>
       <td><span class="comment code"> *   The name of the day in the week for that date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2013</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2014</span></td>
       <td><span class="covered code">function date_day_of_week_name($date = NULL, $abbr = TRUE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2015</span></td>
       <td><span class="missed code">  if (!is_object($date)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2016</span></td>
       <td><span class="missed code">    $date = new DateObject($date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2017</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2018</span></td>
       <td><span class="missed code">  $dow = date_day_of_week($date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2019</span></td>
       <td><span class="missed code">  $days = $abbr ? date_week_days_abbr() : date_week_days();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2020</span></td>
       <td><span class="missed code">  return $days[$dow];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2021</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2022</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2023</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2024</span></td>
       <td><span class="comment code"> * Calculates the start and end dates for a calendar week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2025</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2026</span></td>
       <td><span class="comment code"> * The dates are adjusted to use the chosen first day of week for this site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2027</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2028</span></td>
       <td><span class="comment code"> * @param int $week
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2029</span></td>
       <td><span class="comment code"> *   The week value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2030</span></td>
       <td><span class="comment code"> * @param int $year
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2031</span></td>
       <td><span class="comment code"> *   The year value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2032</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2033</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2034</span></td>
       <td><span class="comment code"> *   A numeric array containing the start and end dates of a week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2035</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2036</span></td>
       <td><span class="covered code">function date_week_range($week, $year) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2037</span></td>
       <td><span class="missed code">  if (variable_get('date_api_use_iso8601', FALSE)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2038</span></td>
       <td><span class="missed code">    return date_iso_week_range($week, $year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2039</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2040</span></td>
       <td><span class="missed code">  $min_date = new DateObject($year . '-01-01 00:00:00');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2041</span></td>
       <td><span class="missed code">  $min_date-&gt;setTimezone(date_default_timezone_object());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2042</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2043</span></td>
       <td><span class="comment code">  // Move to the right week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2044</span></td>
       <td><span class="missed code">  date_modify($min_date, '+' . strval(7 * ($week - 1)) . ' days');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2045</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2046</span></td>
       <td><span class="comment code">  // Move backwards to the first day of the week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2047</span></td>
       <td><span class="missed code">  $first_day = variable_get('date_first_day', 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2048</span></td>
       <td><span class="missed code">  $day_wday = date_format($min_date, 'w');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2049</span></td>
       <td><span class="missed code">  date_modify($min_date, '-' . strval((7 + $day_wday - $first_day) % 7) . ' days');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2050</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2051</span></td>
       <td><span class="comment code">  // Move forwards to the last day of the week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2052</span></td>
       <td><span class="missed code">  $max_date = clone($min_date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2053</span></td>
       <td><span class="missed code">  date_modify($max_date, '+6 days');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2054</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2055</span></td>
       <td><span class="missed code">  if (date_format($min_date, 'Y') != $year) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2056</span></td>
       <td><span class="missed code">    $min_date = new DateObject($year . '-01-01 00:00:00');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2057</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2058</span></td>
       <td><span class="missed code">  return array($min_date, $max_date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2059</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2060</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2061</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2062</span></td>
       <td><span class="comment code"> * Calculates the start and end dates for an ISO week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2063</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2064</span></td>
       <td><span class="comment code"> * @param int $week
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2065</span></td>
       <td><span class="comment code"> *   The week value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2066</span></td>
       <td><span class="comment code"> * @param int $year
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2067</span></td>
       <td><span class="comment code"> *   The year value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2068</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2069</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2070</span></td>
       <td><span class="comment code"> *   A numeric array containing the start and end dates of an ISO week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2071</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2072</span></td>
       <td><span class="covered code">function date_iso_week_range($week, $year) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2073</span></td>
       <td><span class="comment code">  // Get to the last ISO week of the previous year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2074</span></td>
       <td><span class="missed code">  $min_date = new DateObject(($year - 1) . '-12-28 00:00:00');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2075</span></td>
       <td><span class="missed code">  date_timezone_set($min_date, date_default_timezone_object());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2076</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2077</span></td>
       <td><span class="comment code">  // Find the first day of the first ISO week in the year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2078</span></td>
       <td><span class="missed code">  date_modify($min_date, '+1 Monday');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2079</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2080</span></td>
       <td><span class="comment code">  // Jump ahead to the desired week for the beginning of the week range.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2081</span></td>
       <td><span class="missed code">  if ($week &gt; 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2082</span></td>
       <td><span class="missed code">    date_modify($min_date, '+ ' . ($week - 1) . ' weeks');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2083</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2084</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2085</span></td>
       <td><span class="comment code">  // Move forwards to the last day of the week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2086</span></td>
       <td><span class="missed code">  $max_date = clone($min_date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2087</span></td>
       <td><span class="missed code">  date_modify($max_date, '+6 days');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2088</span></td>
       <td><span class="missed code">  return array($min_date, $max_date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2089</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2090</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2091</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2092</span></td>
       <td><span class="comment code"> * The number of calendar weeks in a year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2093</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2094</span></td>
       <td><span class="comment code"> * PHP week functions return the ISO week, not the calendar week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2095</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2096</span></td>
       <td><span class="comment code"> * @param int $year
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2097</span></td>
       <td><span class="comment code"> *   A year value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2098</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2099</span></td>
       <td><span class="comment code"> * @return int
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2100</span></td>
       <td><span class="comment code"> *   Number of calendar weeks in selected year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2101</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2102</span></td>
       <td><span class="covered code">function date_weeks_in_year($year) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2103</span></td>
       <td><span class="missed code">  $date = new DateObject(($year + 1) . '-01-01 12:00:00', 'UTC');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2104</span></td>
       <td><span class="missed code">  date_modify($date, '-1 day');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2105</span></td>
       <td><span class="missed code">  return date_week($date-&gt;format('Y-m-d'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2106</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2107</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2108</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2109</span></td>
       <td><span class="comment code"> * The calendar week number for a date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2110</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2111</span></td>
       <td><span class="comment code"> * PHP week functions return the ISO week, not the calendar week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2112</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2113</span></td>
       <td><span class="comment code"> * @param string $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2114</span></td>
       <td><span class="comment code"> *   A date string in the format Y-m-d.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2115</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2116</span></td>
       <td><span class="comment code"> * @return int
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2117</span></td>
       <td><span class="comment code"> *   The calendar week number.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2118</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2119</span></td>
       <td><span class="covered code">function date_week($date) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2120</span></td>
       <td><span class="missed code">  $date = substr($date, 0, 10);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2121</span></td>
       <td><span class="missed code">  $parts = explode('-', $date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2122</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2123</span></td>
       <td><span class="missed code">  $date = new DateObject($date . ' 12:00:00', 'UTC');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2124</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2125</span></td>
       <td><span class="comment code">  // If we are using ISO weeks, this is easy.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2126</span></td>
       <td><span class="missed code">  if (variable_get('date_api_use_iso8601', FALSE)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2127</span></td>
       <td><span class="missed code">    return intval($date-&gt;format('W'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2128</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2129</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2130</span></td>
       <td><span class="missed code">  $year_date = new DateObject($parts[0] . '-01-01 12:00:00', 'UTC');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2131</span></td>
       <td><span class="missed code">  $week = intval($date-&gt;format('W'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2132</span></td>
       <td><span class="missed code">  $year_week = intval(date_format($year_date, 'W'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2133</span></td>
       <td><span class="missed code">  $date_year = intval($date-&gt;format('o'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2134</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2135</span></td>
       <td><span class="comment code">  // Remove the leap week if it's present.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2136</span></td>
       <td><span class="missed code">  if ($date_year &gt; intval($parts[0])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2137</span></td>
       <td><span class="missed code">    $last_date = clone($date);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2138</span></td>
       <td><span class="missed code">    date_modify($last_date, '-7 days');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2139</span></td>
       <td><span class="missed code">    $week = date_format($last_date, 'W') + 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2140</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2141</span></td>
       <td><span class="missed code">  elseif ($date_year &lt; intval($parts[0])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2142</span></td>
       <td><span class="missed code">    $week = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2143</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2144</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2145</span></td>
       <td><span class="missed code">  if ($year_week != 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2146</span></td>
       <td><span class="missed code">    $week++;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2147</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2148</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2149</span></td>
       <td><span class="comment code">  // Convert to ISO-8601 day number, to match weeks calculated above.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2150</span></td>
       <td><span class="missed code">  $iso_first_day = 1 + (variable_get('date_first_day', 0) + 6) % 7;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2151</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2152</span></td>
       <td><span class="comment code">  // If it's before the starting day, it's the previous week.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2153</span></td>
       <td><span class="missed code">  if (intval($date-&gt;format('N')) &lt; $iso_first_day) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2154</span></td>
       <td><span class="missed code">    $week--;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2155</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2156</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2157</span></td>
       <td><span class="comment code">  // If the year starts before, it's an extra week at the beginning.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2158</span></td>
       <td><span class="missed code">  if (intval(date_format($year_date, 'N')) &lt; $iso_first_day) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2159</span></td>
       <td><span class="missed code">    $week++;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2160</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2161</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2162</span></td>
       <td><span class="missed code">  return $week;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2163</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2164</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2165</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2166</span></td>
       <td><span class="comment code"> * Helper function to left pad date parts with zeros.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2167</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2168</span></td>
       <td><span class="comment code"> * Provided because this is needed so often with dates.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2169</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2170</span></td>
       <td><span class="comment code"> * @param int $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2171</span></td>
       <td><span class="comment code"> *   The value to pad.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2172</span></td>
       <td><span class="comment code"> * @param int $size
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2173</span></td>
       <td><span class="comment code"> *   (optional) Total size expected, usually 2 or 4. Defaults to 2.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2174</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2175</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2176</span></td>
       <td><span class="comment code"> *   The padded value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2177</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2178</span></td>
       <td><span class="covered code">function date_pad($value, $size = 2) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2179</span></td>
       <td><span class="missed code">  return sprintf(&quot;%0&quot; . $size . &quot;d&quot;, $value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2180</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2181</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2182</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2183</span></td>
       <td><span class="comment code"> * Determines if the granularity contains a time portion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2184</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2185</span></td>
       <td><span class="comment code"> * @param array $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2186</span></td>
       <td><span class="comment code"> *   An array of allowed date parts, all others will be removed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2187</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2188</span></td>
       <td><span class="comment code"> * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2189</span></td>
       <td><span class="comment code"> *   TRUE if the granularity contains a time portion, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2190</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2191</span></td>
       <td><span class="covered code">function date_has_time($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2192</span></td>
       <td><span class="missed code">  if (!is_array($granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2193</span></td>
       <td><span class="missed code">    $granularity = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2194</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2195</span></td>
       <td><span class="missed code">  $options = array('hour', 'minute', 'second');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2196</span></td>
       <td><span class="missed code">  return (bool) count(array_intersect($granularity, $options));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2197</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2198</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2199</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2200</span></td>
       <td><span class="comment code"> * Determines if the granularity contains a date portion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2201</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2202</span></td>
       <td><span class="comment code"> * @param array $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2203</span></td>
       <td><span class="comment code"> *   An array of allowed date parts, all others will be removed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2204</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2205</span></td>
       <td><span class="comment code"> * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2206</span></td>
       <td><span class="comment code"> *   TRUE if the granularity contains a date portion, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2207</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2208</span></td>
       <td><span class="covered code">function date_has_date($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2209</span></td>
       <td><span class="missed code">  if (!is_array($granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2210</span></td>
       <td><span class="missed code">    $granularity = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2211</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2212</span></td>
       <td><span class="missed code">  $options = array('year', 'month', 'day');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2213</span></td>
       <td><span class="missed code">  return (bool) count(array_intersect($granularity, $options));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2214</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2215</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2216</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2217</span></td>
       <td><span class="comment code"> * Helper function to get a format for a specific part of a date field.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2218</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2219</span></td>
       <td><span class="comment code"> * @param string $part
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2220</span></td>
       <td><span class="comment code"> *   The date field part, either 'time' or 'date'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2221</span></td>
       <td><span class="comment code"> * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2222</span></td>
       <td><span class="comment code"> *   A date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2223</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2224</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2225</span></td>
       <td><span class="comment code"> *   The date format for the given part.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2226</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2227</span></td>
       <td><span class="covered code">function date_part_format($part, $format) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2228</span></td>
       <td><span class="comment code">  switch ($part) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2229</span></td>
       <td><span class="missed code">    case 'date':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2230</span></td>
       <td><span class="missed code">      return date_limit_format($format, array('year', 'month', 'day'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2231</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2232</span></td>
       <td><span class="missed code">    case 'time':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2233</span></td>
       <td><span class="missed code">      return date_limit_format($format, array('hour', 'minute', 'second'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2234</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2235</span></td>
       <td><span class="missed code">    default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2236</span></td>
       <td><span class="missed code">      return date_limit_format($format, array($part));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2237</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2238</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2239</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2240</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2241</span></td>
       <td><span class="comment code"> * Limits a date format to include only elements from a given granularity array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2242</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2243</span></td>
       <td><span class="comment code"> * Example:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2244</span></td>
       <td><span class="comment code"> *   date_limit_format('F j, Y - H:i', array('year', 'month', 'day'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2245</span></td>
       <td><span class="comment code"> *   returns 'F j, Y'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2246</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2247</span></td>
       <td><span class="comment code"> * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2248</span></td>
       <td><span class="comment code"> *   A date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2249</span></td>
       <td><span class="comment code"> * @param array $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2250</span></td>
       <td><span class="comment code"> *   An array of allowed date parts, all others will be removed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2251</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2252</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2253</span></td>
       <td><span class="comment code"> *   The format string with all other elements removed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2254</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2255</span></td>
       <td><span class="covered code">function date_limit_format($format, $granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2256</span></td>
       <td><span class="comment code">  // Use the advanced drupal_static() pattern to improve performance.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2257</span></td>
       <td><span class="missed code">  static $drupal_static_fast;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2258</span></td>
       <td><span class="missed code">  if (!isset($drupal_static_fast)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2259</span></td>
       <td><span class="missed code">    $drupal_static_fast['formats'] = &amp;drupal_static(__FUNCTION__);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2260</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2261</span></td>
       <td><span class="missed code">  $formats = &amp;$drupal_static_fast['formats'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2262</span></td>
       <td><span class="missed code">  $format_granularity_cid = $format . '|' . implode(',', $granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2263</span></td>
       <td><span class="missed code">  if (isset($formats[$format_granularity_cid])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2264</span></td>
       <td><span class="missed code">    return $formats[$format_granularity_cid];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2265</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2266</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2267</span></td>
       <td><span class="comment code">  // If punctuation has been escaped, remove the escaping. Done using strtr()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2268</span></td>
       <td><span class="comment code">  // because it is easier than getting the escape character extracted using
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2269</span></td>
       <td><span class="comment code">  // preg_replace().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2270</span></td>
       <td><span class="comment code">  $replace = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2271</span></td>
       <td><span class="missed code">    '\-' =&gt; '-',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2272</span></td>
       <td><span class="missed code">    '\:' =&gt; ':',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2273</span></td>
       <td><span class="missed code">    &quot;\'&quot; =&gt; &quot;'&quot;,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2274</span></td>
       <td><span class="missed code">    '\. ' =&gt; ' . ',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2275</span></td>
       <td><span class="missed code">    '\,' =&gt; ',',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2276</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2277</span></td>
       <td><span class="missed code">  $format = strtr($format, $replace);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2278</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2279</span></td>
       <td><span class="comment code">  // Get the 'T' out of ISO date formats that don't have both date and time.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2280</span></td>
       <td><span class="missed code">  if (!date_has_time($granularity) || !date_has_date($granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2281</span></td>
       <td><span class="missed code">    $format = str_replace('\T', ' ', $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2282</span></td>
       <td><span class="missed code">    $format = str_replace('T', ' ', $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2283</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2284</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2285</span></td>
       <td><span class="missed code">  $regex = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2286</span></td>
       <td><span class="missed code">  if (!date_has_time($granularity)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2287</span></td>
       <td><span class="missed code">    $regex[] = '((?&lt;!\\\\)[a|A])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2288</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2289</span></td>
       <td><span class="comment code">  // Create regular expressions to remove selected values from string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2290</span></td>
       <td><span class="comment code">  // Use (?&lt;!\\\\) to keep escaped letters from being removed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2291</span></td>
       <td><span class="missed code">  foreach (date_nongranularity($granularity) as $element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2292</span></td>
       <td><span class="comment code">    switch ($element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2293</span></td>
       <td><span class="missed code">      case 'year':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2294</span></td>
       <td><span class="missed code">        $regex[] = '([\-/\.,:]?\s?(?&lt;!\\\\)[Yy])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2295</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2296</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2297</span></td>
       <td><span class="missed code">      case 'day':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2298</span></td>
       <td><span class="missed code">        $regex[] = '([\-/\.,:]?\s?(?&lt;!\\\\)[l|D|d|dS|j|jS|N|w|W|z]{1,2})';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2299</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2300</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2301</span></td>
       <td><span class="missed code">      case 'month':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2302</span></td>
       <td><span class="missed code">        $regex[] = '([\-/\.,:]?\s?(?&lt;!\\\\)[FMmn])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2303</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2304</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2305</span></td>
       <td><span class="missed code">      case 'hour':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2306</span></td>
       <td><span class="missed code">        $regex[] = '([\-/\.,:]?\s?(?&lt;!\\\\)[HhGg])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2307</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2308</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2309</span></td>
       <td><span class="missed code">      case 'minute':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2310</span></td>
       <td><span class="missed code">        $regex[] = '([\-/\.,:]?\s?(?&lt;!\\\\)[i])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2311</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2312</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2313</span></td>
       <td><span class="missed code">      case 'second':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2314</span></td>
       <td><span class="missed code">        $regex[] = '([\-/\.,:]?\s?(?&lt;!\\\\)[s])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2315</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2316</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2317</span></td>
       <td><span class="missed code">      case 'timezone':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2318</span></td>
       <td><span class="missed code">        $regex[] = '([\-/\.,:]?\s?(?&lt;!\\\\)[TOZPe])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2319</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2320</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2321</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2322</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2323</span></td>
       <td><span class="comment code">  // Remove empty parentheses, brackets, pipes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2324</span></td>
       <td><span class="missed code">  $regex[] = '(\(\))';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2325</span></td>
       <td><span class="missed code">  $regex[] = '(\[\])';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2326</span></td>
       <td><span class="missed code">  $regex[] = '(\|\|)';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2327</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2328</span></td>
       <td><span class="comment code">  // Remove selected values from string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2329</span></td>
       <td><span class="missed code">  $format = trim(preg_replace($regex, array(), $format));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2330</span></td>
       <td><span class="comment code">  // Remove orphaned punctuation at the beginning of the string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2331</span></td>
       <td><span class="missed code">  $format = preg_replace('`^([\-/\.,:\'])`', '', $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2332</span></td>
       <td><span class="comment code">  // Remove orphaned punctuation at the end of the string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2333</span></td>
       <td><span class="missed code">  $format = preg_replace('([\-/,:\']$)', '', $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2334</span></td>
       <td><span class="missed code">  $format = preg_replace('(\\$)', '', $format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2335</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2336</span></td>
       <td><span class="comment code">  // Trim any whitespace from the result.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2337</span></td>
       <td><span class="missed code">  $format = trim($format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2338</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2339</span></td>
       <td><span class="comment code">  // After removing the non-desired parts of the format, test if the only things
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2340</span></td>
       <td><span class="comment code">  // left are escaped, non-date, characters. If so, return nothing.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2341</span></td>
       <td><span class="comment code">  // Using S instead of w to pick up non-ASCII characters.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2342</span></td>
       <td><span class="missed code">  $test = trim(preg_replace('(\\\\\S{1,3})u', '', $format));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2343</span></td>
       <td><span class="missed code">  if (empty($test)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2344</span></td>
       <td><span class="missed code">    $format = '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2345</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2346</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2347</span></td>
       <td><span class="comment code">  // Store the return value in the static array for performance.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2348</span></td>
       <td><span class="missed code">  $formats[$format_granularity_cid] = $format;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2349</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2350</span></td>
       <td><span class="missed code">  return $format;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2351</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2352</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2353</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2354</span></td>
       <td><span class="comment code"> * Converts a format to an ordered array of granularity parts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2355</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2356</span></td>
       <td><span class="comment code"> * Example:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2357</span></td>
       <td><span class="comment code"> *   date_format_order('m/d/Y H:i')
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2358</span></td>
       <td><span class="comment code"> *   returns
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2359</span></td>
       <td><span class="comment code"> *     array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2360</span></td>
       <td><span class="comment code"> *       0 =&gt; 'month',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2361</span></td>
       <td><span class="comment code"> *       1 =&gt; 'day',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2362</span></td>
       <td><span class="comment code"> *       2 =&gt; 'year',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2363</span></td>
       <td><span class="comment code"> *       3 =&gt; 'hour',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2364</span></td>
       <td><span class="comment code"> *       4 =&gt; 'minute',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2365</span></td>
       <td><span class="comment code"> *     );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2366</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2367</span></td>
       <td><span class="comment code"> * @param string $format
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2368</span></td>
       <td><span class="comment code"> *   A date format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2369</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2370</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2371</span></td>
       <td><span class="comment code"> *   An array of ordered granularity elements from the given format string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2372</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2373</span></td>
       <td><span class="covered code">function date_format_order($format) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2374</span></td>
       <td><span class="missed code">  $order = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2375</span></td>
       <td><span class="missed code">  if (empty($format)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2376</span></td>
       <td><span class="missed code">    return $order;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2377</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2378</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2379</span></td>
       <td><span class="missed code">  $max = strlen($format);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2380</span></td>
       <td><span class="missed code">  for ($i = 0; $i &lt;= $max; $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2381</span></td>
       <td><span class="missed code">    if (!isset($format[$i])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2382</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2383</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2384</span></td>
       <td><span class="missed code">    switch ($format[$i]) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2385</span></td>
       <td><span class="missed code">      case 'd':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2386</span></td>
       <td><span class="missed code">      case 'j':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2387</span></td>
       <td><span class="missed code">        $order[] = 'day';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2388</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2389</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2390</span></td>
       <td><span class="missed code">      case 'F':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2391</span></td>
       <td><span class="missed code">      case 'M':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2392</span></td>
       <td><span class="missed code">      case 'm':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2393</span></td>
       <td><span class="missed code">      case 'n':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2394</span></td>
       <td><span class="missed code">        $order[] = 'month';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2395</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2396</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2397</span></td>
       <td><span class="missed code">      case 'Y':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2398</span></td>
       <td><span class="missed code">      case 'y':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2399</span></td>
       <td><span class="missed code">        $order[] = 'year';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2400</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2401</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2402</span></td>
       <td><span class="missed code">      case 'g':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2403</span></td>
       <td><span class="missed code">      case 'G':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2404</span></td>
       <td><span class="missed code">      case 'h':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2405</span></td>
       <td><span class="missed code">      case 'H':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2406</span></td>
       <td><span class="missed code">        $order[] = 'hour';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2407</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2408</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2409</span></td>
       <td><span class="missed code">      case 'i':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2410</span></td>
       <td><span class="missed code">        $order[] = 'minute';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2411</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2412</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2413</span></td>
       <td><span class="missed code">      case 's':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2414</span></td>
       <td><span class="missed code">        $order[] = 'second';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2415</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2416</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2417</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2418</span></td>
       <td><span class="missed code">  return $order;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2419</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2420</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2421</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2422</span></td>
       <td><span class="comment code"> * Strips out unwanted granularity elements.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2423</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2424</span></td>
       <td><span class="comment code"> * @param array $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2425</span></td>
       <td><span class="comment code"> *   An array like ('year', 'month', 'day', 'hour', 'minute', 'second');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2426</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2427</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2428</span></td>
       <td><span class="comment code"> *   A reduced set of granularitiy elements.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2429</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2430</span></td>
       <td><span class="covered code">function date_nongranularity($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2431</span></td>
       <td><span class="comment code">  $options = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2432</span></td>
       <td><span class="missed code">    'year',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2433</span></td>
       <td><span class="missed code">    'month',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2434</span></td>
       <td><span class="missed code">    'day',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2435</span></td>
       <td><span class="missed code">    'hour',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2436</span></td>
       <td><span class="missed code">    'minute',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2437</span></td>
       <td><span class="missed code">    'second',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2438</span></td>
       <td><span class="missed code">    'timezone',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2439</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2440</span></td>
       <td><span class="missed code">  return array_diff($options, (array) $granularity);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2441</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2442</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2443</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2444</span></td>
       <td><span class="comment code"> * Implements hook_element_info().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2445</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2446</span></td>
       <td><span class="covered code">function date_api_element_info() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2447</span></td>
       <td><span class="missed code">  module_load_include('inc', 'date_api', 'date_api_elements');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2448</span></td>
       <td><span class="missed code">  return _date_api_element_info();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2449</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2450</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2451</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2452</span></td>
       <td><span class="comment code"> * Implements hook_theme().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2453</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2454</span></td>
       <td><span class="covered code">function date_api_theme($existing, $type, $theme, $path) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2455</span></td>
       <td><span class="comment code">  $base = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2456</span></td>
       <td><span class="missed code">    'file' =&gt; 'theme.inc',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2457</span></td>
       <td><span class="missed code">    'path' =&gt; &quot;$path/theme&quot;,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2458</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2459</span></td>
       <td><span class="comment code">  return array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2460</span></td>
       <td><span class="comment code">    'date_nav_title' =&gt; $base + array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2461</span></td>
       <td><span class="comment code">      'variables' =&gt; array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2462</span></td>
       <td><span class="missed code">        'granularity' =&gt; NULL, 'view' =&gt; NULL, 'link' =&gt; NULL, 'format' =&gt; NULL
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2463</span></td>
       <td><span class="missed code">      ),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2464</span></td>
       <td><span class="missed code">    ),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2465</span></td>
       <td><span class="missed code">    'date_timezone' =&gt; $base + array('render element' =&gt; 'element'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2466</span></td>
       <td><span class="missed code">    'date_select' =&gt; $base + array('render element' =&gt; 'element'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2467</span></td>
       <td><span class="missed code">    'date_text' =&gt; $base + array('render element' =&gt; 'element'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2468</span></td>
       <td><span class="missed code">    'date_select_element' =&gt; $base + array('render element' =&gt; 'element'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2469</span></td>
       <td><span class="missed code">    'date_textfield_element' =&gt; $base + array('render element' =&gt; 'element'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2470</span></td>
       <td><span class="missed code">    'date_part_hour_prefix' =&gt; $base + array('render element' =&gt; 'element'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2471</span></td>
       <td><span class="missed code">    'date_part_minsec_prefix' =&gt; $base + array('render element' =&gt; 'element'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2472</span></td>
       <td><span class="missed code">    'date_part_label_year' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2473</span></td>
       <td><span class="missed code">    'date_part_label_month' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2474</span></td>
       <td><span class="missed code">    'date_part_label_day' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2475</span></td>
       <td><span class="missed code">    'date_part_label_hour' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2476</span></td>
       <td><span class="missed code">    'date_part_label_minute' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2477</span></td>
       <td><span class="missed code">    'date_part_label_second' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2478</span></td>
       <td><span class="missed code">    'date_part_label_ampm' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2479</span></td>
       <td><span class="missed code">    'date_part_label_timezone' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2480</span></td>
       <td><span class="missed code">    'date_part_label_date' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2481</span></td>
       <td><span class="missed code">    'date_part_label_time' =&gt; $base + array('variables' =&gt; array('date_part' =&gt; NULL, 'element' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2482</span></td>
       <td><span class="missed code">    'date_views_filter_form' =&gt; $base + array('template' =&gt; 'date-views-filter-form', 'render element' =&gt; 'form'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2483</span></td>
       <td><span class="missed code">    'date_calendar_day' =&gt; $base + array('variables' =&gt; array('date' =&gt; NULL)),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2484</span></td>
       <td><span class="comment code">    'date_time_ago' =&gt; $base + array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2485</span></td>
       <td><span class="comment code">      'variables' =&gt; array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2486</span></td>
       <td><span class="missed code">        'start_date' =&gt; NULL, 'end_date' =&gt; NULL, 'interval' =&gt; NULL
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2487</span></td>
       <td><span class="missed code">      ),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2488</span></td>
       <td><span class="missed code">    ),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2489</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2490</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2491</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2492</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2493</span></td>
       <td><span class="comment code"> * Function to figure out which local timezone applies to a date and select it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2494</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2495</span></td>
       <td><span class="comment code"> * @param string $handling
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2496</span></td>
       <td><span class="comment code"> *   The timezone handling.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2497</span></td>
       <td><span class="comment code"> * @param string $timezone
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2498</span></td>
       <td><span class="comment code"> *   (optional) A timezone string. Defaults to an empty string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2499</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2500</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2501</span></td>
       <td><span class="comment code"> *   The timezone string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2502</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2503</span></td>
       <td><span class="covered code">function date_get_timezone($handling, $timezone = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2504</span></td>
       <td><span class="comment code">  switch ($handling) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2505</span></td>
       <td><span class="missed code">    case 'date':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2506</span></td>
       <td><span class="missed code">      $timezone = !empty($timezone) ? $timezone : date_default_timezone();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2507</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2508</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2509</span></td>
       <td><span class="missed code">    case 'utc':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2510</span></td>
       <td><span class="missed code">      $timezone = 'UTC';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2511</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2512</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2513</span></td>
       <td><span class="missed code">    default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2514</span></td>
       <td><span class="missed code">      $timezone = date_default_timezone();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2515</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2516</span></td>
       <td><span class="missed code">  return $timezone &gt; '' ? $timezone : date_default_timezone();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2517</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2518</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2519</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2520</span></td>
       <td><span class="comment code"> * Function to figure out which db timezone applies to a date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2521</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2522</span></td>
       <td><span class="comment code"> * @param string $handling
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2523</span></td>
       <td><span class="comment code"> *   The timezone handling.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2524</span></td>
       <td><span class="comment code"> * @param string $timezone
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2525</span></td>
       <td><span class="comment code"> *   (optional) When $handling is 'date', date_get_timezone_db() returns this
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2526</span></td>
       <td><span class="comment code"> *   value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2527</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2528</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2529</span></td>
       <td><span class="comment code"> *   The timezone string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2530</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2531</span></td>
       <td><span class="covered code">function date_get_timezone_db($handling, $timezone = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2532</span></td>
       <td><span class="comment code">  switch ($handling) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2533</span></td>
       <td><span class="missed code">    case ('utc'):
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2534</span></td>
       <td><span class="missed code">    case ('site'):
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2535</span></td>
       <td><span class="missed code">    case ('user'):
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2536</span></td>
       <td><span class="comment code">      // These handling modes all convert to UTC before storing in the DB.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2537</span></td>
       <td><span class="missed code">      $timezone = 'UTC';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2538</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2539</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2540</span></td>
       <td><span class="missed code">    case ('date'):
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2541</span></td>
       <td><span class="missed code">      if ($timezone == NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2542</span></td>
       <td><span class="comment code">        // This shouldn't happen, since it's meaning is undefined. But we need
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2543</span></td>
       <td><span class="comment code">        // to fall back to *something* that's a legal timezone.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2544</span></td>
       <td><span class="missed code">        $timezone = date_default_timezone();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2545</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2546</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2547</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2548</span></td>
       <td><span class="missed code">    case ('none'):
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2549</span></td>
       <td><span class="missed code">    default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2550</span></td>
       <td><span class="missed code">      $timezone = date_default_timezone();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2551</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2552</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2553</span></td>
       <td><span class="missed code">  return $timezone;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2554</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2555</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2556</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2557</span></td>
       <td><span class="comment code"> * Helper function for converting back and forth from '+1' to 'First'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2558</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2559</span></td>
       <td><span class="covered code">function date_order_translated() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2560</span></td>
       <td><span class="comment code">  return array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2561</span></td>
       <td><span class="missed code">    '+1' =&gt; t('First', array(), array('context' =&gt; 'date_order')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2562</span></td>
       <td><span class="missed code">    '+2' =&gt; t('Second', array(), array('context' =&gt; 'date_order')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2563</span></td>
       <td><span class="missed code">    '+3' =&gt; t('Third', array(), array('context' =&gt; 'date_order')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2564</span></td>
       <td><span class="missed code">    '+4' =&gt; t('Fourth', array(), array('context' =&gt; 'date_order')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2565</span></td>
       <td><span class="missed code">    '+5' =&gt; t('Fifth', array(), array('context' =&gt; 'date_order')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2566</span></td>
       <td><span class="missed code">    '-1' =&gt; t('Last', array(), array('context' =&gt; 'date_order_reverse')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2567</span></td>
       <td><span class="missed code">    '-2' =&gt; t('Next to last', array(), array('context' =&gt; 'date_order_reverse')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2568</span></td>
       <td><span class="missed code">    '-3' =&gt; t('Third from last', array(), array('context' =&gt; 'date_order_reverse')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2569</span></td>
       <td><span class="missed code">    '-4' =&gt; t('Fourth from last', array(), array('context' =&gt; 'date_order_reverse')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2570</span></td>
       <td><span class="missed code">    '-5' =&gt; t('Fifth from last', array(), array('context' =&gt; 'date_order_reverse')),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2571</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2572</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2573</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2574</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2575</span></td>
       <td><span class="comment code"> * Creates an array of ordered strings, using English text when possible.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2576</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2577</span></td>
       <td><span class="covered code">function date_order() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2578</span></td>
       <td><span class="comment code">  return array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2579</span></td>
       <td><span class="missed code">    '+1' =&gt; 'First',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2580</span></td>
       <td><span class="missed code">    '+2' =&gt; 'Second',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2581</span></td>
       <td><span class="missed code">    '+3' =&gt; 'Third',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2582</span></td>
       <td><span class="missed code">    '+4' =&gt; 'Fourth',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2583</span></td>
       <td><span class="missed code">    '+5' =&gt; 'Fifth',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2584</span></td>
       <td><span class="missed code">    '-1' =&gt; 'Last',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2585</span></td>
       <td><span class="missed code">    '-2' =&gt; '-2',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2586</span></td>
       <td><span class="missed code">    '-3' =&gt; '-3',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2587</span></td>
       <td><span class="missed code">    '-4' =&gt; '-4',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2588</span></td>
       <td><span class="missed code">    '-5' =&gt; '-5',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2589</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2590</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2591</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2592</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2593</span></td>
       <td><span class="comment code"> * Tests validity of a date range string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2594</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2595</span></td>
       <td><span class="comment code"> * @param string $string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2596</span></td>
       <td><span class="comment code"> *   A min and max year string like '-3:+1'a.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2597</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2598</span></td>
       <td><span class="comment code"> * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2599</span></td>
       <td><span class="comment code"> *   TRUE if the date range is valid, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2600</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2601</span></td>
       <td><span class="covered code">function date_range_valid($string) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2602</span></td>
       <td><span class="missed code">  $matches = preg_match('@^([\+\-][0-9]+|[0-9]{4}):([\+\-][0-9]+|[0-9]{4})$@', $string);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2603</span></td>
       <td><span class="missed code">  return $matches &lt; 1 ? FALSE : TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2604</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2605</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2606</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2607</span></td>
       <td><span class="comment code"> * Splits a string like -3:+3 or 2001:2010 into an array of start and end years.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2608</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2609</span></td>
       <td><span class="comment code"> * Center the range around the current year, if any, but expand it far
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2610</span></td>
       <td><span class="comment code"> * enough so it will pick up the year value in the field in case
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2611</span></td>
       <td><span class="comment code"> * the value in the field is outside the initial range.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2612</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2613</span></td>
       <td><span class="comment code"> * @param string $string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2614</span></td>
       <td><span class="comment code"> *   A min and max year string like '-3:+1'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2615</span></td>
       <td><span class="comment code"> * @param object $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2616</span></td>
       <td><span class="comment code"> *   (optional) A date object. Defaults to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2617</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2618</span></td>
       <td><span class="comment code"> * @return array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2619</span></td>
       <td><span class="comment code"> *   A numerically indexed array, containing a start and end year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2620</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2621</span></td>
       <td><span class="covered code">function date_range_years($string, $date = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2622</span></td>
       <td><span class="missed code">  $this_year = date_format(date_now(), 'Y');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2623</span></td>
       <td><span class="missed code">  list($start_year, $end_year) = explode(':', $string);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2624</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2625</span></td>
       <td><span class="comment code">  // Valid patterns would be -5:+5, 0:+1, 2008:2010.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2626</span></td>
       <td><span class="missed code">  $plus_pattern = '@[\+\-][0-9]{1,4}@';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2627</span></td>
       <td><span class="missed code">  $year_pattern = '@^[0-9]{4}@';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2628</span></td>
       <td><span class="missed code">  if (!preg_match($year_pattern, $start_year, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2629</span></td>
       <td><span class="missed code">    if (preg_match($plus_pattern, $start_year, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2630</span></td>
       <td><span class="missed code">      $start_year = $this_year + $matches[0];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2631</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2632</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2633</span></td>
       <td><span class="missed code">      $start_year = $this_year;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2634</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2635</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2636</span></td>
       <td><span class="missed code">  if (!preg_match($year_pattern, $end_year, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2637</span></td>
       <td><span class="missed code">    if (preg_match($plus_pattern, $end_year, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2638</span></td>
       <td><span class="missed code">      $end_year = $this_year + $matches[0];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2639</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2640</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2641</span></td>
       <td><span class="missed code">      $end_year = $this_year;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2642</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2643</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2644</span></td>
       <td><span class="comment code">  // If there is a current value, stretch the range to include it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2645</span></td>
       <td><span class="missed code">  $value_year = is_object($date) ? $date-&gt;format('Y') : '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2646</span></td>
       <td><span class="missed code">  if (!empty($value_year)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2647</span></td>
       <td><span class="missed code">    if ($start_year &lt;= $end_year) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2648</span></td>
       <td><span class="missed code">      $start_year = min($value_year, $start_year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2649</span></td>
       <td><span class="missed code">      $end_year = max($value_year, $end_year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2650</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2651</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2652</span></td>
       <td><span class="missed code">      $start_year = max($value_year, $start_year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2653</span></td>
       <td><span class="missed code">      $end_year = min($value_year, $end_year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2654</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2655</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2656</span></td>
       <td><span class="missed code">  return array($start_year, $end_year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2657</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2658</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2659</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2660</span></td>
       <td><span class="comment code"> * Converts a min and max year into a string like '-3:+1'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2661</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2662</span></td>
       <td><span class="comment code"> * @param array $years
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2663</span></td>
       <td><span class="comment code"> *   A numerically indexed array, containing a minimum and maximum year.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2664</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2665</span></td>
       <td><span class="comment code"> * @return string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2666</span></td>
       <td><span class="comment code"> *   A min and max year string like '-3:+1'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2667</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2668</span></td>
       <td><span class="covered code">function date_range_string($years) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2669</span></td>
       <td><span class="missed code">  $this_year = date_format(date_now(), 'Y');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2670</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2671</span></td>
       <td><span class="missed code">  if ($years[0] &lt; $this_year) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2672</span></td>
       <td><span class="missed code">    $min = '-' . ($this_year - $years[0]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2673</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2674</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2675</span></td>
       <td><span class="missed code">    $min = '+' . ($years[0] - $this_year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2676</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2677</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2678</span></td>
       <td><span class="missed code">  if ($years[1] &lt; $this_year) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2679</span></td>
       <td><span class="missed code">    $max = '-' . ($this_year - $years[1]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2680</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2681</span></td>
       <td><span class="comment code">  else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2682</span></td>
       <td><span class="missed code">    $max = '+' . ($years[1] - $this_year);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2683</span></td>
       <td><span class="comment code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2684</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2685</span></td>
       <td><span class="missed code">  return $min . ':' . $max;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2686</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2687</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2688</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2689</span></td>
       <td><span class="comment code"> * Temporary helper to re-create equivalent of content_database_info().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2690</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2691</span></td>
       <td><span class="covered code">function date_api_database_info($field, $revision = FIELD_LOAD_CURRENT) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2692</span></td>
       <td><span class="comment code">  return array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2693</span></td>
       <td><span class="missed code">    'columns' =&gt; $field['storage']['details']['sql'][$revision],
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2694</span></td>
       <td><span class="missed code">    'table' =&gt; _field_sql_storage_tablename($field),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2695</span></td>
       <td><span class="missed code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2696</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2697</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2698</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2699</span></td>
       <td><span class="comment code"> * Implements hook_form_FORM_ID_alter() for system_regional_settings().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2700</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2701</span></td>
       <td><span class="comment code"> * Add a form element to configure whether or not week numbers are ISO-8601, the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2702</span></td>
       <td><span class="comment code"> * default is FALSE (US/UK/AUS norm).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2703</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2704</span></td>
       <td><span class="covered code">function date_api_form_system_regional_settings_alter(&amp;$form, &amp;$form_state, $form_id) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2705</span></td>
       <td><span class="missed code">  $form['locale']['date_api_use_iso8601'] = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2706</span></td>
       <td><span class="missed code">    '#type' =&gt; 'checkbox',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2707</span></td>
       <td><span class="missed code">    '#title' =&gt; t('Use ISO-8601 week numbers'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2708</span></td>
       <td><span class="missed code">    '#default_value' =&gt; variable_get('date_api_use_iso8601', FALSE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2709</span></td>
       <td><span class="missed code">    '#description' =&gt; t('IMPORTANT! If checked, First day of week MUST be set to Monday'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2710</span></td>
       <td><span class="comment code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2711</span></td>
       <td><span class="missed code">  $form['#validate'][] = 'date_api_form_system_settings_validate';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2712</span></td>
       <td><span class="missed code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2713</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2714</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2715</span></td>
       <td><span class="comment code"> * Validate that the option to use ISO weeks matches first day of week choice.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2716</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2717</span></td>
       <td><span class="covered code">function date_api_form_system_settings_validate(&amp;$form, &amp;$form_state) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2718</span></td>
       <td><span class="missed code">  $form_values = $form_state['values'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2719</span></td>
       <td><span class="missed code">  if ($form_values['date_api_use_iso8601'] &amp;&amp; $form_values['date_first_day'] != 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2720</span></td>
       <td><span class="missed code">    form_set_error('date_first_day', t('When using ISO-8601 week numbers, the first day of the week must be set to Monday.'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2721</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2722</span></td>
       <td><span class="missed code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2723</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2724</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2725</span></td>
       <td><span class="comment code"> * Creates an array of date format types for use as an options list.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2726</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2727</span></td>
       <td><span class="covered code">function date_format_type_options() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2728</span></td>
       <td><span class="missed code">  $options = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2729</span></td>
       <td><span class="missed code">  $format_types = system_get_date_types();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2730</span></td>
       <td><span class="missed code">  if (!empty($format_types)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2731</span></td>
       <td><span class="missed code">    foreach ($format_types as $type =&gt; $type_info) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2732</span></td>
       <td><span class="missed code">      $options[$type] = $type_info['title'] . ' (' . date_format_date(date_example_date(), $type) . ')';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2733</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2734</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2735</span></td>
       <td><span class="missed code">  return $options;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2736</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2737</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2738</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2739</span></td>
       <td><span class="comment code"> * Creates an example date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2740</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2741</span></td>
       <td><span class="comment code"> * This ensures a clear difference between month and day, and 12 and 24 hours.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2742</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2743</span></td>
       <td><span class="covered code">function date_example_date() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2744</span></td>
       <td><span class="missed code">  $now = date_now();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2745</span></td>
       <td><span class="missed code">  if (date_format($now, 'M') == date_format($now, 'F')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2746</span></td>
       <td><span class="missed code">    date_modify($now, '+1 month');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2747</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2748</span></td>
       <td><span class="missed code">  if (date_format($now, 'm') == date_format($now, 'd')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2749</span></td>
       <td><span class="missed code">    date_modify($now, '+1 day');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2750</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2751</span></td>
       <td><span class="missed code">  if (date_format($now, 'H') == date_format($now, 'h')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2752</span></td>
       <td><span class="missed code">    date_modify($now, '+12 hours');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2753</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2754</span></td>
       <td><span class="missed code">  return $now;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2755</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2756</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2757</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2758</span></td>
       <td><span class="comment code"> * Determine if a start/end date combination qualify as 'All day'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2759</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2760</span></td>
       <td><span class="comment code"> * @param string $string1
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2761</span></td>
       <td><span class="comment code"> *   A string date in datetime format for the 'start' date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2762</span></td>
       <td><span class="comment code"> * @param string $string2
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2763</span></td>
       <td><span class="comment code"> *   A string date in datetime format for the 'end' date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2764</span></td>
       <td><span class="comment code"> * @param string $granularity
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2765</span></td>
       <td><span class="comment code"> *   (optional) The granularity of the date. Defaults to 'second'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2766</span></td>
       <td><span class="comment code"> * @param int $increment
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2767</span></td>
       <td><span class="comment code"> *   (optional) The increment of the date. Defaults to 1.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2768</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2769</span></td>
       <td><span class="comment code"> * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2770</span></td>
       <td><span class="comment code"> *   TRUE if the date is all day, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2771</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2772</span></td>
       <td><span class="covered code">function date_is_all_day($string1, $string2, $granularity = 'second', $increment = 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2773</span></td>
       <td><span class="missed code">  if (empty($string1) || empty($string2)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2774</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2775</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2776</span></td>
       <td><span class="missed code">  elseif (!in_array($granularity, array('hour', 'minute', 'second'))) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2777</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2778</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2779</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2780</span></td>
       <td><span class="missed code">  preg_match('/([0-9]{4}-[0-9]{2}-[0-9]{2}) (([0-9]{2}):([0-9]{2}):([0-9]{2}))/', $string1, $matches);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2781</span></td>
       <td><span class="missed code">  $count = count($matches);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2782</span></td>
       <td><span class="missed code">  $date1 = $count &gt; 1 ? $matches[1] : '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2783</span></td>
       <td><span class="missed code">  $time1 = $count &gt; 2 ? $matches[2] : '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2784</span></td>
       <td><span class="missed code">  $hour1 = $count &gt; 3 ? intval($matches[3]) : 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2785</span></td>
       <td><span class="missed code">  $min1 = $count &gt; 4 ? intval($matches[4]) : 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2786</span></td>
       <td><span class="missed code">  $sec1 = $count &gt; 5 ? intval($matches[5]) : 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2787</span></td>
       <td><span class="missed code">  preg_match('/([0-9]{4}-[0-9]{2}-[0-9]{2}) (([0-9]{2}):([0-9]{2}):([0-9]{2}))/', $string2, $matches);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2788</span></td>
       <td><span class="missed code">  $count = count($matches);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2789</span></td>
       <td><span class="missed code">  $date2 = $count &gt; 1 ? $matches[1] : '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2790</span></td>
       <td><span class="missed code">  $time2 = $count &gt; 2 ? $matches[2] : '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2791</span></td>
       <td><span class="missed code">  $hour2 = $count &gt; 3 ? intval($matches[3]) : 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2792</span></td>
       <td><span class="missed code">  $min2 = $count &gt; 4 ? intval($matches[4]) : 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2793</span></td>
       <td><span class="missed code">  $sec2 = $count &gt; 5 ? intval($matches[5]) : 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2794</span></td>
       <td><span class="missed code">  if (empty($date1) || empty($date2)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2795</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2796</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2797</span></td>
       <td><span class="missed code">  if (empty($time1) || empty($time2)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2798</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2799</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2800</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2801</span></td>
       <td><span class="missed code">  $tmp = date_seconds('s', TRUE, $increment);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2802</span></td>
       <td><span class="missed code">  $max_seconds = intval(array_pop($tmp));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2803</span></td>
       <td><span class="missed code">  $tmp = date_minutes('i', TRUE, $increment);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2804</span></td>
       <td><span class="missed code">  $max_minutes = intval(array_pop($tmp));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2805</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2806</span></td>
       <td><span class="comment code">  // See if minutes and seconds are the maximum allowed for an increment or the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2807</span></td>
       <td><span class="comment code">  // maximum possible (59), or 0.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2808</span></td>
       <td><span class="comment code">  switch ($granularity) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2809</span></td>
       <td><span class="missed code">    case 'second':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2810</span></td>
       <td><span class="comment code">      $min_match = $time1 == '00:00:00'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2811</span></td>
       <td><span class="missed code">        || ($hour1 == 0 &amp;&amp; $min1 == 0 &amp;&amp; $sec1 == 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2812</span></td>
       <td><span class="comment code">      $max_match = $time2 == '00:00:00'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2813</span></td>
       <td><span class="missed code">        || ($hour2 == 23 &amp;&amp; in_array($min2, array($max_minutes, 59)) &amp;&amp; in_array($sec2, array($max_seconds, 59)))
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2814</span></td>
       <td><span class="missed code">        || ($hour1 == 0 &amp;&amp; $hour2 == 0 &amp;&amp; $min1 == 0 &amp;&amp; $min2 == 0 &amp;&amp; $sec1 == 0 &amp;&amp; $sec2 == 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2815</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2816</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2817</span></td>
       <td><span class="missed code">    case 'minute':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2818</span></td>
       <td><span class="comment code">      $min_match = $time1 == '00:00:00'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2819</span></td>
       <td><span class="missed code">        || ($hour1 == 0 &amp;&amp; $min1 == 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2820</span></td>
       <td><span class="comment code">      $max_match = $time2 == '00:00:00'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2821</span></td>
       <td><span class="missed code">        || ($hour2 == 23 &amp;&amp; in_array($min2, array($max_minutes, 59)))
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2822</span></td>
       <td><span class="missed code">        || ($hour1 == 0 &amp;&amp; $hour2 == 0 &amp;&amp; $min1 == 0 &amp;&amp; $min2 == 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2823</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2824</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2825</span></td>
       <td><span class="missed code">    case 'hour':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2826</span></td>
       <td><span class="comment code">      $min_match = $time1 == '00:00:00'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2827</span></td>
       <td><span class="missed code">        || ($hour1 == 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2828</span></td>
       <td><span class="comment code">      $max_match = $time2 == '00:00:00'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2829</span></td>
       <td><span class="missed code">        || ($hour2 == 23)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2830</span></td>
       <td><span class="missed code">        || ($hour1 == 0 &amp;&amp; $hour2 == 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2831</span></td>
       <td><span class="missed code">      break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2832</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2833</span></td>
       <td><span class="missed code">    default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2834</span></td>
       <td><span class="missed code">      $min_match = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2835</span></td>
       <td><span class="missed code">      $max_match = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2836</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2837</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2838</span></td>
       <td><span class="missed code">  if ($min_match &amp;&amp; $max_match) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2839</span></td>
       <td><span class="missed code">    return TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2840</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2841</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2842</span></td>
       <td><span class="missed code">  return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2843</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2844</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2845</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2846</span></td>
       <td><span class="comment code"> * Helper function to round minutes and seconds to requested value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2847</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2848</span></td>
       <td><span class="covered code">function date_increment_round(&amp;$date, $increment) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2849</span></td>
       <td><span class="comment code">  // Round minutes and seconds, if necessary.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2850</span></td>
       <td><span class="missed code">  if (is_object($date) &amp;&amp; $increment &gt; 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2851</span></td>
       <td><span class="missed code">    $day = intval(date_format($date, 'j'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2852</span></td>
       <td><span class="missed code">    $hour = intval(date_format($date, 'H'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2853</span></td>
       <td><span class="missed code">    $second = intval(round(intval(date_format($date, 's')) / $increment) * $increment);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2854</span></td>
       <td><span class="missed code">    $minute = intval(date_format($date, 'i'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2855</span></td>
       <td><span class="missed code">    if ($second == 60) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2856</span></td>
       <td><span class="missed code">      $minute += 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2857</span></td>
       <td><span class="missed code">      $second = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2858</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2859</span></td>
       <td><span class="missed code">    $minute = intval(round($minute / $increment) * $increment);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2860</span></td>
       <td><span class="missed code">    if ($minute == 60) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2861</span></td>
       <td><span class="missed code">      $hour += 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2862</span></td>
       <td><span class="missed code">      $minute = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2863</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2864</span></td>
       <td><span class="missed code">    date_time_set($date, $hour, $minute, $second);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2865</span></td>
       <td><span class="missed code">    if ($hour == 24) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2866</span></td>
       <td><span class="missed code">      $day += 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2867</span></td>
       <td><span class="missed code">      $hour = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2868</span></td>
       <td><span class="missed code">      $year = date_format($date, 'Y');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2869</span></td>
       <td><span class="missed code">      $month = date_format($date, 'n');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2870</span></td>
       <td><span class="missed code">      date_date_set($date, $year, $month, $day);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2871</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2872</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2873</span></td>
       <td><span class="missed code">  return $date;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2874</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2875</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2876</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2877</span></td>
       <td><span class="comment code"> * Determines if a date object is valid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2878</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2879</span></td>
       <td><span class="comment code"> * @param object $date
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2880</span></td>
       <td><span class="comment code"> *   The date object to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2881</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2882</span></td>
       <td><span class="comment code"> * @return bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2883</span></td>
       <td><span class="comment code"> *   TRUE if the date is a valid date object, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2884</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2885</span></td>
       <td><span class="covered code">function date_is_date($date) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2886</span></td>
       <td><span class="missed code">  if (empty($date) || !is_object($date) || !empty($date-&gt;errors)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2887</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2888</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2889</span></td>
       <td><span class="missed code">  return TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2890</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2891</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2892</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2893</span></td>
       <td><span class="comment code"> * Replace specific ISO values using patterns.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2894</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2895</span></td>
       <td><span class="comment code"> * Function will replace ISO values that have the pattern 9999-00-00T00:00:00
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2896</span></td>
       <td><span class="comment code"> * with a pattern like 9999-01-01T00:00:00, to match the behavior of non-ISO dates
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2897</span></td>
       <td><span class="comment code"> * and ensure that date objects created from this value contain a valid month
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2898</span></td>
       <td><span class="comment code"> * and day.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2899</span></td>
       <td><span class="comment code"> * Without this fix, the ISO date '2020-00-00T00:00:00' would be created as
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2900</span></td>
       <td><span class="comment code"> * November 30, 2019 (the previous day in the previous month).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2901</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2902</span></td>
       <td><span class="comment code"> * @param string $iso_string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2903</span></td>
       <td><span class="comment code"> *   An ISO string that needs to be made into a complete, valid date.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2904</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2905</span></td>
       <td><span class="comment code"> * @return mixed|string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2906</span></td>
       <td><span class="comment code"> *   replaced value, or incoming value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2907</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2908</span></td>
       <td><span class="comment code"> * @TODO Expand on this to work with all sorts of partial ISO dates.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2909</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2910</span></td>
       <td><span class="covered code">function date_make_iso_valid($iso_string) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2911</span></td>
       <td><span class="comment code">  // If this isn't a value that uses an ISO pattern, there is nothing to do.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2912</span></td>
       <td><span class="missed code">  if (is_numeric($iso_string) || !preg_match(DATE_REGEX_ISO, $iso_string)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2913</span></td>
       <td><span class="missed code">    return $iso_string;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2914</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2915</span></td>
       <td><span class="comment code">  // First see if month and day parts are '-00-00'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2916</span></td>
       <td><span class="missed code">  if (substr($iso_string, 4, 6) == '-00-00') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2917</span></td>
       <td><span class="missed code">    return preg_replace('/([\d]{4}-)(00-00)(T[\d]{2}:[\d]{2}:[\d]{2})/', '${1}01-01${3}', $iso_string);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2918</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2919</span></td>
       <td><span class="comment code">  // Then see if the day part is '-00'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2920</span></td>
       <td><span class="missed code">  elseif (substr($iso_string, 7, 3) == '-00') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2921</span></td>
       <td><span class="missed code">    return preg_replace('/([\d]{4}-[\d]{2}-)(00)(T[\d]{2}:[\d]{2}:[\d]{2})/', '${1}01${3}', $iso_string);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2922</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2923</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2924</span></td>
       <td><span class="comment code">  // Fall through, no changes required.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2925</span></td>
       <td><span class="missed code">  return $iso_string;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2926</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2927</span></td>
       <td><span class="covered code"></span></td>
    </tr>
  </tbody>
</table>
<h2>Legend</h2>
<dl>
  <dt><span class="missed">Missed</span></dt>
  <dd>lines code that <strong>were not</strong> excersized during program execution.</dd>
  <dt><span class="covered">Covered</span></dt>
  <dd>lines code <strong>were</strong> excersized during program execution.</dd>
  <dt><span class="comment">Comment/non executable</span></dt>
  <dd>Comment or non-executable line of code.</dd>
  <dt><span class="dead">Dead</span></dt>
  <dd>lines of code that according to xdebug could not be executed.  This is counted as coverage code because 
  in almost all cases it is code that runnable.</dd>
</dl>
</body>
</html>
