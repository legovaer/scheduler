<html>
<head>
<title>Simpletest Coverage - modules/simpletest/drupal_web_test_case.php</title>
</head>
<style type="text/css">
body {
  font-family: "Gill Sans MT", "Gill Sans", GillSans, Arial, Helvetica, sans-serif;
}
h1 {
  font-size: medium;
}
#code {
  border-spacing: 0;
}
.lineNo {
  color: #ccc;
}
.code, .lineNo {
  white-space: pre;
  font-family: monospace;
}
.covered {
  color: #090;
}
.missed {
  color: #f00;
}
.dead {
  color: #00f;
}
.comment {
  color: #333;
}
</style>
<body>
<h1 id="title">Simpletest Coverage - modules/simpletest/drupal_web_test_case.php</h1>
<table id="code">
  <tbody>
    <tr>
       <td><span class="lineNo">1</span></td>
       <td><span class="comment code">&lt;?php
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">4</span></td>
       <td><span class="comment code"> * Global variable that holds information about the tests being run.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">5</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">6</span></td>
       <td><span class="comment code"> * An array, with the following keys:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">7</span></td>
       <td><span class="comment code"> *  - 'test_run_id': the ID of the test being run, in the form 'simpletest_%&quot;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">8</span></td>
       <td><span class="comment code"> *  - 'in_child_site': TRUE if the current request is a cURL request from
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">9</span></td>
       <td><span class="comment code"> *     the parent site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">10</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">11</span></td>
       <td><span class="comment code"> * @var array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">12</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">13</span></td>
       <td><span class="covered code">global $drupal_test_info;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">14</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">15</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">16</span></td>
       <td><span class="comment code"> * Base class for Drupal tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">17</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">18</span></td>
       <td><span class="comment code"> * Do not extend this class, use one of the subclasses in this file.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">19</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">20</span></td>
       <td><span class="covered code">abstract class DrupalTestCase {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">21</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">22</span></td>
       <td><span class="comment code">   * The test run ID.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">23</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">24</span></td>
       <td><span class="comment code">   * @var string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">25</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">26</span></td>
       <td><span class="comment code">  protected $testId;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">27</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">28</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">29</span></td>
       <td><span class="comment code">   * The database prefix of this test run.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">30</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">31</span></td>
       <td><span class="comment code">   * @var string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">32</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">33</span></td>
       <td><span class="comment code">  protected $databasePrefix = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">34</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">35</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">36</span></td>
       <td><span class="covered code">   * The original file directory, before it was changed for testing purposes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">37</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">38</span></td>
       <td><span class="comment code">   * @var string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">39</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">40</span></td>
       <td><span class="comment code">  protected $originalFileDirectory = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">41</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">42</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">43</span></td>
       <td><span class="comment code">   * Time limit for the test.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">44</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">45</span></td>
       <td><span class="comment code">  protected $timeLimit = 500;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">46</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">47</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">48</span></td>
       <td><span class="comment code">   * Current results of this test case.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">49</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">50</span></td>
       <td><span class="comment code">   * @var Array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">51</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">52</span></td>
       <td><span class="comment code">  public $results = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">53</span></td>
       <td><span class="comment code">    '#pass' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">54</span></td>
       <td><span class="comment code">    '#fail' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">55</span></td>
       <td><span class="comment code">    '#exception' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">56</span></td>
       <td><span class="comment code">    '#debug' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">57</span></td>
       <td><span class="comment code">  );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">58</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">59</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">60</span></td>
       <td><span class="comment code">   * Assertions thrown in that test case.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">61</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">62</span></td>
       <td><span class="comment code">   * @var Array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">63</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">64</span></td>
       <td><span class="comment code">  protected $assertions = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">65</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">66</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">67</span></td>
       <td><span class="comment code">   * This class is skipped when looking for the source of an assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">68</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">69</span></td>
       <td><span class="comment code">   * When displaying which function an assert comes from, it's not too useful
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">70</span></td>
       <td><span class="comment code">   * to see &quot;drupalWebTestCase-&gt;drupalLogin()', we would like to see the test
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">71</span></td>
       <td><span class="comment code">   * that called it. So we need to skip the classes defining these helper
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">72</span></td>
       <td><span class="comment code">   * methods.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">73</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">74</span></td>
       <td><span class="comment code">  protected $skipClasses = array(__CLASS__ =&gt; TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">75</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">76</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">77</span></td>
       <td><span class="comment code">   * Flag to indicate whether the test has been set up.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">78</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">79</span></td>
       <td><span class="comment code">   * The setUp() method isolates the test from the parent Drupal site by
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">80</span></td>
       <td><span class="comment code">   * creating a random prefix for the database and setting up a clean file
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">81</span></td>
       <td><span class="comment code">   * storage directory. The tearDown() method then cleans up this test
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">82</span></td>
       <td><span class="comment code">   * environment. We must ensure that setUp() has been run. Otherwise,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">83</span></td>
       <td><span class="comment code">   * tearDown() will act on the parent Drupal site rather than the test
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">84</span></td>
       <td><span class="comment code">   * environment, destroying live data.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">85</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">86</span></td>
       <td><span class="comment code">  protected $setup = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">87</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">88</span></td>
       <td><span class="comment code">  protected $setupDatabasePrefix = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">89</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">90</span></td>
       <td><span class="comment code">  protected $setupEnvironment = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">91</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">92</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">93</span></td>
       <td><span class="comment code">   * Constructor for DrupalTestCase.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">94</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">95</span></td>
       <td><span class="comment code">   * @param $test_id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">96</span></td>
       <td><span class="comment code">   *   Tests with the same id are reported together.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">97</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">98</span></td>
       <td><span class="comment code">  public function __construct($test_id = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">99</span></td>
       <td><span class="covered code">    $this-&gt;testId = $test_id;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">100</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">101</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">102</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">103</span></td>
       <td><span class="comment code">   * Internal helper: stores the assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">104</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">105</span></td>
       <td><span class="comment code">   * @param $status
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">106</span></td>
       <td><span class="comment code">   *   Can be 'pass', 'fail', 'exception'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">107</span></td>
       <td><span class="comment code">   *   TRUE is a synonym for 'pass', FALSE for 'fail'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">108</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">109</span></td>
       <td><span class="comment code">   *   The message string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">110</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">111</span></td>
       <td><span class="comment code">   *   Which group this assert belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">112</span></td>
       <td><span class="comment code">   * @param $caller
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">113</span></td>
       <td><span class="comment code">   *   By default, the assert comes from a function whose name starts with
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">114</span></td>
       <td><span class="comment code">   *   'test'. Instead, you can specify where this assert originates from
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">115</span></td>
       <td><span class="comment code">   *   by passing in an associative array as $caller. Key 'file' is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">116</span></td>
       <td><span class="comment code">   *   the name of the source file, 'line' is the line number and 'function'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">117</span></td>
       <td><span class="comment code">   *   is the caller function itself.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">118</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">119</span></td>
       <td><span class="comment code">  protected function assert($status, $message = '', $group = 'Other', array $caller = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">120</span></td>
       <td><span class="comment code">    // Convert boolean status to string status.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">121</span></td>
       <td><span class="covered code">    if (is_bool($status)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">122</span></td>
       <td><span class="covered code">      $status = $status ? 'pass' : 'fail';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">123</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">124</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">125</span></td>
       <td><span class="comment code">    // Increment summary result counter.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">126</span></td>
       <td><span class="covered code">    $this-&gt;results['#' . $status]++;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">127</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">128</span></td>
       <td><span class="comment code">    // Get the function information about the call to the assertion method.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">129</span></td>
       <td><span class="covered code">    if (!$caller) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">130</span></td>
       <td><span class="covered code">      $caller = $this-&gt;getAssertionCall();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">131</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">132</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">133</span></td>
       <td><span class="comment code">    // Creation assertion array that can be displayed while tests are running.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">134</span></td>
       <td><span class="covered code">    $this-&gt;assertions[] = $assertion = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">135</span></td>
       <td><span class="covered code">      'test_id' =&gt; $this-&gt;testId,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">136</span></td>
       <td><span class="covered code">      'test_class' =&gt; get_class($this),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">137</span></td>
       <td><span class="covered code">      'status' =&gt; $status,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">138</span></td>
       <td><span class="covered code">      'message' =&gt; $message,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">139</span></td>
       <td><span class="covered code">      'message_group' =&gt; $group,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">140</span></td>
       <td><span class="covered code">      'function' =&gt; $caller['function'],
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">141</span></td>
       <td><span class="covered code">      'line' =&gt; $caller['line'],
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">142</span></td>
       <td><span class="covered code">      'file' =&gt; $caller['file'],
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">143</span></td>
       <td><span class="covered code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">144</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">145</span></td>
       <td><span class="comment code">    // Store assertion for display after the test has completed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">146</span></td>
       <td><span class="covered code">    self::getDatabaseConnection()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">147</span></td>
       <td><span class="covered code">      -&gt;insert('simpletest')
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">148</span></td>
       <td><span class="covered code">      -&gt;fields($assertion)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">149</span></td>
       <td><span class="covered code">      -&gt;execute();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">150</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">151</span></td>
       <td><span class="comment code">    // We do not use a ternary operator here to allow a breakpoint on
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">152</span></td>
       <td><span class="comment code">    // test failure.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">153</span></td>
       <td><span class="covered code">    if ($status == 'pass') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">154</span></td>
       <td><span class="covered code">      return TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">155</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">156</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">157</span></td>
       <td><span class="covered code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">158</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">159</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">160</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">161</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">162</span></td>
       <td><span class="comment code">   * Returns the database connection to the site running Simpletest.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">163</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">164</span></td>
       <td><span class="comment code">   * @return DatabaseConnection
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">165</span></td>
       <td><span class="comment code">   *   The database connection to use for inserting assertions.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">166</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">167</span></td>
       <td><span class="comment code">  public static function getDatabaseConnection() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">168</span></td>
       <td><span class="comment code">    try {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">169</span></td>
       <td><span class="covered code">      $connection = Database::getConnection('default', 'simpletest_original_default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">170</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">171</span></td>
       <td><span class="covered code">    catch (DatabaseConnectionNotDefinedException $e) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">172</span></td>
       <td><span class="comment code">      // If the test was not set up, the simpletest_original_default
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">173</span></td>
       <td><span class="comment code">      // connection does not exist.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">174</span></td>
       <td><span class="covered code">      $connection = Database::getConnection('default', 'default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">175</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">176</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">177</span></td>
       <td><span class="covered code">    return $connection;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">178</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">179</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">180</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">181</span></td>
       <td><span class="comment code">   * Store an assertion from outside the testing context.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">182</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">183</span></td>
       <td><span class="comment code">   * This is useful for inserting assertions that can only be recorded after
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">184</span></td>
       <td><span class="comment code">   * the test case has been destroyed, such as PHP fatal errors. The caller
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">185</span></td>
       <td><span class="comment code">   * information is not automatically gathered since the caller is most likely
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">186</span></td>
       <td><span class="comment code">   * inserting the assertion on behalf of other code. In all other respects
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">187</span></td>
       <td><span class="comment code">   * the method behaves just like DrupalTestCase::assert() in terms of storing
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">188</span></td>
       <td><span class="comment code">   * the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">189</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">190</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">191</span></td>
       <td><span class="comment code">   *   Message ID of the stored assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">192</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">193</span></td>
       <td><span class="comment code">   * @see DrupalTestCase::assert()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">194</span></td>
       <td><span class="comment code">   * @see DrupalTestCase::deleteAssert()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">195</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">196</span></td>
       <td><span class="comment code">  public static function insertAssert($test_id, $test_class, $status, $message = '', $group = 'Other', array $caller = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">197</span></td>
       <td><span class="comment code">    // Convert boolean status to string status.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">198</span></td>
       <td><span class="covered code">    if (is_bool($status)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">199</span></td>
       <td><span class="covered code">      $status = $status ? 'pass' : 'fail';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">200</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">201</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">202</span></td>
       <td><span class="comment code">    $caller += array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">203</span></td>
       <td><span class="covered code">      'function' =&gt; t('Unknown'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">204</span></td>
       <td><span class="covered code">      'line' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">205</span></td>
       <td><span class="covered code">      'file' =&gt; t('Unknown'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">206</span></td>
       <td><span class="missed code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">207</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">208</span></td>
       <td><span class="comment code">    $assertion = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">209</span></td>
       <td><span class="covered code">      'test_id' =&gt; $test_id,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">210</span></td>
       <td><span class="covered code">      'test_class' =&gt; $test_class,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">211</span></td>
       <td><span class="covered code">      'status' =&gt; $status,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">212</span></td>
       <td><span class="covered code">      'message' =&gt; $message,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">213</span></td>
       <td><span class="covered code">      'message_group' =&gt; $group,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">214</span></td>
       <td><span class="covered code">      'function' =&gt; $caller['function'],
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">215</span></td>
       <td><span class="covered code">      'line' =&gt; $caller['line'],
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">216</span></td>
       <td><span class="covered code">      'file' =&gt; $caller['file'],
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">217</span></td>
       <td><span class="covered code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">218</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">219</span></td>
       <td><span class="covered code">    return self::getDatabaseConnection()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">220</span></td>
       <td><span class="covered code">      -&gt;insert('simpletest')
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">221</span></td>
       <td><span class="covered code">      -&gt;fields($assertion)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">222</span></td>
       <td><span class="covered code">      -&gt;execute();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">223</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">224</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">225</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">226</span></td>
       <td><span class="comment code">   * Delete an assertion record by message ID.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">227</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">228</span></td>
       <td><span class="comment code">   * @param $message_id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">229</span></td>
       <td><span class="comment code">   *   Message ID of the assertion to delete.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">230</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">231</span></td>
       <td><span class="comment code">   *   TRUE if the assertion was deleted, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">232</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">233</span></td>
       <td><span class="comment code">   * @see DrupalTestCase::insertAssert()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">234</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">235</span></td>
       <td><span class="comment code">  public static function deleteAssert($message_id) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">236</span></td>
       <td><span class="covered code">    return (bool) self::getDatabaseConnection()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">237</span></td>
       <td><span class="covered code">      -&gt;delete('simpletest')
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">238</span></td>
       <td><span class="covered code">      -&gt;condition('message_id', $message_id)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">239</span></td>
       <td><span class="covered code">      -&gt;execute();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">240</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">241</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">242</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">243</span></td>
       <td><span class="comment code">   * Cycles through backtrace until the first non-assertion method is found.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">244</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">245</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">246</span></td>
       <td><span class="comment code">   *   Array representing the true caller.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">247</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">248</span></td>
       <td><span class="comment code">  protected function getAssertionCall() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">249</span></td>
       <td><span class="covered code">    $backtrace = debug_backtrace();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">250</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">251</span></td>
       <td><span class="comment code">    // The first element is the call. The second element is the caller.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">252</span></td>
       <td><span class="comment code">    // We skip calls that occurred in one of the methods of our base classes
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">253</span></td>
       <td><span class="comment code">    // or in an assertion function.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">254</span></td>
       <td><span class="covered code">   while (($caller = $backtrace[1]) &amp;&amp;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">255</span></td>
       <td><span class="covered code">         ((isset($caller['class']) &amp;&amp; isset($this-&gt;skipClasses[$caller['class']])) ||
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">256</span></td>
       <td><span class="covered code">           substr($caller['function'], 0, 6) == 'assert')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">257</span></td>
       <td><span class="comment code">      // We remove that call.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">258</span></td>
       <td><span class="covered code">      array_shift($backtrace);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">259</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">260</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">261</span></td>
       <td><span class="covered code">    return _drupal_get_last_caller($backtrace);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">262</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">263</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">264</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">265</span></td>
       <td><span class="comment code">   * Check to see if a value is not false (not an empty string, 0, NULL, or FALSE).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">266</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">267</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">268</span></td>
       <td><span class="comment code">   *   The value on which the assertion is to be done.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">269</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">270</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">271</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">272</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">273</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">274</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">275</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">276</span></td>
       <td><span class="comment code">  protected function assertTrue($value, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">277</span></td>
       <td><span class="covered code">    return $this-&gt;assert((bool) $value, $message ? $message : t('Value @value is TRUE.', array('@value' =&gt; var_export($value, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">278</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">279</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">280</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">281</span></td>
       <td><span class="comment code">   * Check to see if a value is false (an empty string, 0, NULL, or FALSE).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">282</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">283</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">284</span></td>
       <td><span class="comment code">   *   The value on which the assertion is to be done.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">285</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">286</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">287</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">288</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">289</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">290</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">291</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">292</span></td>
       <td><span class="comment code">  protected function assertFalse($value, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">293</span></td>
       <td><span class="covered code">    return $this-&gt;assert(!$value, $message ? $message : t('Value @value is FALSE.', array('@value' =&gt; var_export($value, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">294</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">295</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">296</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">297</span></td>
       <td><span class="comment code">   * Check to see if a value is NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">298</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">299</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">300</span></td>
       <td><span class="comment code">   *   The value on which the assertion is to be done.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">301</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">302</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">303</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">304</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">305</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">306</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">307</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">308</span></td>
       <td><span class="comment code">  protected function assertNull($value, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">309</span></td>
       <td><span class="missed code">    return $this-&gt;assert(!isset($value), $message ? $message : t('Value @value is NULL.', array('@value' =&gt; var_export($value, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">310</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">311</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">312</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">313</span></td>
       <td><span class="comment code">   * Check to see if a value is not NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">314</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">315</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">316</span></td>
       <td><span class="comment code">   *   The value on which the assertion is to be done.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">317</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">318</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">319</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">320</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">321</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">322</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">323</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">324</span></td>
       <td><span class="comment code">  protected function assertNotNull($value, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">325</span></td>
       <td><span class="missed code">    return $this-&gt;assert(isset($value), $message ? $message : t('Value @value is not NULL.', array('@value' =&gt; var_export($value, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">326</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">327</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">328</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">329</span></td>
       <td><span class="comment code">   * Check to see if two values are equal.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">330</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">331</span></td>
       <td><span class="comment code">   * @param $first
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">332</span></td>
       <td><span class="comment code">   *   The first value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">333</span></td>
       <td><span class="comment code">   * @param $second
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">334</span></td>
       <td><span class="comment code">   *   The second value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">335</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">336</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">337</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">338</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">339</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">340</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">341</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">342</span></td>
       <td><span class="comment code">  protected function assertEqual($first, $second, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">343</span></td>
       <td><span class="covered code">    return $this-&gt;assert($first == $second, $message ? $message : t('Value @first is equal to value @second.', array('@first' =&gt; var_export($first, TRUE), '@second' =&gt; var_export($second, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">344</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">345</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">346</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">347</span></td>
       <td><span class="comment code">   * Check to see if two values are not equal.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">348</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">349</span></td>
       <td><span class="comment code">   * @param $first
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">350</span></td>
       <td><span class="comment code">   *   The first value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">351</span></td>
       <td><span class="comment code">   * @param $second
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">352</span></td>
       <td><span class="comment code">   *   The second value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">353</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">354</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">355</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">356</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">357</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">358</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">359</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">360</span></td>
       <td><span class="comment code">  protected function assertNotEqual($first, $second, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">361</span></td>
       <td><span class="missed code">    return $this-&gt;assert($first != $second, $message ? $message : t('Value @first is not equal to value @second.', array('@first' =&gt; var_export($first, TRUE), '@second' =&gt; var_export($second, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">362</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">363</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">364</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">365</span></td>
       <td><span class="comment code">   * Check to see if two values are identical.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">366</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">367</span></td>
       <td><span class="comment code">   * @param $first
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">368</span></td>
       <td><span class="comment code">   *   The first value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">369</span></td>
       <td><span class="comment code">   * @param $second
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">370</span></td>
       <td><span class="comment code">   *   The second value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">371</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">372</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">373</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">374</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">375</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">376</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">377</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">378</span></td>
       <td><span class="comment code">  protected function assertIdentical($first, $second, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">379</span></td>
       <td><span class="missed code">    return $this-&gt;assert($first === $second, $message ? $message : t('Value @first is identical to value @second.', array('@first' =&gt; var_export($first, TRUE), '@second' =&gt; var_export($second, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">380</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">381</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">382</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">383</span></td>
       <td><span class="comment code">   * Check to see if two values are not identical.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">384</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">385</span></td>
       <td><span class="comment code">   * @param $first
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">386</span></td>
       <td><span class="comment code">   *   The first value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">387</span></td>
       <td><span class="comment code">   * @param $second
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">388</span></td>
       <td><span class="comment code">   *   The second value to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">389</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">390</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">391</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">392</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">393</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">394</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">395</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">396</span></td>
       <td><span class="comment code">  protected function assertNotIdentical($first, $second, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">397</span></td>
       <td><span class="missed code">    return $this-&gt;assert($first !== $second, $message ? $message : t('Value @first is not identical to value @second.', array('@first' =&gt; var_export($first, TRUE), '@second' =&gt; var_export($second, TRUE))), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">398</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">399</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">400</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">401</span></td>
       <td><span class="comment code">   * Fire an assertion that is always positive.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">402</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">403</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">404</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">405</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">406</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">407</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">408</span></td>
       <td><span class="comment code">   *   TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">409</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">410</span></td>
       <td><span class="comment code">  protected function pass($message = NULL, $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">411</span></td>
       <td><span class="covered code">    return $this-&gt;assert(TRUE, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">412</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">413</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">414</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">415</span></td>
       <td><span class="comment code">   * Fire an assertion that is always negative.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">416</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">417</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">418</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">419</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">420</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">421</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">422</span></td>
       <td><span class="comment code">   *   FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">423</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">424</span></td>
       <td><span class="comment code">  protected function fail($message = NULL, $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">425</span></td>
       <td><span class="missed code">    return $this-&gt;assert(FALSE, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">426</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">427</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">428</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">429</span></td>
       <td><span class="comment code">   * Fire an error assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">430</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">431</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">432</span></td>
       <td><span class="comment code">   *   The message to display along with the assertion.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">433</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">434</span></td>
       <td><span class="comment code">   *   The type of assertion - examples are &quot;Browser&quot;, &quot;PHP&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">435</span></td>
       <td><span class="comment code">   * @param $caller
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">436</span></td>
       <td><span class="comment code">   *   The caller of the error.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">437</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">438</span></td>
       <td><span class="comment code">   *   FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">439</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">440</span></td>
       <td><span class="comment code">  protected function error($message = '', $group = 'Other', array $caller = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">441</span></td>
       <td><span class="covered code">    if ($group == 'User notice') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">442</span></td>
       <td><span class="comment code">      // Since 'User notice' is set by trigger_error() which is used for debug
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">443</span></td>
       <td><span class="comment code">      // set the message to a status of 'debug'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">444</span></td>
       <td><span class="covered code">      return $this-&gt;assert('debug', $message, 'Debug', $caller);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">445</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">446</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">447</span></td>
       <td><span class="missed code">    return $this-&gt;assert('exception', $message, $group, $caller);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">448</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">449</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">450</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">451</span></td>
       <td><span class="comment code">   * Logs a verbose message in a text file.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">452</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">453</span></td>
       <td><span class="comment code">   * The link to the verbose message will be placed in the test results as a
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">454</span></td>
       <td><span class="comment code">   * passing assertion with the text '[verbose message]'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">455</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">456</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">457</span></td>
       <td><span class="comment code">   *   The verbose message to be stored.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">458</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">459</span></td>
       <td><span class="comment code">   * @see simpletest_verbose()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">460</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">461</span></td>
       <td><span class="comment code">  protected function verbose($message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">462</span></td>
       <td><span class="covered code">    if ($id = simpletest_verbose($message)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">463</span></td>
       <td><span class="covered code">      $class_safe = str_replace('\\', '_', get_class($this));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">464</span></td>
       <td><span class="covered code">      $url = file_create_url($this-&gt;originalFileDirectory . '/simpletest/verbose/' . $class_safe . '-' . $id . '.html');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">465</span></td>
       <td><span class="covered code">      $this-&gt;error(l(t('Verbose message'), $url, array('attributes' =&gt; array('target' =&gt; '_blank'))), 'User notice');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">466</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">467</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">468</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">469</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">470</span></td>
       <td><span class="comment code">   * Run all tests in this class.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">471</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">472</span></td>
       <td><span class="comment code">   * Regardless of whether $methods are passed or not, only method names
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">473</span></td>
       <td><span class="comment code">   * starting with &quot;test&quot; are executed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">474</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">475</span></td>
       <td><span class="comment code">   * @param $methods
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">476</span></td>
       <td><span class="comment code">   *   (optional) A list of method names in the test case class to run; e.g.,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">477</span></td>
       <td><span class="comment code">   *   array('testFoo', 'testBar'). By default, all methods of the class are
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">478</span></td>
       <td><span class="comment code">   *   taken into account, but it can be useful to only run a few selected test
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">479</span></td>
       <td><span class="comment code">   *   methods during debugging.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">480</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">481</span></td>
       <td><span class="comment code">  public function run(array $methods = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">482</span></td>
       <td><span class="comment code">    // Initialize verbose debugging.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">483</span></td>
       <td><span class="covered code">    $class = get_class($this);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">484</span></td>
       <td><span class="covered code">    simpletest_verbose(NULL, variable_get('file_public_path', conf_path() . '/files'), str_replace('\\', '_', $class));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">485</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">486</span></td>
       <td><span class="comment code">    // HTTP auth settings (&lt;username&gt;:&lt;password&gt;) for the simpletest browser
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">487</span></td>
       <td><span class="comment code">    // when sending requests to the test site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">488</span></td>
       <td><span class="covered code">    $this-&gt;httpauth_method = variable_get('simpletest_httpauth_method', CURLAUTH_BASIC);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">489</span></td>
       <td><span class="covered code">    $username = variable_get('simpletest_httpauth_username', NULL);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">490</span></td>
       <td><span class="covered code">    $password = variable_get('simpletest_httpauth_password', NULL);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">491</span></td>
       <td><span class="covered code">    if ($username &amp;&amp; $password) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">492</span></td>
       <td><span class="missed code">      $this-&gt;httpauth_credentials = $username . ':' . $password;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">493</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">494</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">495</span></td>
       <td><span class="covered code">    set_error_handler(array($this, 'errorHandler'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">496</span></td>
       <td><span class="comment code">    // Iterate through all the methods in this class, unless a specific list of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">497</span></td>
       <td><span class="comment code">    // methods to run was passed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">498</span></td>
       <td><span class="covered code">    $class_methods = get_class_methods($class);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">499</span></td>
       <td><span class="covered code">    if ($methods) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">500</span></td>
       <td><span class="missed code">      $class_methods = array_intersect($class_methods, $methods);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">501</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">502</span></td>
       <td><span class="covered code">    foreach ($class_methods as $method) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">503</span></td>
       <td><span class="comment code">      // If the current method starts with &quot;test&quot;, run it - it's a test.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">504</span></td>
       <td><span class="covered code">      if (strtolower(substr($method, 0, 4)) == 'test') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">505</span></td>
       <td><span class="comment code">        // Insert a fail record. This will be deleted on completion to ensure
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">506</span></td>
       <td><span class="comment code">        // that testing completed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">507</span></td>
       <td><span class="covered code">        $method_info = new ReflectionMethod($class, $method);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">508</span></td>
       <td><span class="comment code">        $caller = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">509</span></td>
       <td><span class="covered code">          'file' =&gt; $method_info-&gt;getFileName(),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">510</span></td>
       <td><span class="covered code">          'line' =&gt; $method_info-&gt;getStartLine(),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">511</span></td>
       <td><span class="covered code">          'function' =&gt; $class . '-&gt;' . $method . '()',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">512</span></td>
       <td><span class="covered code">        );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">513</span></td>
       <td><span class="covered code">        $completion_check_id = DrupalTestCase::insertAssert($this-&gt;testId, $class, FALSE, t('The test did not complete due to a fatal error.'), 'Completion check', $caller);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">514</span></td>
       <td><span class="covered code">        $this-&gt;setUp();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">515</span></td>
       <td><span class="covered code">        if ($this-&gt;setup) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">516</span></td>
       <td><span class="comment code">          try {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">517</span></td>
       <td><span class="covered code">            $this-&gt;$method();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">518</span></td>
       <td><span class="comment code">            // Finish up.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">519</span></td>
       <td><span class="comment code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">520</span></td>
       <td><span class="covered code">          catch (Exception $e) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">521</span></td>
       <td><span class="missed code">            $this-&gt;exceptionHandler($e);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">522</span></td>
       <td><span class="comment code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">523</span></td>
       <td><span class="covered code">          $this-&gt;tearDown();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">524</span></td>
       <td><span class="covered code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">525</span></td>
       <td><span class="comment code">        else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">526</span></td>
       <td><span class="missed code">          $this-&gt;fail(t(&quot;The test cannot be executed because it has not been set up properly.&quot;));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">527</span></td>
       <td><span class="comment code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">528</span></td>
       <td><span class="comment code">        // Remove the completion check record.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">529</span></td>
       <td><span class="covered code">        DrupalTestCase::deleteAssert($completion_check_id);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">530</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">531</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">532</span></td>
       <td><span class="comment code">    // Clear out the error messages and restore error handler.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">533</span></td>
       <td><span class="covered code">    drupal_get_messages();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">534</span></td>
       <td><span class="covered code">    restore_error_handler();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">535</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">536</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">537</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">538</span></td>
       <td><span class="comment code">   * Handle errors during test runs.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">539</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">540</span></td>
       <td><span class="comment code">   * Because this is registered in set_error_handler(), it has to be public.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">541</span></td>
       <td><span class="comment code">   * @see set_error_handler
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">542</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">543</span></td>
       <td><span class="comment code">  public function errorHandler($severity, $message, $file = NULL, $line = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">544</span></td>
       <td><span class="covered code">    if ($severity &amp; error_reporting()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">545</span></td>
       <td><span class="comment code">      $error_map = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">546</span></td>
       <td><span class="missed code">        E_STRICT =&gt; 'Run-time notice',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">547</span></td>
       <td><span class="missed code">        E_WARNING =&gt; 'Warning',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">548</span></td>
       <td><span class="missed code">        E_NOTICE =&gt; 'Notice',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">549</span></td>
       <td><span class="missed code">        E_CORE_ERROR =&gt; 'Core error',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">550</span></td>
       <td><span class="missed code">        E_CORE_WARNING =&gt; 'Core warning',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">551</span></td>
       <td><span class="missed code">        E_USER_ERROR =&gt; 'User error',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">552</span></td>
       <td><span class="missed code">        E_USER_WARNING =&gt; 'User warning',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">553</span></td>
       <td><span class="missed code">        E_USER_NOTICE =&gt; 'User notice',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">554</span></td>
       <td><span class="missed code">        E_RECOVERABLE_ERROR =&gt; 'Recoverable error',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">555</span></td>
       <td><span class="missed code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">556</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">557</span></td>
       <td><span class="comment code">      // PHP 5.3 adds new error logging constants. Add these conditionally for
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">558</span></td>
       <td><span class="comment code">      // backwards compatibility with PHP 5.2.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">559</span></td>
       <td><span class="missed code">      if (defined('E_DEPRECATED')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">560</span></td>
       <td><span class="comment code">        $error_map += array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">561</span></td>
       <td><span class="missed code">          E_DEPRECATED =&gt; 'Deprecated',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">562</span></td>
       <td><span class="missed code">          E_USER_DEPRECATED =&gt; 'User deprecated',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">563</span></td>
       <td><span class="missed code">        );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">564</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">565</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">566</span></td>
       <td><span class="missed code">      $backtrace = debug_backtrace();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">567</span></td>
       <td><span class="missed code">      $this-&gt;error($message, $error_map[$severity], _drupal_get_last_caller($backtrace));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">568</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">569</span></td>
       <td><span class="covered code">    return TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">570</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">571</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">572</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">573</span></td>
       <td><span class="comment code">   * Handle exceptions.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">574</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">575</span></td>
       <td><span class="comment code">   * @see set_exception_handler
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">576</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">577</span></td>
       <td><span class="comment code">  protected function exceptionHandler($exception) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">578</span></td>
       <td><span class="missed code">    $backtrace = $exception-&gt;getTrace();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">579</span></td>
       <td><span class="comment code">    // Push on top of the backtrace the call that generated the exception.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">580</span></td>
       <td><span class="missed code">    array_unshift($backtrace, array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">581</span></td>
       <td><span class="missed code">      'line' =&gt; $exception-&gt;getLine(),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">582</span></td>
       <td><span class="missed code">      'file' =&gt; $exception-&gt;getFile(),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">583</span></td>
       <td><span class="missed code">    ));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">584</span></td>
       <td><span class="missed code">    require_once DRUPAL_ROOT . '/includes/errors.inc';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">585</span></td>
       <td><span class="comment code">    // The exception message is run through check_plain() by _drupal_decode_exception().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">586</span></td>
       <td><span class="missed code">    $this-&gt;error(t('%type: !message in %function (line %line of %file).', _drupal_decode_exception($exception)), 'Uncaught exception', _drupal_get_last_caller($backtrace));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">587</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">588</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">589</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">590</span></td>
       <td><span class="comment code">   * Generates a random string of ASCII characters of codes 32 to 126.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">591</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">592</span></td>
       <td><span class="comment code">   * The generated string includes alpha-numeric characters and common
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">593</span></td>
       <td><span class="comment code">   * miscellaneous characters. Use this method when testing general input
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">594</span></td>
       <td><span class="comment code">   * where the content is not restricted.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">595</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">596</span></td>
       <td><span class="comment code">   * Do not use this method when special characters are not possible (e.g., in
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">597</span></td>
       <td><span class="comment code">   * machine or file names that have already been validated); instead,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">598</span></td>
       <td><span class="comment code">   * use DrupalWebTestCase::randomName().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">599</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">600</span></td>
       <td><span class="comment code">   * @param $length
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">601</span></td>
       <td><span class="comment code">   *   Length of random string to generate.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">602</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">603</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">604</span></td>
       <td><span class="comment code">   *   Randomly generated string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">605</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">606</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::randomName()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">607</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">608</span></td>
       <td><span class="comment code">  public static function randomString($length = 8) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">609</span></td>
       <td><span class="covered code">    $str = '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">610</span></td>
       <td><span class="covered code">    for ($i = 0; $i &lt; $length; $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">611</span></td>
       <td><span class="covered code">      $str .= chr(mt_rand(32, 126));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">612</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">613</span></td>
       <td><span class="covered code">    return $str;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">614</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">615</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">616</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">617</span></td>
       <td><span class="comment code">   * Generates a random string containing letters and numbers.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">618</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">619</span></td>
       <td><span class="comment code">   * The string will always start with a letter. The letters may be upper or
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">620</span></td>
       <td><span class="comment code">   * lower case. This method is better for restricted inputs that do not
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">621</span></td>
       <td><span class="comment code">   * accept certain characters. For example, when testing input fields that
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">622</span></td>
       <td><span class="comment code">   * require machine readable values (i.e. without spaces and non-standard
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">623</span></td>
       <td><span class="comment code">   * characters) this method is best.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">624</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">625</span></td>
       <td><span class="comment code">   * Do not use this method when testing unvalidated user input. Instead, use
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">626</span></td>
       <td><span class="comment code">   * DrupalWebTestCase::randomString().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">627</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">628</span></td>
       <td><span class="comment code">   * @param $length
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">629</span></td>
       <td><span class="comment code">   *   Length of random string to generate.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">630</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">631</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">632</span></td>
       <td><span class="comment code">   *   Randomly generated string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">633</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">634</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::randomString()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">635</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">636</span></td>
       <td><span class="comment code">  public static function randomName($length = 8) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">637</span></td>
       <td><span class="covered code">    $values = array_merge(range(65, 90), range(97, 122), range(48, 57));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">638</span></td>
       <td><span class="covered code">    $max = count($values) - 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">639</span></td>
       <td><span class="covered code">    $str = chr(mt_rand(97, 122));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">640</span></td>
       <td><span class="covered code">    for ($i = 1; $i &lt; $length; $i++) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">641</span></td>
       <td><span class="covered code">      $str .= chr($values[mt_rand(0, $max)]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">642</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">643</span></td>
       <td><span class="covered code">    return $str;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">644</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">645</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">646</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">647</span></td>
       <td><span class="comment code">   * Converts a list of possible parameters into a stack of permutations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">648</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">649</span></td>
       <td><span class="comment code">   * Takes a list of parameters containing possible values, and converts all of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">650</span></td>
       <td><span class="comment code">   * them into a list of items containing every possible permutation.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">651</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">652</span></td>
       <td><span class="comment code">   * Example:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">653</span></td>
       <td><span class="comment code">   * @code
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">654</span></td>
       <td><span class="comment code">   * $parameters = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">655</span></td>
       <td><span class="comment code">   *   'one' =&gt; array(0, 1),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">656</span></td>
       <td><span class="comment code">   *   'two' =&gt; array(2, 3),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">657</span></td>
       <td><span class="comment code">   * );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">658</span></td>
       <td><span class="comment code">   * $permutations = DrupalTestCase::generatePermutations($parameters)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">659</span></td>
       <td><span class="comment code">   * // Result:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">660</span></td>
       <td><span class="comment code">   * $permutations == array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">661</span></td>
       <td><span class="comment code">   *   array('one' =&gt; 0, 'two' =&gt; 2),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">662</span></td>
       <td><span class="comment code">   *   array('one' =&gt; 1, 'two' =&gt; 2),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">663</span></td>
       <td><span class="comment code">   *   array('one' =&gt; 0, 'two' =&gt; 3),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">664</span></td>
       <td><span class="comment code">   *   array('one' =&gt; 1, 'two' =&gt; 3),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">665</span></td>
       <td><span class="comment code">   * )
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">666</span></td>
       <td><span class="comment code">   * @endcode
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">667</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">668</span></td>
       <td><span class="comment code">   * @param $parameters
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">669</span></td>
       <td><span class="comment code">   *   An associative array of parameters, keyed by parameter name, and whose
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">670</span></td>
       <td><span class="comment code">   *   values are arrays of parameter values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">671</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">672</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">673</span></td>
       <td><span class="comment code">   *   A list of permutations, which is an array of arrays. Each inner array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">674</span></td>
       <td><span class="comment code">   *   contains the full list of parameters that have been passed, but with a
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">675</span></td>
       <td><span class="comment code">   *   single value only.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">676</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">677</span></td>
       <td><span class="comment code">  public static function generatePermutations($parameters) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">678</span></td>
       <td><span class="missed code">    $all_permutations = array(array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">679</span></td>
       <td><span class="missed code">    foreach ($parameters as $parameter =&gt; $values) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">680</span></td>
       <td><span class="missed code">      $new_permutations = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">681</span></td>
       <td><span class="comment code">      // Iterate over all values of the parameter.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">682</span></td>
       <td><span class="missed code">      foreach ($values as $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">683</span></td>
       <td><span class="comment code">        // Iterate over all existing permutations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">684</span></td>
       <td><span class="missed code">        foreach ($all_permutations as $permutation) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">685</span></td>
       <td><span class="comment code">          // Add the new parameter value to existing permutations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">686</span></td>
       <td><span class="missed code">          $new_permutations[] = $permutation + array($parameter =&gt; $value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">687</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">688</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">689</span></td>
       <td><span class="comment code">      // Replace the old permutations with the new permutations.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">690</span></td>
       <td><span class="missed code">      $all_permutations = $new_permutations;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">691</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">692</span></td>
       <td><span class="missed code">    return $all_permutations;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">693</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">694</span></td>
       <td><span class="comment code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">695</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">696</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">697</span></td>
       <td><span class="comment code"> * Test case for Drupal unit tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">698</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">699</span></td>
       <td><span class="comment code"> * These tests can not access the database nor files. Calling any Drupal
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">700</span></td>
       <td><span class="comment code"> * function that needs the database will throw exceptions. These include
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">701</span></td>
       <td><span class="comment code"> * watchdog(), module_implements(), module_invoke_all() etc.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">702</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">703</span></td>
       <td><span class="covered code">class DrupalUnitTestCase extends DrupalTestCase {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">704</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">705</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">706</span></td>
       <td><span class="comment code">   * Constructor for DrupalUnitTestCase.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">707</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">708</span></td>
       <td><span class="comment code">  function __construct($test_id = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">709</span></td>
       <td><span class="missed code">    parent::__construct($test_id);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">710</span></td>
       <td><span class="missed code">    $this-&gt;skipClasses[__CLASS__] = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">711</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">712</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">713</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">714</span></td>
       <td><span class="comment code">   * Sets up unit test environment.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">715</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">716</span></td>
       <td><span class="comment code">   * Unlike DrupalWebTestCase::setUp(), DrupalUnitTestCase::setUp() does not
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">717</span></td>
       <td><span class="comment code">   * install modules because tests are performed without accessing the database.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">718</span></td>
       <td><span class="comment code">   * Any required files must be explicitly included by the child class setUp()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">719</span></td>
       <td><span class="comment code">   * method.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">720</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">721</span></td>
       <td><span class="comment code">  protected function setUp() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">722</span></td>
       <td><span class="missed code">    global $conf;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">723</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">724</span></td>
       <td><span class="comment code">    // Store necessary current values before switching to the test environment.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">725</span></td>
       <td><span class="missed code">    $this-&gt;originalFileDirectory = variable_get('file_public_path', conf_path() . '/files');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">726</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">727</span></td>
       <td><span class="comment code">    // Reset all statics so that test is performed with a clean environment.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">728</span></td>
       <td><span class="missed code">    drupal_static_reset();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">729</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">730</span></td>
       <td><span class="comment code">    // Generate temporary prefixed database to ensure that tests have a clean starting point.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">731</span></td>
       <td><span class="missed code">    $this-&gt;databasePrefix = Database::getConnection()-&gt;prefixTables('{simpletest' . mt_rand(1000, 1000000) . '}');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">732</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">733</span></td>
       <td><span class="comment code">    // Create test directory.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">734</span></td>
       <td><span class="missed code">    $public_files_directory = $this-&gt;originalFileDirectory . '/simpletest/' . substr($this-&gt;databasePrefix, 10);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">735</span></td>
       <td><span class="missed code">    file_prepare_directory($public_files_directory, FILE_CREATE_DIRECTORY | FILE_MODIFY_PERMISSIONS);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">736</span></td>
       <td><span class="missed code">    $conf['file_public_path'] = $public_files_directory;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">737</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">738</span></td>
       <td><span class="comment code">    // Clone the current connection and replace the current prefix.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">739</span></td>
       <td><span class="missed code">    $connection_info = Database::getConnectionInfo('default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">740</span></td>
       <td><span class="missed code">    Database::renameConnection('default', 'simpletest_original_default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">741</span></td>
       <td><span class="missed code">    foreach ($connection_info as $target =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">742</span></td>
       <td><span class="missed code">      $connection_info[$target]['prefix'] = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">743</span></td>
       <td><span class="missed code">        'default' =&gt; $value['prefix']['default'] . $this-&gt;databasePrefix,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">744</span></td>
       <td><span class="comment code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">745</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">746</span></td>
       <td><span class="missed code">    Database::addConnectionInfo('default', 'default', $connection_info['default']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">747</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">748</span></td>
       <td><span class="comment code">    // Set user agent to be consistent with web test case.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">749</span></td>
       <td><span class="missed code">    $_SERVER['HTTP_USER_AGENT'] = $this-&gt;databasePrefix;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">750</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">751</span></td>
       <td><span class="comment code">    // If locale is enabled then t() will try to access the database and
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">752</span></td>
       <td><span class="comment code">    // subsequently will fail as the database is not accessible.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">753</span></td>
       <td><span class="missed code">    $module_list = module_list();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">754</span></td>
       <td><span class="missed code">    if (isset($module_list['locale'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">755</span></td>
       <td><span class="comment code">      // Transform the list into the format expected as input to module_list().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">756</span></td>
       <td><span class="missed code">      foreach ($module_list as &amp;$module) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">757</span></td>
       <td><span class="missed code">        $module = array('filename' =&gt; drupal_get_filename('module', $module));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">758</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">759</span></td>
       <td><span class="missed code">      $this-&gt;originalModuleList = $module_list;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">760</span></td>
       <td><span class="missed code">      unset($module_list['locale']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">761</span></td>
       <td><span class="missed code">      module_list(TRUE, FALSE, FALSE, $module_list);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">762</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">763</span></td>
       <td><span class="missed code">    $this-&gt;setup = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">764</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">765</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">766</span></td>
       <td><span class="comment code">  protected function tearDown() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">767</span></td>
       <td><span class="missed code">    global $conf;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">768</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">769</span></td>
       <td><span class="comment code">    // Get back to the original connection.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">770</span></td>
       <td><span class="missed code">    Database::removeConnection('default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">771</span></td>
       <td><span class="missed code">    Database::renameConnection('simpletest_original_default', 'default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">772</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">773</span></td>
       <td><span class="missed code">    $conf['file_public_path'] = $this-&gt;originalFileDirectory;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">774</span></td>
       <td><span class="comment code">    // Restore modules if necessary.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">775</span></td>
       <td><span class="missed code">    if (isset($this-&gt;originalModuleList)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">776</span></td>
       <td><span class="missed code">      module_list(TRUE, FALSE, FALSE, $this-&gt;originalModuleList);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">777</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">778</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">779</span></td>
       <td><span class="comment code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">780</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">781</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">782</span></td>
       <td><span class="comment code"> * Test case for typical Drupal tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">783</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">784</span></td>
       <td><span class="covered code">class DrupalWebTestCase extends DrupalTestCase {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">785</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">786</span></td>
       <td><span class="comment code">   * The profile to install as a basis for testing.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">787</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">788</span></td>
       <td><span class="comment code">   * @var string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">789</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">790</span></td>
       <td><span class="comment code">  protected $profile = 'standard';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">791</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">792</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">793</span></td>
       <td><span class="comment code">   * The URL currently loaded in the internal browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">794</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">795</span></td>
       <td><span class="comment code">   * @var string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">796</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">797</span></td>
       <td><span class="comment code">  protected $url;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">798</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">799</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">800</span></td>
       <td><span class="comment code">   * The handle of the current cURL connection.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">801</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">802</span></td>
       <td><span class="comment code">   * @var resource
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">803</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">804</span></td>
       <td><span class="comment code">  protected $curlHandle;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">805</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">806</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">807</span></td>
       <td><span class="comment code">   * The headers of the page currently loaded in the internal browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">808</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">809</span></td>
       <td><span class="comment code">   * @var Array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">810</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">811</span></td>
       <td><span class="comment code">  protected $headers;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">812</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">813</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">814</span></td>
       <td><span class="comment code">   * The content of the page currently loaded in the internal browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">815</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">816</span></td>
       <td><span class="comment code">   * @var string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">817</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">818</span></td>
       <td><span class="comment code">  protected $content;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">819</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">820</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">821</span></td>
       <td><span class="comment code">   * The content of the page currently loaded in the internal browser (plain text version).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">822</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">823</span></td>
       <td><span class="comment code">   * @var string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">824</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">825</span></td>
       <td><span class="comment code">  protected $plainTextContent;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">826</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">827</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">828</span></td>
       <td><span class="comment code">   * The value of the Drupal.settings JavaScript variable for the page currently loaded in the internal browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">829</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">830</span></td>
       <td><span class="comment code">   * @var Array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">831</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">832</span></td>
       <td><span class="comment code">  protected $drupalSettings;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">833</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">834</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">835</span></td>
       <td><span class="comment code">   * The parsed version of the page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">836</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">837</span></td>
       <td><span class="comment code">   * @var SimpleXMLElement
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">838</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">839</span></td>
       <td><span class="comment code">  protected $elements = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">840</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">841</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">842</span></td>
       <td><span class="comment code">   * The current user logged in using the internal browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">843</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">844</span></td>
       <td><span class="comment code">   * @var bool
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">845</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">846</span></td>
       <td><span class="comment code">  protected $loggedInUser = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">847</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">848</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">849</span></td>
       <td><span class="comment code">   * The current cookie file used by cURL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">850</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">851</span></td>
       <td><span class="comment code">   * We do not reuse the cookies in further runs, so we do not need a file
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">852</span></td>
       <td><span class="comment code">   * but we still need cookie handling, so we set the jar to NULL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">853</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">854</span></td>
       <td><span class="comment code">  protected $cookieFile = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">855</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">856</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">857</span></td>
       <td><span class="comment code">   * Additional cURL options.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">858</span></td>
       <td><span class="covered code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">859</span></td>
       <td><span class="comment code">   * DrupalWebTestCase itself never sets this but always obeys what is set.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">860</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">861</span></td>
       <td><span class="comment code">  protected $additionalCurlOptions = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">862</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">863</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">864</span></td>
       <td><span class="comment code">   * The original user, before it was changed to a clean uid = 1 for testing purposes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">865</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">866</span></td>
       <td><span class="comment code">   * @var object
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">867</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">868</span></td>
       <td><span class="comment code">  protected $originalUser = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">869</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">870</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">871</span></td>
       <td><span class="comment code">   * The original shutdown handlers array, before it was cleaned for testing purposes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">872</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">873</span></td>
       <td><span class="comment code">   * @var array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">874</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">875</span></td>
       <td><span class="comment code">  protected $originalShutdownCallbacks = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">876</span></td>
       <td><span class="covered code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">877</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">878</span></td>
       <td><span class="comment code">   * HTTP authentication method
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">879</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">880</span></td>
       <td><span class="comment code">  protected $httpauth_method = CURLAUTH_BASIC;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">881</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">882</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">883</span></td>
       <td><span class="comment code">   * HTTP authentication credentials (&lt;username&gt;:&lt;password&gt;).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">884</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">885</span></td>
       <td><span class="comment code">  protected $httpauth_credentials = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">886</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">887</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">888</span></td>
       <td><span class="comment code">   * The current session name, if available.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">889</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">890</span></td>
       <td><span class="comment code">  protected $session_name = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">891</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">892</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">893</span></td>
       <td><span class="comment code">   * The current session ID, if available.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">894</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">895</span></td>
       <td><span class="comment code">  protected $session_id = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">896</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">897</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">898</span></td>
       <td><span class="comment code">   * Whether the files were copied to the test files directory.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">899</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">900</span></td>
       <td><span class="comment code">  protected $generatedTestFiles = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">901</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">902</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">903</span></td>
       <td><span class="comment code">   * The number of redirects followed during the handling of a request.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">904</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">905</span></td>
       <td><span class="comment code">  protected $redirect_count;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">906</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">907</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">908</span></td>
       <td><span class="comment code">   * Constructor for DrupalWebTestCase.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">909</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">910</span></td>
       <td><span class="comment code">  function __construct($test_id = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">911</span></td>
       <td><span class="covered code">    parent::__construct($test_id);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">912</span></td>
       <td><span class="covered code">    $this-&gt;skipClasses[__CLASS__] = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">913</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">914</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">915</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">916</span></td>
       <td><span class="comment code">   * Get a node from the database based on its title.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">917</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">918</span></td>
       <td><span class="comment code">   * @param $title
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">919</span></td>
       <td><span class="comment code">   *   A node title, usually generated by $this-&gt;randomName().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">920</span></td>
       <td><span class="comment code">   * @param $reset
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">921</span></td>
       <td><span class="comment code">   *   (optional) Whether to reset the internal node_load() cache.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">922</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">923</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">924</span></td>
       <td><span class="comment code">   *   A node object matching $title.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">925</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">926</span></td>
       <td><span class="comment code">  function drupalGetNodeByTitle($title, $reset = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">927</span></td>
       <td><span class="covered code">    $nodes = node_load_multiple(array(), array('title' =&gt; $title), $reset);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">928</span></td>
       <td><span class="comment code">    // Load the first node returned from the database.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">929</span></td>
       <td><span class="covered code">    $returned_node = reset($nodes);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">930</span></td>
       <td><span class="covered code">    return $returned_node;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">931</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">932</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">933</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">934</span></td>
       <td><span class="comment code">   * Creates a node based on default settings.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">935</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">936</span></td>
       <td><span class="comment code">   * @param $settings
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">937</span></td>
       <td><span class="comment code">   *   An associative array of settings to change from the defaults, keys are
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">938</span></td>
       <td><span class="comment code">   *   node properties, for example 'title' =&gt; 'Hello, world!'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">939</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">940</span></td>
       <td><span class="comment code">   *   Created node object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">941</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">942</span></td>
       <td><span class="comment code">  protected function drupalCreateNode($settings = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">943</span></td>
       <td><span class="comment code">    // Populate defaults array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">944</span></td>
       <td><span class="comment code">    $settings += array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">945</span></td>
       <td><span class="covered code">      'body'      =&gt; array(LANGUAGE_NONE =&gt; array(array())),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">946</span></td>
       <td><span class="covered code">      'title'     =&gt; $this-&gt;randomName(8),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">947</span></td>
       <td><span class="covered code">      'comment'   =&gt; 2,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">948</span></td>
       <td><span class="covered code">      'changed'   =&gt; REQUEST_TIME,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">949</span></td>
       <td><span class="covered code">      'moderate'  =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">950</span></td>
       <td><span class="covered code">      'promote'   =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">951</span></td>
       <td><span class="covered code">      'revision'  =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">952</span></td>
       <td><span class="covered code">      'log'       =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">953</span></td>
       <td><span class="covered code">      'status'    =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">954</span></td>
       <td><span class="covered code">      'sticky'    =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">955</span></td>
       <td><span class="covered code">      'type'      =&gt; 'page',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">956</span></td>
       <td><span class="covered code">      'revisions' =&gt; NULL,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">957</span></td>
       <td><span class="covered code">      'language'  =&gt; LANGUAGE_NONE,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">958</span></td>
       <td><span class="missed code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">959</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">960</span></td>
       <td><span class="comment code">    // Use the original node's created time for existing nodes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">961</span></td>
       <td><span class="covered code">    if (isset($settings['created']) &amp;&amp; !isset($settings['date'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">962</span></td>
       <td><span class="covered code">      $settings['date'] = format_date($settings['created'], 'custom', 'Y-m-d H:i:s O');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">963</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">964</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">965</span></td>
       <td><span class="comment code">    // If the node's user uid is not specified manually, use the currently
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">966</span></td>
       <td><span class="comment code">    // logged in user if available, or else the user running the test.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">967</span></td>
       <td><span class="covered code">    if (!isset($settings['uid'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">968</span></td>
       <td><span class="covered code">      if ($this-&gt;loggedInUser) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">969</span></td>
       <td><span class="covered code">        $settings['uid'] = $this-&gt;loggedInUser-&gt;uid;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">970</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">971</span></td>
       <td><span class="comment code">      else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">972</span></td>
       <td><span class="covered code">        global $user;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">973</span></td>
       <td><span class="covered code">        $settings['uid'] = $user-&gt;uid;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">974</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">975</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">976</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">977</span></td>
       <td><span class="comment code">    // Merge body field value and format separately.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">978</span></td>
       <td><span class="comment code">    $body = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">979</span></td>
       <td><span class="covered code">      'value' =&gt; $this-&gt;randomName(32),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">980</span></td>
       <td><span class="covered code">      'format' =&gt; filter_default_format(),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">981</span></td>
       <td><span class="covered code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">982</span></td>
       <td><span class="covered code">    $settings['body'][$settings['language']][0] += $body;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">983</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">984</span></td>
       <td><span class="covered code">    $node = (object) $settings;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">985</span></td>
       <td><span class="covered code">    node_save($node);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">986</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">987</span></td>
       <td><span class="comment code">    // Small hack to link revisions to our test user.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">988</span></td>
       <td><span class="covered code">    db_update('node_revision')
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">989</span></td>
       <td><span class="covered code">      -&gt;fields(array('uid' =&gt; $node-&gt;uid))
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">990</span></td>
       <td><span class="covered code">      -&gt;condition('vid', $node-&gt;vid)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">991</span></td>
       <td><span class="covered code">      -&gt;execute();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">992</span></td>
       <td><span class="covered code">    return $node;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">993</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">994</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">995</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">996</span></td>
       <td><span class="comment code">   * Creates a custom content type based on default settings.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">997</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">998</span></td>
       <td><span class="comment code">   * @param $settings
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">999</span></td>
       <td><span class="comment code">   *   An array of settings to change from the defaults.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1000</span></td>
       <td><span class="comment code">   *   Example: 'type' =&gt; 'foo'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1001</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1002</span></td>
       <td><span class="comment code">   *   Created content type.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1003</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1004</span></td>
       <td><span class="comment code">  protected function drupalCreateContentType($settings = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1005</span></td>
       <td><span class="comment code">    // Find a non-existent random type name.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1006</span></td>
       <td><span class="comment code">    do {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1007</span></td>
       <td><span class="covered code">      $name = strtolower($this-&gt;randomName(8));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1008</span></td>
       <td><span class="covered code">    } while (node_type_get_type($name));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1009</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1010</span></td>
       <td><span class="comment code">    // Populate defaults array.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1011</span></td>
       <td><span class="comment code">    $defaults = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1012</span></td>
       <td><span class="covered code">      'type' =&gt; $name,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1013</span></td>
       <td><span class="covered code">      'name' =&gt; $name,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1014</span></td>
       <td><span class="covered code">      'base' =&gt; 'node_content',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1015</span></td>
       <td><span class="covered code">      'description' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1016</span></td>
       <td><span class="covered code">      'help' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1017</span></td>
       <td><span class="covered code">      'title_label' =&gt; 'Title',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1018</span></td>
       <td><span class="covered code">      'has_title' =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1019</span></td>
       <td><span class="covered code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1020</span></td>
       <td><span class="comment code">    // Imposed values for a custom type.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1021</span></td>
       <td><span class="comment code">    $forced = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1022</span></td>
       <td><span class="covered code">      'orig_type' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1023</span></td>
       <td><span class="covered code">      'old_type' =&gt; '',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1024</span></td>
       <td><span class="covered code">      'module' =&gt; 'node',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1025</span></td>
       <td><span class="covered code">      'custom' =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1026</span></td>
       <td><span class="covered code">      'modified' =&gt; 1,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1027</span></td>
       <td><span class="covered code">      'locked' =&gt; 0,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1028</span></td>
       <td><span class="covered code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1029</span></td>
       <td><span class="covered code">    $type = $forced + $settings + $defaults;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1030</span></td>
       <td><span class="covered code">    $type = (object) $type;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1031</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1032</span></td>
       <td><span class="covered code">    $saved_type = node_type_save($type);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1033</span></td>
       <td><span class="covered code">    node_types_rebuild();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1034</span></td>
       <td><span class="covered code">    menu_rebuild();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1035</span></td>
       <td><span class="covered code">    node_add_body_field($type);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1036</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1037</span></td>
       <td><span class="covered code">    $this-&gt;assertEqual($saved_type, SAVED_NEW, t('Created content type %type.', array('%type' =&gt; $type-&gt;type)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1038</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1039</span></td>
       <td><span class="comment code">    // Reset permissions so that permissions for this content type are available.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1040</span></td>
       <td><span class="covered code">    $this-&gt;checkPermissions(array(), TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1041</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1042</span></td>
       <td><span class="covered code">    return $type;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1043</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1044</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1045</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1046</span></td>
       <td><span class="comment code">   * Get a list files that can be used in tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1047</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1048</span></td>
       <td><span class="comment code">   * @param $type
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1049</span></td>
       <td><span class="comment code">   *   File type, possible values: 'binary', 'html', 'image', 'javascript', 'php', 'sql', 'text'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1050</span></td>
       <td><span class="comment code">   * @param $size
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1051</span></td>
       <td><span class="comment code">   *   File size in bytes to match. Please check the tests/files folder.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1052</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1053</span></td>
       <td><span class="comment code">   *   List of files that match filter.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1054</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1055</span></td>
       <td><span class="comment code">  protected function drupalGetTestFiles($type, $size = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1056</span></td>
       <td><span class="missed code">    if (empty($this-&gt;generatedTestFiles)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1057</span></td>
       <td><span class="comment code">      // Generate binary test files.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1058</span></td>
       <td><span class="missed code">      $lines = array(64, 1024);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1059</span></td>
       <td><span class="missed code">      $count = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1060</span></td>
       <td><span class="missed code">      foreach ($lines as $line) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1061</span></td>
       <td><span class="missed code">        simpletest_generate_file('binary-' . $count++, 64, $line, 'binary');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1062</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1063</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1064</span></td>
       <td><span class="comment code">      // Generate text test files.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1065</span></td>
       <td><span class="missed code">      $lines = array(16, 256, 1024, 2048, 20480);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1066</span></td>
       <td><span class="missed code">      $count = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1067</span></td>
       <td><span class="missed code">      foreach ($lines as $line) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1068</span></td>
       <td><span class="missed code">        simpletest_generate_file('text-' . $count++, 64, $line, 'text');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1069</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1070</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1071</span></td>
       <td><span class="comment code">      // Copy other test files from simpletest.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1072</span></td>
       <td><span class="missed code">      $original = drupal_get_path('module', 'simpletest') . '/files';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1073</span></td>
       <td><span class="missed code">      $files = file_scan_directory($original, '/(html|image|javascript|php|sql)-.*/');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1074</span></td>
       <td><span class="missed code">      foreach ($files as $file) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1075</span></td>
       <td><span class="missed code">        file_unmanaged_copy($file-&gt;uri, variable_get('file_public_path', conf_path() . '/files'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1076</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1077</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1078</span></td>
       <td><span class="missed code">      $this-&gt;generatedTestFiles = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1079</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1080</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1081</span></td>
       <td><span class="missed code">    $files = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1082</span></td>
       <td><span class="comment code">    // Make sure type is valid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1083</span></td>
       <td><span class="missed code">    if (in_array($type, array('binary', 'html', 'image', 'javascript', 'php', 'sql', 'text'))) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1084</span></td>
       <td><span class="missed code">      $files = file_scan_directory('public://', '/' . $type . '\-.*/');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1085</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1086</span></td>
       <td><span class="comment code">      // If size is set then remove any files that are not of that size.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1087</span></td>
       <td><span class="missed code">      if ($size !== NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1088</span></td>
       <td><span class="missed code">        foreach ($files as $file) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1089</span></td>
       <td><span class="missed code">          $stats = stat($file-&gt;uri);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1090</span></td>
       <td><span class="missed code">          if ($stats['size'] != $size) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1091</span></td>
       <td><span class="missed code">            unset($files[$file-&gt;uri]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1092</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1093</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1094</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1095</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1096</span></td>
       <td><span class="missed code">    usort($files, array($this, 'drupalCompareFiles'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1097</span></td>
       <td><span class="missed code">    return $files;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1098</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1099</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1100</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1101</span></td>
       <td><span class="comment code">   * Compare two files based on size and file name.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1102</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1103</span></td>
       <td><span class="comment code">  protected function drupalCompareFiles($file1, $file2) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1104</span></td>
       <td><span class="missed code">    $compare_size = filesize($file1-&gt;uri) - filesize($file2-&gt;uri);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1105</span></td>
       <td><span class="missed code">    if ($compare_size) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1106</span></td>
       <td><span class="comment code">      // Sort by file size.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1107</span></td>
       <td><span class="missed code">      return $compare_size;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1108</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1109</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1110</span></td>
       <td><span class="comment code">      // The files were the same size, so sort alphabetically.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1111</span></td>
       <td><span class="missed code">      return strnatcmp($file1-&gt;name, $file2-&gt;name);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1112</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1113</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1114</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1115</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1116</span></td>
       <td><span class="comment code">   * Create a user with a given set of permissions.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1117</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1118</span></td>
       <td><span class="comment code">   * @param array $permissions
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1119</span></td>
       <td><span class="comment code">   *   Array of permission names to assign to user. Note that the user always
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1120</span></td>
       <td><span class="comment code">   *   has the default permissions derived from the &quot;authenticated users&quot; role.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1121</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1122</span></td>
       <td><span class="comment code">   * @return object|false
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1123</span></td>
       <td><span class="comment code">   *   A fully loaded user object with pass_raw property, or FALSE if account
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1124</span></td>
       <td><span class="comment code">   *   creation fails.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1125</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1126</span></td>
       <td><span class="comment code">  protected function drupalCreateUser(array $permissions = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1127</span></td>
       <td><span class="comment code">    // Create a role with the given permission set, if any.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1128</span></td>
       <td><span class="covered code">    $rid = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1129</span></td>
       <td><span class="covered code">    if ($permissions) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1130</span></td>
       <td><span class="covered code">      $rid = $this-&gt;drupalCreateRole($permissions);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1131</span></td>
       <td><span class="covered code">      if (!$rid) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1132</span></td>
       <td><span class="missed code">        return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1133</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1134</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1135</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1136</span></td>
       <td><span class="comment code">    // Create a user assigned to that role.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1137</span></td>
       <td><span class="covered code">    $edit = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1138</span></td>
       <td><span class="covered code">    $edit['name']   = $this-&gt;randomName();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1139</span></td>
       <td><span class="covered code">    $edit['mail']   = $edit['name'] . '@example.com';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1140</span></td>
       <td><span class="covered code">    $edit['pass']   = user_password();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1141</span></td>
       <td><span class="covered code">    $edit['status'] = 1;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1142</span></td>
       <td><span class="covered code">    if ($rid) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1143</span></td>
       <td><span class="covered code">      $edit['roles'] = array($rid =&gt; $rid);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1144</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1145</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1146</span></td>
       <td><span class="covered code">    $account = user_save(drupal_anonymous_user(), $edit);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1147</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1148</span></td>
       <td><span class="covered code">    $this-&gt;assertTrue(!empty($account-&gt;uid), t('User created with name %name and pass %pass', array('%name' =&gt; $edit['name'], '%pass' =&gt; $edit['pass'])), t('User login'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1149</span></td>
       <td><span class="covered code">    if (empty($account-&gt;uid)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1150</span></td>
       <td><span class="missed code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1151</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1152</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1153</span></td>
       <td><span class="comment code">    // Add the raw password so that we can log in as this user.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1154</span></td>
       <td><span class="covered code">    $account-&gt;pass_raw = $edit['pass'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1155</span></td>
       <td><span class="covered code">    return $account;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1156</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1157</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1158</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1159</span></td>
       <td><span class="comment code">   * Creates a role with specified permissions.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1160</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1161</span></td>
       <td><span class="comment code">   * @param $permissions
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1162</span></td>
       <td><span class="comment code">   *   Array of permission names to assign to role.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1163</span></td>
       <td><span class="comment code">   * @param $name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1164</span></td>
       <td><span class="comment code">   *   (optional) String for the name of the role.  Defaults to a random string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1165</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1166</span></td>
       <td><span class="comment code">   *   Role ID of newly created role, or FALSE if role creation failed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1167</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1168</span></td>
       <td><span class="comment code">  protected function drupalCreateRole(array $permissions, $name = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1169</span></td>
       <td><span class="comment code">    // Generate random name if it was not passed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1170</span></td>
       <td><span class="covered code">    if (!$name) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1171</span></td>
       <td><span class="covered code">      $name = $this-&gt;randomName();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1172</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1173</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1174</span></td>
       <td><span class="comment code">    // Check the all the permissions strings are valid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1175</span></td>
       <td><span class="covered code">    if (!$this-&gt;checkPermissions($permissions)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1176</span></td>
       <td><span class="missed code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1177</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1178</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1179</span></td>
       <td><span class="comment code">    // Create new role.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1180</span></td>
       <td><span class="covered code">    $role = new stdClass();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1181</span></td>
       <td><span class="covered code">    $role-&gt;name = $name;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1182</span></td>
       <td><span class="covered code">    user_role_save($role);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1183</span></td>
       <td><span class="covered code">    user_role_grant_permissions($role-&gt;rid, $permissions);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1184</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1185</span></td>
       <td><span class="covered code">    $this-&gt;assertTrue(isset($role-&gt;rid), t('Created role of name: @name, id: @rid', array('@name' =&gt; $name, '@rid' =&gt; (isset($role-&gt;rid) ? $role-&gt;rid : t('-n/a-')))), t('Role'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1186</span></td>
       <td><span class="covered code">    if ($role &amp;&amp; !empty($role-&gt;rid)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1187</span></td>
       <td><span class="covered code">      $count = db_query('SELECT COUNT(*) FROM {role_permission} WHERE rid = :rid', array(':rid' =&gt; $role-&gt;rid))-&gt;fetchField();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1188</span></td>
       <td><span class="covered code">      $this-&gt;assertTrue($count == count($permissions), t('Created permissions: @perms', array('@perms' =&gt; implode(', ', $permissions))), t('Role'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1189</span></td>
       <td><span class="covered code">      return $role-&gt;rid;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1190</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1191</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1192</span></td>
       <td><span class="missed code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1193</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1194</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1195</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1196</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1197</span></td>
       <td><span class="comment code">   * Check to make sure that the array of permissions are valid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1198</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1199</span></td>
       <td><span class="comment code">   * @param $permissions
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1200</span></td>
       <td><span class="comment code">   *   Permissions to check.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1201</span></td>
       <td><span class="comment code">   * @param $reset
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1202</span></td>
       <td><span class="comment code">   *   Reset cached available permissions.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1203</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1204</span></td>
       <td><span class="comment code">   *   TRUE or FALSE depending on whether the permissions are valid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1205</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1206</span></td>
       <td><span class="comment code">  protected function checkPermissions(array $permissions, $reset = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1207</span></td>
       <td><span class="covered code">    $available = &amp;drupal_static(__FUNCTION__);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1208</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1209</span></td>
       <td><span class="covered code">    if (!isset($available) || $reset) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1210</span></td>
       <td><span class="covered code">      $available = array_keys(module_invoke_all('permission'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1211</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1212</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1213</span></td>
       <td><span class="covered code">    $valid = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1214</span></td>
       <td><span class="covered code">    foreach ($permissions as $permission) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1215</span></td>
       <td><span class="covered code">      if (!in_array($permission, $available)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1216</span></td>
       <td><span class="missed code">        $this-&gt;fail(t('Invalid permission %permission.', array('%permission' =&gt; $permission)), t('Role'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1217</span></td>
       <td><span class="missed code">        $valid = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1218</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1219</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1220</span></td>
       <td><span class="covered code">    return $valid;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1221</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1222</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1223</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1224</span></td>
       <td><span class="comment code">   * Log in a user with the internal browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1225</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1226</span></td>
       <td><span class="comment code">   * If a user is already logged in, then the current user is logged out before
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1227</span></td>
       <td><span class="comment code">   * logging in the specified user.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1228</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1229</span></td>
       <td><span class="comment code">   * Please note that neither the global $user nor the passed-in user object is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1230</span></td>
       <td><span class="comment code">   * populated with data of the logged in user. If you need full access to the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1231</span></td>
       <td><span class="comment code">   * user object after logging in, it must be updated manually. If you also need
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1232</span></td>
       <td><span class="comment code">   * access to the plain-text password of the user (set by drupalCreateUser()),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1233</span></td>
       <td><span class="comment code">   * e.g. to log in the same user again, then it must be re-assigned manually.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1234</span></td>
       <td><span class="comment code">   * For example:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1235</span></td>
       <td><span class="comment code">   * @code
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1236</span></td>
       <td><span class="comment code">   *   // Create a user.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1237</span></td>
       <td><span class="comment code">   *   $account = $this-&gt;drupalCreateUser(array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1238</span></td>
       <td><span class="comment code">   *   $this-&gt;drupalLogin($account);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1239</span></td>
       <td><span class="comment code">   *   // Load real user object.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1240</span></td>
       <td><span class="comment code">   *   $pass_raw = $account-&gt;pass_raw;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1241</span></td>
       <td><span class="comment code">   *   $account = user_load($account-&gt;uid);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1242</span></td>
       <td><span class="comment code">   *   $account-&gt;pass_raw = $pass_raw;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1243</span></td>
       <td><span class="comment code">   * @endcode
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1244</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1245</span></td>
       <td><span class="comment code">   * @param $account
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1246</span></td>
       <td><span class="comment code">   *   User object representing the user to log in.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1247</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1248</span></td>
       <td><span class="comment code">   * @see drupalCreateUser()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1249</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1250</span></td>
       <td><span class="comment code">  protected function drupalLogin(stdClass $account) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1251</span></td>
       <td><span class="covered code">    if ($this-&gt;loggedInUser) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1252</span></td>
       <td><span class="missed code">      $this-&gt;drupalLogout();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1253</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1254</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1255</span></td>
       <td><span class="comment code">    $edit = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1256</span></td>
       <td><span class="covered code">      'name' =&gt; $account-&gt;name,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1257</span></td>
       <td><span class="covered code">      'pass' =&gt; $account-&gt;pass_raw
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1258</span></td>
       <td><span class="covered code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1259</span></td>
       <td><span class="covered code">    $this-&gt;drupalPost('user', $edit, t('Log in'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1260</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1261</span></td>
       <td><span class="comment code">    // If a &quot;log out&quot; link appears on the page, it is almost certainly because
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1262</span></td>
       <td><span class="comment code">    // the login was successful.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1263</span></td>
       <td><span class="covered code">    $pass = $this-&gt;assertLink(t('Log out'), 0, t('User %name successfully logged in.', array('%name' =&gt; $account-&gt;name)), t('User login'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1264</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1265</span></td>
       <td><span class="covered code">    if ($pass) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1266</span></td>
       <td><span class="covered code">      $this-&gt;loggedInUser = $account;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1267</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1268</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1269</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1270</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1271</span></td>
       <td><span class="comment code">   * Generate a token for the currently logged in user.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1272</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1273</span></td>
       <td><span class="comment code">  protected function drupalGetToken($value = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1274</span></td>
       <td><span class="missed code">    $private_key = drupal_get_private_key();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1275</span></td>
       <td><span class="missed code">    return drupal_hmac_base64($value, $this-&gt;session_id . $private_key);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1276</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1277</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1278</span></td>
       <td><span class="comment code">  /*
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1279</span></td>
       <td><span class="comment code">   * Logs a user out of the internal browser, then check the login page to confirm logout.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1280</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1281</span></td>
       <td><span class="comment code">  protected function drupalLogout() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1282</span></td>
       <td><span class="comment code">    // Make a request to the logout page, and redirect to the user page, the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1283</span></td>
       <td><span class="comment code">    // idea being if you were properly logged out you should be seeing a login
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1284</span></td>
       <td><span class="comment code">    // screen.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1285</span></td>
       <td><span class="covered code">    $this-&gt;drupalGet('user/logout');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1286</span></td>
       <td><span class="covered code">    $this-&gt;drupalGet('user');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1287</span></td>
       <td><span class="covered code">    $pass = $this-&gt;assertField('name', t('Username field found.'), t('Logout'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1288</span></td>
       <td><span class="covered code">    $pass = $pass &amp;&amp; $this-&gt;assertField('pass', t('Password field found.'), t('Logout'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1289</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1290</span></td>
       <td><span class="covered code">    if ($pass) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1291</span></td>
       <td><span class="covered code">      $this-&gt;loggedInUser = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1292</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1293</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1294</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1295</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1296</span></td>
       <td><span class="comment code">   * Generates a database prefix for running tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1297</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1298</span></td>
       <td><span class="comment code">   * The generated database table prefix is used for the Drupal installation
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1299</span></td>
       <td><span class="comment code">   * being performed for the test. It is also used as user agent HTTP header
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1300</span></td>
       <td><span class="comment code">   * value by the cURL-based browser of DrupalWebTestCase, which is sent
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1301</span></td>
       <td><span class="comment code">   * to the Drupal installation of the test. During early Drupal bootstrap, the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1302</span></td>
       <td><span class="comment code">   * user agent HTTP header is parsed, and if it matches, all database queries
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1303</span></td>
       <td><span class="comment code">   * use the database table prefix that has been generated here.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1304</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1305</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::curlInitialize()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1306</span></td>
       <td><span class="comment code">   * @see drupal_valid_test_ua()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1307</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::setUp()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1308</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1309</span></td>
       <td><span class="comment code">  protected function prepareDatabasePrefix() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1310</span></td>
       <td><span class="covered code">    $this-&gt;databasePrefix = 'simpletest' . mt_rand(1000, 1000000);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1311</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1312</span></td>
       <td><span class="comment code">    // As soon as the database prefix is set, the test might start to execute.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1313</span></td>
       <td><span class="comment code">    // All assertions as well as the SimpleTest batch operations are associated
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1314</span></td>
       <td><span class="comment code">    // with the testId, so the database prefix has to be associated with it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1315</span></td>
       <td><span class="covered code">    db_update('simpletest_test_id')
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1316</span></td>
       <td><span class="covered code">      -&gt;fields(array('last_prefix' =&gt; $this-&gt;databasePrefix))
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1317</span></td>
       <td><span class="covered code">      -&gt;condition('test_id', $this-&gt;testId)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1318</span></td>
       <td><span class="covered code">      -&gt;execute();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1319</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1320</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1321</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1322</span></td>
       <td><span class="comment code">   * Changes the database connection to the prefixed one.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1323</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1324</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::setUp()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1325</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1326</span></td>
       <td><span class="comment code">  protected function changeDatabasePrefix() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1327</span></td>
       <td><span class="covered code">    if (empty($this-&gt;databasePrefix)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1328</span></td>
       <td><span class="missed code">      $this-&gt;prepareDatabasePrefix();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1329</span></td>
       <td><span class="comment code">      // If $this-&gt;prepareDatabasePrefix() failed to work, return without
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1330</span></td>
       <td><span class="comment code">      // setting $this-&gt;setupDatabasePrefix to TRUE, so setUp() methods will
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1331</span></td>
       <td><span class="comment code">      // know to bail out.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1332</span></td>
       <td><span class="missed code">      if (empty($this-&gt;databasePrefix)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1333</span></td>
       <td><span class="missed code">        return;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1334</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1335</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1336</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1337</span></td>
       <td><span class="comment code">    // Clone the current connection and replace the current prefix.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1338</span></td>
       <td><span class="covered code">    $connection_info = Database::getConnectionInfo('default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1339</span></td>
       <td><span class="covered code">    Database::renameConnection('default', 'simpletest_original_default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1340</span></td>
       <td><span class="covered code">    foreach ($connection_info as $target =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1341</span></td>
       <td><span class="covered code">      $connection_info[$target]['prefix'] = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1342</span></td>
       <td><span class="covered code">        'default' =&gt; $value['prefix']['default'] . $this-&gt;databasePrefix,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1343</span></td>
       <td><span class="comment code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1344</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1345</span></td>
       <td><span class="covered code">    Database::addConnectionInfo('default', 'default', $connection_info['default']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1346</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1347</span></td>
       <td><span class="comment code">    // Indicate the database prefix was set up correctly.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1348</span></td>
       <td><span class="covered code">    $this-&gt;setupDatabasePrefix = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1349</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1350</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1351</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1352</span></td>
       <td><span class="comment code">   * Prepares the current environment for running the test.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1353</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1354</span></td>
       <td><span class="comment code">   * Backups various current environment variables and resets them, so they do
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1355</span></td>
       <td><span class="comment code">   * not interfere with the Drupal site installation in which tests are executed
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1356</span></td>
       <td><span class="comment code">   * and can be restored in tearDown().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1357</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1358</span></td>
       <td><span class="comment code">   * Also sets up new resources for the testing environment, such as the public
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1359</span></td>
       <td><span class="comment code">   * filesystem and configuration directories.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1360</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1361</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::setUp()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1362</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::tearDown()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1363</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1364</span></td>
       <td><span class="comment code">  protected function prepareEnvironment() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1365</span></td>
       <td><span class="covered code">    global $user, $language, $conf;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1366</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1367</span></td>
       <td><span class="comment code">    // Store necessary current values before switching to prefixed database.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1368</span></td>
       <td><span class="covered code">    $this-&gt;originalLanguage = $language;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1369</span></td>
       <td><span class="covered code">    $this-&gt;originalLanguageDefault = variable_get('language_default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1370</span></td>
       <td><span class="covered code">    $this-&gt;originalFileDirectory = variable_get('file_public_path', conf_path() . '/files');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1371</span></td>
       <td><span class="covered code">    $this-&gt;originalProfile = drupal_get_profile();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1372</span></td>
       <td><span class="covered code">    $this-&gt;originalCleanUrl = variable_get('clean_url', 0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1373</span></td>
       <td><span class="covered code">    $this-&gt;originalUser = $user;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1374</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1375</span></td>
       <td><span class="comment code">    // Set to English to prevent exceptions from utf8_truncate() from t()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1376</span></td>
       <td><span class="comment code">    // during install if the current language is not 'en'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1377</span></td>
       <td><span class="comment code">    // The following array/object conversion is copied from language_default().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1378</span></td>
       <td><span class="covered code">    $language = (object) array('language' =&gt; 'en', 'name' =&gt; 'English', 'native' =&gt; 'English', 'direction' =&gt; 0, 'enabled' =&gt; 1, 'plurals' =&gt; 0, 'formula' =&gt; '', 'domain' =&gt; '', 'prefix' =&gt; '', 'weight' =&gt; 0, 'javascript' =&gt; '');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1379</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1380</span></td>
       <td><span class="comment code">    // Save and clean the shutdown callbacks array because it is static cached
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1381</span></td>
       <td><span class="comment code">    // and will be changed by the test run. Otherwise it will contain callbacks
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1382</span></td>
       <td><span class="comment code">    // from both environments and the testing environment will try to call the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1383</span></td>
       <td><span class="comment code">    // handlers defined by the original one.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1384</span></td>
       <td><span class="covered code">    $callbacks = &amp;drupal_register_shutdown_function();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1385</span></td>
       <td><span class="covered code">    $this-&gt;originalShutdownCallbacks = $callbacks;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1386</span></td>
       <td><span class="covered code">    $callbacks = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1387</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1388</span></td>
       <td><span class="comment code">    // Create test directory ahead of installation so fatal errors and debug
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1389</span></td>
       <td><span class="comment code">    // information can be logged during installation process.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1390</span></td>
       <td><span class="comment code">    // Use temporary files directory with the same prefix as the database.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1391</span></td>
       <td><span class="covered code">    $this-&gt;public_files_directory = $this-&gt;originalFileDirectory . '/simpletest/' . substr($this-&gt;databasePrefix, 10);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1392</span></td>
       <td><span class="covered code">    $this-&gt;private_files_directory = $this-&gt;public_files_directory . '/private';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1393</span></td>
       <td><span class="covered code">    $this-&gt;temp_files_directory = $this-&gt;private_files_directory . '/temp';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1394</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1395</span></td>
       <td><span class="comment code">    // Create the directories
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1396</span></td>
       <td><span class="covered code">    file_prepare_directory($this-&gt;public_files_directory, FILE_CREATE_DIRECTORY | FILE_MODIFY_PERMISSIONS);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1397</span></td>
       <td><span class="covered code">    file_prepare_directory($this-&gt;private_files_directory, FILE_CREATE_DIRECTORY);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1398</span></td>
       <td><span class="covered code">    file_prepare_directory($this-&gt;temp_files_directory, FILE_CREATE_DIRECTORY);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1399</span></td>
       <td><span class="covered code">    $this-&gt;generatedTestFiles = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1400</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1401</span></td>
       <td><span class="comment code">    // Log fatal errors.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1402</span></td>
       <td><span class="covered code">    ini_set('log_errors', 1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1403</span></td>
       <td><span class="covered code">    ini_set('error_log', $this-&gt;public_files_directory . '/error.log');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1404</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1405</span></td>
       <td><span class="comment code">    // Set the test information for use in other parts of Drupal.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1406</span></td>
       <td><span class="covered code">    $test_info = &amp;$GLOBALS['drupal_test_info'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1407</span></td>
       <td><span class="covered code">    $test_info['test_run_id'] = $this-&gt;databasePrefix;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1408</span></td>
       <td><span class="covered code">    $test_info['in_child_site'] = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1409</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1410</span></td>
       <td><span class="comment code">    // Indicate the environment was set up correctly.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1411</span></td>
       <td><span class="covered code">    $this-&gt;setupEnvironment = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1412</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1413</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1414</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1415</span></td>
       <td><span class="comment code">   * Sets up a Drupal site for running functional and integration tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1416</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1417</span></td>
       <td><span class="comment code">   * Generates a random database prefix and installs Drupal with the specified
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1418</span></td>
       <td><span class="comment code">   * installation profile in DrupalWebTestCase::$profile into the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1419</span></td>
       <td><span class="comment code">   * prefixed database. Afterwards, installs any additional modules specified by
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1420</span></td>
       <td><span class="comment code">   * the test.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1421</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1422</span></td>
       <td><span class="comment code">   * After installation all caches are flushed and several configuration values
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1423</span></td>
       <td><span class="comment code">   * are reset to the values of the parent site executing the test, since the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1424</span></td>
       <td><span class="comment code">   * default values may be incompatible with the environment in which tests are
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1425</span></td>
       <td><span class="comment code">   * being executed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1426</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1427</span></td>
       <td><span class="comment code">   * @param ...
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1428</span></td>
       <td><span class="comment code">   *   List of modules to enable for the duration of the test. This can be
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1429</span></td>
       <td><span class="comment code">   *   either a single array or a variable number of string arguments.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1430</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1431</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::prepareDatabasePrefix()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1432</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::changeDatabasePrefix()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1433</span></td>
       <td><span class="comment code">   * @see DrupalWebTestCase::prepareEnvironment()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1434</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1435</span></td>
       <td><span class="comment code">  protected function setUp() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1436</span></td>
       <td><span class="covered code">    global $user, $language, $conf;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1437</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1438</span></td>
       <td><span class="comment code">    // Create the database prefix for this test.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1439</span></td>
       <td><span class="covered code">    $this-&gt;prepareDatabasePrefix();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1440</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1441</span></td>
       <td><span class="comment code">    // Prepare the environment for running tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1442</span></td>
       <td><span class="covered code">    $this-&gt;prepareEnvironment();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1443</span></td>
       <td><span class="covered code">    if (!$this-&gt;setupEnvironment) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1444</span></td>
       <td><span class="missed code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1445</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1446</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1447</span></td>
       <td><span class="comment code">    // Reset all statics and variables to perform tests in a clean environment.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1448</span></td>
       <td><span class="covered code">    $conf = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1449</span></td>
       <td><span class="covered code">    drupal_static_reset();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1450</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1451</span></td>
       <td><span class="comment code">    // Change the database prefix.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1452</span></td>
       <td><span class="comment code">    // All static variables need to be reset before the database prefix is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1453</span></td>
       <td><span class="comment code">    // changed, since DrupalCacheArray implementations attempt to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1454</span></td>
       <td><span class="comment code">    // write back to persistent caches when they are destructed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1455</span></td>
       <td><span class="covered code">    $this-&gt;changeDatabasePrefix();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1456</span></td>
       <td><span class="covered code">    if (!$this-&gt;setupDatabasePrefix) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1457</span></td>
       <td><span class="missed code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1458</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1459</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1460</span></td>
       <td><span class="comment code">    // Preset the 'install_profile' system variable, so the first call into
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1461</span></td>
       <td><span class="comment code">    // system_rebuild_module_data() (in drupal_install_system()) will register
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1462</span></td>
       <td><span class="comment code">    // the test's profile as a module. Without this, the installation profile of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1463</span></td>
       <td><span class="comment code">    // the parent site (executing the test) is registered, and the test
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1464</span></td>
       <td><span class="comment code">    // profile's hook_install() and other hook implementations are never invoked.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1465</span></td>
       <td><span class="covered code">    $conf['install_profile'] = $this-&gt;profile;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1466</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1467</span></td>
       <td><span class="comment code">    // Perform the actual Drupal installation.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1468</span></td>
       <td><span class="covered code">    include_once DRUPAL_ROOT . '/includes/install.inc';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1469</span></td>
       <td><span class="covered code">    drupal_install_system();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1470</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1471</span></td>
       <td><span class="covered code">    $this-&gt;preloadRegistry();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1472</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1473</span></td>
       <td><span class="comment code">    // Set path variables.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1474</span></td>
       <td><span class="covered code">    variable_set('file_public_path', $this-&gt;public_files_directory);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1475</span></td>
       <td><span class="covered code">    variable_set('file_private_path', $this-&gt;private_files_directory);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1476</span></td>
       <td><span class="covered code">    variable_set('file_temporary_path', $this-&gt;temp_files_directory);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1477</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1478</span></td>
       <td><span class="comment code">    // Set the 'simpletest_parent_profile' variable to add the parent profile's
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1479</span></td>
       <td><span class="comment code">    // search path to the child site's search paths.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1480</span></td>
       <td><span class="comment code">    // @see drupal_system_listing()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1481</span></td>
       <td><span class="comment code">    // @todo This may need to be primed like 'install_profile' above.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1482</span></td>
       <td><span class="covered code">    variable_set('simpletest_parent_profile', $this-&gt;originalProfile);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1483</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1484</span></td>
       <td><span class="comment code">    // Include the testing profile.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1485</span></td>
       <td><span class="covered code">    variable_set('install_profile', $this-&gt;profile);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1486</span></td>
       <td><span class="covered code">    $profile_details = install_profile_info($this-&gt;profile, 'en');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1487</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1488</span></td>
       <td><span class="comment code">    // Install the modules specified by the testing profile.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1489</span></td>
       <td><span class="covered code">    module_enable($profile_details['dependencies'], FALSE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1490</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1491</span></td>
       <td><span class="comment code">    // Install modules needed for this test. This could have been passed in as
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1492</span></td>
       <td><span class="comment code">    // either a single array argument or a variable number of string arguments.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1493</span></td>
       <td><span class="comment code">    // @todo Remove this compatibility layer in Drupal 8, and only accept
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1494</span></td>
       <td><span class="comment code">    // $modules as a single array argument.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1495</span></td>
       <td><span class="covered code">    $modules = func_get_args();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1496</span></td>
       <td><span class="covered code">    if (isset($modules[0]) &amp;&amp; is_array($modules[0])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1497</span></td>
       <td><span class="missed code">      $modules = $modules[0];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1498</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1499</span></td>
       <td><span class="covered code">    if ($modules) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1500</span></td>
       <td><span class="covered code">      $success = module_enable($modules, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1501</span></td>
       <td><span class="covered code">      $this-&gt;assertTrue($success, t('Enabled modules: %modules', array('%modules' =&gt; implode(', ', $modules))));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1502</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1503</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1504</span></td>
       <td><span class="comment code">    // Run the profile tasks.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1505</span></td>
       <td><span class="covered code">    $install_profile_module_exists = db_query(&quot;SELECT 1 FROM {system} WHERE type = 'module' AND name = :name&quot;, array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1506</span></td>
       <td><span class="covered code">      ':name' =&gt; $this-&gt;profile,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1507</span></td>
       <td><span class="covered code">    ))-&gt;fetchField();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1508</span></td>
       <td><span class="covered code">    if ($install_profile_module_exists) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1509</span></td>
       <td><span class="covered code">      module_enable(array($this-&gt;profile), FALSE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1510</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1511</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1512</span></td>
       <td><span class="comment code">    // Reset/rebuild all data structures after enabling the modules.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1513</span></td>
       <td><span class="covered code">    $this-&gt;resetAll();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1514</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1515</span></td>
       <td><span class="comment code">    // Run cron once in that environment, as install.php does at the end of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1516</span></td>
       <td><span class="comment code">    // the installation process.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1517</span></td>
       <td><span class="covered code">    drupal_cron_run();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1518</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1519</span></td>
       <td><span class="comment code">    // Ensure that the session is not written to the new environment and replace
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1520</span></td>
       <td><span class="comment code">    // the global $user session with uid 1 from the new test site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1521</span></td>
       <td><span class="covered code">    drupal_save_session(FALSE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1522</span></td>
       <td><span class="comment code">    // Login as uid 1.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1523</span></td>
       <td><span class="covered code">    $user = user_load(1);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1524</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1525</span></td>
       <td><span class="comment code">    // Restore necessary variables.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1526</span></td>
       <td><span class="covered code">    variable_set('install_task', 'done');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1527</span></td>
       <td><span class="covered code">    variable_set('clean_url', $this-&gt;originalCleanUrl);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1528</span></td>
       <td><span class="covered code">    variable_set('site_mail', 'simpletest@example.com');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1529</span></td>
       <td><span class="covered code">    variable_set('date_default_timezone', date_default_timezone_get());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1530</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1531</span></td>
       <td><span class="comment code">    // Set up English language.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1532</span></td>
       <td><span class="covered code">    unset($conf['language_default']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1533</span></td>
       <td><span class="covered code">    $language = language_default();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1534</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1535</span></td>
       <td><span class="comment code">    // Use the test mail class instead of the default mail handler class.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1536</span></td>
       <td><span class="covered code">    variable_set('mail_system', array('default-system' =&gt; 'TestingMailSystem'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1537</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1538</span></td>
       <td><span class="covered code">    drupal_set_time_limit($this-&gt;timeLimit);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1539</span></td>
       <td><span class="covered code">    $this-&gt;setup = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1540</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1541</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1542</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1543</span></td>
       <td><span class="comment code">   * Preload the registry from the testing site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1544</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1545</span></td>
       <td><span class="comment code">   * This method is called by DrupalWebTestCase::setUp(), and preloads the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1546</span></td>
       <td><span class="comment code">   * registry from the testing site to cut down on the time it takes to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1547</span></td>
       <td><span class="comment code">   * set up a clean environment for the current test run.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1548</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1549</span></td>
       <td><span class="comment code">  protected function preloadRegistry() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1550</span></td>
       <td><span class="comment code">    // Use two separate queries, each with their own connections: copy the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1551</span></td>
       <td><span class="comment code">    // {registry} and {registry_file} tables over from the parent installation
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1552</span></td>
       <td><span class="comment code">    // to the child installation.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1553</span></td>
       <td><span class="covered code">    $original_connection = Database::getConnection('default', 'simpletest_original_default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1554</span></td>
       <td><span class="covered code">    $test_connection = Database::getConnection();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1555</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1556</span></td>
       <td><span class="covered code">    foreach (array('registry', 'registry_file') as $table) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1557</span></td>
       <td><span class="comment code">      // Find the records from the parent database.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1558</span></td>
       <td><span class="comment code">      $source_query = $original_connection
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1559</span></td>
       <td><span class="covered code">        -&gt;select($table, array(), array('fetch' =&gt; PDO::FETCH_ASSOC))
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1560</span></td>
       <td><span class="covered code">        -&gt;fields($table);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1561</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1562</span></td>
       <td><span class="covered code">      $dest_query = $test_connection-&gt;insert($table);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1563</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1564</span></td>
       <td><span class="covered code">      $first = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1565</span></td>
       <td><span class="covered code">      foreach ($source_query-&gt;execute() as $row) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1566</span></td>
       <td><span class="covered code">        if ($first) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1567</span></td>
       <td><span class="covered code">          $dest_query-&gt;fields(array_keys($row));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1568</span></td>
       <td><span class="covered code">          $first = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1569</span></td>
       <td><span class="covered code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1570</span></td>
       <td><span class="comment code">        // Insert the records into the child database.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1571</span></td>
       <td><span class="covered code">        $dest_query-&gt;values($row);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1572</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1573</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1574</span></td>
       <td><span class="covered code">      $dest_query-&gt;execute();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1575</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1576</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1577</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1578</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1579</span></td>
       <td><span class="comment code">   * Reset all data structures after having enabled new modules.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1580</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1581</span></td>
       <td><span class="comment code">   * This method is called by DrupalWebTestCase::setUp() after enabling
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1582</span></td>
       <td><span class="comment code">   * the requested modules. It must be called again when additional modules
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1583</span></td>
       <td><span class="comment code">   * are enabled later.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1584</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1585</span></td>
       <td><span class="comment code">  protected function resetAll() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1586</span></td>
       <td><span class="comment code">    // Reset all static variables.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1587</span></td>
       <td><span class="covered code">    drupal_static_reset();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1588</span></td>
       <td><span class="comment code">    // Reset the list of enabled modules.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1589</span></td>
       <td><span class="covered code">    module_list(TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1590</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1591</span></td>
       <td><span class="comment code">    // Reset cached schema for new database prefix. This must be done before
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1592</span></td>
       <td><span class="comment code">    // drupal_flush_all_caches() so rebuilds can make use of the schema of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1593</span></td>
       <td><span class="comment code">    // modules enabled on the cURL side.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1594</span></td>
       <td><span class="covered code">    drupal_get_schema(NULL, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1595</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1596</span></td>
       <td><span class="comment code">    // Perform rebuilds and flush remaining caches.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1597</span></td>
       <td><span class="covered code">    drupal_flush_all_caches();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1598</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1599</span></td>
       <td><span class="comment code">    // Reload global $conf array and permissions.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1600</span></td>
       <td><span class="covered code">    $this-&gt;refreshVariables();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1601</span></td>
       <td><span class="covered code">    $this-&gt;checkPermissions(array(), TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1602</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1603</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1604</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1605</span></td>
       <td><span class="comment code">   * Refresh the in-memory set of variables. Useful after a page request is made
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1606</span></td>
       <td><span class="comment code">   * that changes a variable in a different thread.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1607</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1608</span></td>
       <td><span class="comment code">   * In other words calling a settings page with $this-&gt;drupalPost() with a changed
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1609</span></td>
       <td><span class="comment code">   * value would update a variable to reflect that change, but in the thread that
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1610</span></td>
       <td><span class="comment code">   * made the call (thread running the test) the changed variable would not be
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1611</span></td>
       <td><span class="comment code">   * picked up.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1612</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1613</span></td>
       <td><span class="comment code">   * This method clears the variables cache and loads a fresh copy from the database
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1614</span></td>
       <td><span class="comment code">   * to ensure that the most up-to-date set of variables is loaded.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1615</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1616</span></td>
       <td><span class="comment code">  protected function refreshVariables() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1617</span></td>
       <td><span class="covered code">    global $conf;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1618</span></td>
       <td><span class="covered code">    cache_clear_all('variables', 'cache_bootstrap');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1619</span></td>
       <td><span class="covered code">    $conf = variable_initialize();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1620</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1621</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1622</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1623</span></td>
       <td><span class="comment code">   * Delete created files and temporary files directory, delete the tables created by setUp(),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1624</span></td>
       <td><span class="comment code">   * and reset the database prefix.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1625</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1626</span></td>
       <td><span class="comment code">  protected function tearDown() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1627</span></td>
       <td><span class="covered code">    global $user, $language;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1628</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1629</span></td>
       <td><span class="comment code">    // In case a fatal error occurred that was not in the test process read the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1630</span></td>
       <td><span class="comment code">    // log to pick up any fatal errors.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1631</span></td>
       <td><span class="covered code">    simpletest_log_read($this-&gt;testId, $this-&gt;databasePrefix, get_class($this), TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1632</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1633</span></td>
       <td><span class="covered code">    $emailCount = count(variable_get('drupal_test_email_collector', array()));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1634</span></td>
       <td><span class="covered code">    if ($emailCount) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1635</span></td>
       <td><span class="missed code">      $message = format_plural($emailCount, '1 e-mail was sent during this test.', '@count e-mails were sent during this test.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1636</span></td>
       <td><span class="missed code">      $this-&gt;pass($message, t('E-mail'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1637</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1638</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1639</span></td>
       <td><span class="comment code">    // Delete temporary files directory.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1640</span></td>
       <td><span class="covered code">    file_unmanaged_delete_recursive($this-&gt;originalFileDirectory . '/simpletest/' . substr($this-&gt;databasePrefix, 10));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1641</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1642</span></td>
       <td><span class="comment code">    // Remove all prefixed tables.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1643</span></td>
       <td><span class="covered code">    $tables = db_find_tables($this-&gt;databasePrefix . '%');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1644</span></td>
       <td><span class="covered code">    $connection_info = Database::getConnectionInfo('default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1645</span></td>
       <td><span class="covered code">    $tables = db_find_tables($connection_info['default']['prefix']['default'] . '%');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1646</span></td>
       <td><span class="covered code">    if (empty($tables)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1647</span></td>
       <td><span class="missed code">      $this-&gt;fail('Failed to find test tables to drop.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1648</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1649</span></td>
       <td><span class="covered code">    $prefix_length = strlen($connection_info['default']['prefix']['default']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1650</span></td>
       <td><span class="covered code">    foreach ($tables as $table) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1651</span></td>
       <td><span class="covered code">      if (db_drop_table(substr($table, $prefix_length))) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1652</span></td>
       <td><span class="covered code">        unset($tables[$table]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1653</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1654</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1655</span></td>
       <td><span class="covered code">    if (!empty($tables)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1656</span></td>
       <td><span class="missed code">      $this-&gt;fail('Failed to drop all prefixed tables.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1657</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1658</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1659</span></td>
       <td><span class="comment code">    // Get back to the original connection.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1660</span></td>
       <td><span class="covered code">    Database::removeConnection('default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1661</span></td>
       <td><span class="covered code">    Database::renameConnection('simpletest_original_default', 'default');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1662</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1663</span></td>
       <td><span class="comment code">    // Restore original shutdown callbacks array to prevent original
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1664</span></td>
       <td><span class="comment code">    // environment of calling handlers from test run.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1665</span></td>
       <td><span class="covered code">    $callbacks = &amp;drupal_register_shutdown_function();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1666</span></td>
       <td><span class="covered code">    $callbacks = $this-&gt;originalShutdownCallbacks;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1667</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1668</span></td>
       <td><span class="comment code">    // Return the user to the original one.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1669</span></td>
       <td><span class="covered code">    $user = $this-&gt;originalUser;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1670</span></td>
       <td><span class="covered code">    drupal_save_session(TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1671</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1672</span></td>
       <td><span class="comment code">    // Ensure that internal logged in variable and cURL options are reset.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1673</span></td>
       <td><span class="covered code">    $this-&gt;loggedInUser = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1674</span></td>
       <td><span class="covered code">    $this-&gt;additionalCurlOptions = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1675</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1676</span></td>
       <td><span class="comment code">    // Reload module list and implementations to ensure that test module hooks
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1677</span></td>
       <td><span class="comment code">    // aren't called after tests.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1678</span></td>
       <td><span class="covered code">    module_list(TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1679</span></td>
       <td><span class="covered code">    module_implements('', FALSE, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1680</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1681</span></td>
       <td><span class="comment code">    // Reset the Field API.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1682</span></td>
       <td><span class="covered code">    field_cache_clear();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1683</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1684</span></td>
       <td><span class="comment code">    // Rebuild caches.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1685</span></td>
       <td><span class="covered code">    $this-&gt;refreshVariables();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1686</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1687</span></td>
       <td><span class="comment code">    // Reset public files directory.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1688</span></td>
       <td><span class="covered code">    $GLOBALS['conf']['file_public_path'] = $this-&gt;originalFileDirectory;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1689</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1690</span></td>
       <td><span class="comment code">    // Reset language.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1691</span></td>
       <td><span class="covered code">    $language = $this-&gt;originalLanguage;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1692</span></td>
       <td><span class="covered code">    if ($this-&gt;originalLanguageDefault) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1693</span></td>
       <td><span class="missed code">      $GLOBALS['conf']['language_default'] = $this-&gt;originalLanguageDefault;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1694</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1695</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1696</span></td>
       <td><span class="comment code">    // Close the CURL handler.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1697</span></td>
       <td><span class="covered code">    $this-&gt;curlClose();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1698</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1699</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1700</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1701</span></td>
       <td><span class="comment code">   * Initializes the cURL connection.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1702</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1703</span></td>
       <td><span class="comment code">   * If the simpletest_httpauth_credentials variable is set, this function will
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1704</span></td>
       <td><span class="comment code">   * add HTTP authentication headers. This is necessary for testing sites that
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1705</span></td>
       <td><span class="comment code">   * are protected by login credentials from public access.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1706</span></td>
       <td><span class="comment code">   * See the description of $curl_options for other options.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1707</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1708</span></td>
       <td><span class="comment code">  protected function curlInitialize() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1709</span></td>
       <td><span class="covered code">    global $base_url;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1710</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1711</span></td>
       <td><span class="covered code">    if (!isset($this-&gt;curlHandle)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1712</span></td>
       <td><span class="covered code">      $this-&gt;curlHandle = curl_init();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1713</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1714</span></td>
       <td><span class="comment code">      // Some versions/configurations of cURL break on a NULL cookie jar, so
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1715</span></td>
       <td><span class="comment code">      // supply a real file.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1716</span></td>
       <td><span class="covered code">      if (empty($this-&gt;cookieFile)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1717</span></td>
       <td><span class="covered code">        $this-&gt;cookieFile = $this-&gt;public_files_directory . '/cookie.jar';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1718</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1719</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1720</span></td>
       <td><span class="comment code">      $curl_options = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1721</span></td>
       <td><span class="covered code">        CURLOPT_COOKIEJAR =&gt; $this-&gt;cookieFile,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1722</span></td>
       <td><span class="covered code">        CURLOPT_URL =&gt; $base_url,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1723</span></td>
       <td><span class="covered code">        CURLOPT_FOLLOWLOCATION =&gt; FALSE,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1724</span></td>
       <td><span class="covered code">        CURLOPT_RETURNTRANSFER =&gt; TRUE,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1725</span></td>
       <td><span class="covered code">        CURLOPT_SSL_VERIFYPEER =&gt; FALSE, // Required to make the tests run on HTTPS.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1726</span></td>
       <td><span class="covered code">        CURLOPT_SSL_VERIFYHOST =&gt; FALSE, // Required to make the tests run on HTTPS.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1727</span></td>
       <td><span class="covered code">        CURLOPT_HEADERFUNCTION =&gt; array(&amp;$this, 'curlHeaderCallback'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1728</span></td>
       <td><span class="covered code">        CURLOPT_USERAGENT =&gt; $this-&gt;databasePrefix,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1729</span></td>
       <td><span class="covered code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1730</span></td>
       <td><span class="covered code">      if (isset($this-&gt;httpauth_credentials)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1731</span></td>
       <td><span class="missed code">        $curl_options[CURLOPT_HTTPAUTH] = $this-&gt;httpauth_method;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1732</span></td>
       <td><span class="missed code">        $curl_options[CURLOPT_USERPWD] = $this-&gt;httpauth_credentials;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1733</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1734</span></td>
       <td><span class="comment code">      // curl_setopt_array() returns FALSE if any of the specified options
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1735</span></td>
       <td><span class="comment code">      // cannot be set, and stops processing any further options.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1736</span></td>
       <td><span class="covered code">      $result = curl_setopt_array($this-&gt;curlHandle, $this-&gt;additionalCurlOptions + $curl_options);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1737</span></td>
       <td><span class="covered code">      if (!$result) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1738</span></td>
       <td><span class="missed code">        throw new Exception('One or more cURL options could not be set.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1739</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1740</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1741</span></td>
       <td><span class="comment code">      // By default, the child session name should be the same as the parent.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1742</span></td>
       <td><span class="covered code">      $this-&gt;session_name = session_name();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1743</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1744</span></td>
       <td><span class="comment code">    // We set the user agent header on each request so as to use the current
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1745</span></td>
       <td><span class="comment code">    // time and a new uniqid.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1746</span></td>
       <td><span class="covered code">    if (preg_match('/simpletest\d+/', $this-&gt;databasePrefix, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1747</span></td>
       <td><span class="covered code">      curl_setopt($this-&gt;curlHandle, CURLOPT_USERAGENT, drupal_generate_test_ua($matches[0]));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1748</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1749</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1750</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1751</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1752</span></td>
       <td><span class="comment code">   * Initializes and executes a cURL request.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1753</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1754</span></td>
       <td><span class="comment code">   * @param $curl_options
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1755</span></td>
       <td><span class="comment code">   *   An associative array of cURL options to set, where the keys are constants
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1756</span></td>
       <td><span class="comment code">   *   defined by the cURL library. For a list of valid options, see
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1757</span></td>
       <td><span class="comment code">   *   http://www.php.net/manual/function.curl-setopt.php
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1758</span></td>
       <td><span class="comment code">   * @param $redirect
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1759</span></td>
       <td><span class="comment code">   *   FALSE if this is an initial request, TRUE if this request is the result
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1760</span></td>
       <td><span class="comment code">   *   of a redirect.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1761</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1762</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1763</span></td>
       <td><span class="comment code">   *   The content returned from the call to curl_exec().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1764</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1765</span></td>
       <td><span class="comment code">   * @see curlInitialize()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1766</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1767</span></td>
       <td><span class="comment code">  protected function curlExec($curl_options, $redirect = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1768</span></td>
       <td><span class="covered code">    $this-&gt;curlInitialize();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1769</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1770</span></td>
       <td><span class="covered code">    if (!empty($curl_options[CURLOPT_URL])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1771</span></td>
       <td><span class="comment code">      // Forward XDebug activation if present.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1772</span></td>
       <td><span class="covered code">      if (isset($_COOKIE['XDEBUG_SESSION'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1773</span></td>
       <td><span class="missed code">        $options = drupal_parse_url($curl_options[CURLOPT_URL]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1774</span></td>
       <td><span class="missed code">        $options += array('query' =&gt; array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1775</span></td>
       <td><span class="missed code">        $options['query'] += array('XDEBUG_SESSION_START' =&gt; $_COOKIE['XDEBUG_SESSION']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1776</span></td>
       <td><span class="missed code">        $curl_options[CURLOPT_URL] = url($options['path'], $options);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1777</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1778</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1779</span></td>
       <td><span class="comment code">      // cURL incorrectly handles URLs with a fragment by including the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1780</span></td>
       <td><span class="comment code">      // fragment in the request to the server, causing some web servers
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1781</span></td>
       <td><span class="comment code">      // to reject the request citing &quot;400 - Bad Request&quot;. To prevent
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1782</span></td>
       <td><span class="comment code">      // this, we strip the fragment from the request.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1783</span></td>
       <td><span class="comment code">      // TODO: Remove this for Drupal 8, since fixed in curl 7.20.0.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1784</span></td>
       <td><span class="covered code">      if (strpos($curl_options[CURLOPT_URL], '#')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1785</span></td>
       <td><span class="missed code">        $original_url = $curl_options[CURLOPT_URL];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1786</span></td>
       <td><span class="missed code">        $curl_options[CURLOPT_URL] = strtok($curl_options[CURLOPT_URL], '#');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1787</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1788</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1789</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1790</span></td>
       <td><span class="covered code">    $url = empty($curl_options[CURLOPT_URL]) ? curl_getinfo($this-&gt;curlHandle, CURLINFO_EFFECTIVE_URL) : $curl_options[CURLOPT_URL];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1791</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1792</span></td>
       <td><span class="covered code">    if (!empty($curl_options[CURLOPT_POST])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1793</span></td>
       <td><span class="comment code">      // This is a fix for the Curl library to prevent Expect: 100-continue
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1794</span></td>
       <td><span class="comment code">      // headers in POST requests, that may cause unexpected HTTP response
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1795</span></td>
       <td><span class="comment code">      // codes from some webservers (like lighttpd that returns a 417 error
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1796</span></td>
       <td><span class="comment code">      // code). It is done by setting an empty &quot;Expect&quot; header field that is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1797</span></td>
       <td><span class="comment code">      // not overwritten by Curl.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1798</span></td>
       <td><span class="covered code">      $curl_options[CURLOPT_HTTPHEADER][] = 'Expect:';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1799</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1800</span></td>
       <td><span class="covered code">    curl_setopt_array($this-&gt;curlHandle, $this-&gt;additionalCurlOptions + $curl_options);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1801</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1802</span></td>
       <td><span class="covered code">    if (!$redirect) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1803</span></td>
       <td><span class="comment code">      // Reset headers, the session ID and the redirect counter.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1804</span></td>
       <td><span class="covered code">      $this-&gt;session_id = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1805</span></td>
       <td><span class="covered code">      $this-&gt;headers = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1806</span></td>
       <td><span class="covered code">      $this-&gt;redirect_count = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1807</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1808</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1809</span></td>
       <td><span class="covered code">    $content = curl_exec($this-&gt;curlHandle);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1810</span></td>
       <td><span class="covered code">    $status = curl_getinfo($this-&gt;curlHandle, CURLINFO_HTTP_CODE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1811</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1812</span></td>
       <td><span class="comment code">    // cURL incorrectly handles URLs with fragments, so instead of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1813</span></td>
       <td><span class="comment code">    // letting cURL handle redirects we take of them ourselves to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1814</span></td>
       <td><span class="comment code">    // to prevent fragments being sent to the web server as part
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1815</span></td>
       <td><span class="comment code">    // of the request.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1816</span></td>
       <td><span class="comment code">    // TODO: Remove this for Drupal 8, since fixed in curl 7.20.0.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1817</span></td>
       <td><span class="covered code">    if (in_array($status, array(300, 301, 302, 303, 305, 307)) &amp;&amp; $this-&gt;redirect_count &lt; variable_get('simpletest_maximum_redirects', 5)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1818</span></td>
       <td><span class="covered code">      if ($this-&gt;drupalGetHeader('location')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1819</span></td>
       <td><span class="covered code">        $this-&gt;redirect_count++;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1820</span></td>
       <td><span class="covered code">        $curl_options = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1821</span></td>
       <td><span class="covered code">        $curl_options[CURLOPT_URL] = $this-&gt;drupalGetHeader('location');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1822</span></td>
       <td><span class="covered code">        $curl_options[CURLOPT_HTTPGET] = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1823</span></td>
       <td><span class="covered code">        return $this-&gt;curlExec($curl_options, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1824</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1825</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1826</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1827</span></td>
       <td><span class="covered code">    $this-&gt;drupalSetContent($content, isset($original_url) ? $original_url : curl_getinfo($this-&gt;curlHandle, CURLINFO_EFFECTIVE_URL));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1828</span></td>
       <td><span class="comment code">    $message_vars = array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1829</span></td>
       <td><span class="covered code">      '!method' =&gt; !empty($curl_options[CURLOPT_NOBODY]) ? 'HEAD' : (empty($curl_options[CURLOPT_POSTFIELDS]) ? 'GET' : 'POST'),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1830</span></td>
       <td><span class="covered code">      '@url' =&gt; isset($original_url) ? $original_url : $url,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1831</span></td>
       <td><span class="covered code">      '@status' =&gt; $status,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1832</span></td>
       <td><span class="covered code">      '!length' =&gt; format_size(strlen($this-&gt;drupalGetContent()))
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1833</span></td>
       <td><span class="covered code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1834</span></td>
       <td><span class="covered code">    $message = t('!method @url returned @status (!length).', $message_vars);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1835</span></td>
       <td><span class="covered code">    $this-&gt;assertTrue($this-&gt;drupalGetContent() !== FALSE, $message, t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1836</span></td>
       <td><span class="covered code">    return $this-&gt;drupalGetContent();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1837</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1838</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1839</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1840</span></td>
       <td><span class="comment code">   * Reads headers and registers errors received from the tested site.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1841</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1842</span></td>
       <td><span class="comment code">   * @see _drupal_log_error().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1843</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1844</span></td>
       <td><span class="comment code">   * @param $curlHandler
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1845</span></td>
       <td><span class="comment code">   *   The cURL handler.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1846</span></td>
       <td><span class="comment code">   * @param $header
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1847</span></td>
       <td><span class="comment code">   *   An header.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1848</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1849</span></td>
       <td><span class="comment code">  protected function curlHeaderCallback($curlHandler, $header) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1850</span></td>
       <td><span class="comment code">    // Header fields can be extended over multiple lines by preceding each
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1851</span></td>
       <td><span class="comment code">    // extra line with at least one SP or HT. They should be joined on receive.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1852</span></td>
       <td><span class="comment code">    // Details are in RFC2616 section 4.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1853</span></td>
       <td><span class="covered code">    if ($header[0] == ' ' || $header[0] == &quot;\t&quot;) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1854</span></td>
       <td><span class="comment code">      // Normalize whitespace between chucks.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1855</span></td>
       <td><span class="missed code">      $this-&gt;headers[] = array_pop($this-&gt;headers) . ' ' . trim($header);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1856</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1857</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1858</span></td>
       <td><span class="covered code">      $this-&gt;headers[] = $header;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1859</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1860</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1861</span></td>
       <td><span class="comment code">    // Errors are being sent via X-Drupal-Assertion-* headers,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1862</span></td>
       <td><span class="comment code">    // generated by _drupal_log_error() in the exact form required
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1863</span></td>
       <td><span class="comment code">    // by DrupalWebTestCase::error().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1864</span></td>
       <td><span class="covered code">    if (preg_match('/^X-Drupal-Assertion-[0-9]+: (.*)$/', $header, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1865</span></td>
       <td><span class="comment code">      // Call DrupalWebTestCase::error() with the parameters from the header.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1866</span></td>
       <td><span class="missed code">      call_user_func_array(array(&amp;$this, 'error'), unserialize(urldecode($matches[1])));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1867</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1868</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1869</span></td>
       <td><span class="comment code">    // Save cookies.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1870</span></td>
       <td><span class="covered code">    if (preg_match('/^Set-Cookie: ([^=]+)=(.+)/', $header, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1871</span></td>
       <td><span class="covered code">      $name = $matches[1];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1872</span></td>
       <td><span class="covered code">      $parts = array_map('trim', explode(';', $matches[2]));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1873</span></td>
       <td><span class="covered code">      $value = array_shift($parts);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1874</span></td>
       <td><span class="covered code">      $this-&gt;cookies[$name] = array('value' =&gt; $value, 'secure' =&gt; in_array('secure', $parts));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1875</span></td>
       <td><span class="covered code">      if ($name == $this-&gt;session_name) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1876</span></td>
       <td><span class="covered code">        if ($value != 'deleted') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1877</span></td>
       <td><span class="covered code">          $this-&gt;session_id = $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1878</span></td>
       <td><span class="covered code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1879</span></td>
       <td><span class="comment code">        else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1880</span></td>
       <td><span class="covered code">          $this-&gt;session_id = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1881</span></td>
       <td><span class="comment code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1882</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1883</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1884</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1885</span></td>
       <td><span class="comment code">    // This is required by cURL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1886</span></td>
       <td><span class="covered code">    return strlen($header);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1887</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1888</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1889</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1890</span></td>
       <td><span class="comment code">   * Close the cURL handler and unset the handler.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1891</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1892</span></td>
       <td><span class="comment code">  protected function curlClose() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1893</span></td>
       <td><span class="covered code">    if (isset($this-&gt;curlHandle)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1894</span></td>
       <td><span class="covered code">      curl_close($this-&gt;curlHandle);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1895</span></td>
       <td><span class="covered code">      unset($this-&gt;curlHandle);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1896</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1897</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1898</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1899</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1900</span></td>
       <td><span class="comment code">   * Parse content returned from curlExec using DOM and SimpleXML.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1901</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1902</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1903</span></td>
       <td><span class="comment code">   *   A SimpleXMLElement or FALSE on failure.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1904</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1905</span></td>
       <td><span class="comment code">  protected function parse() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1906</span></td>
       <td><span class="covered code">    if (!$this-&gt;elements) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1907</span></td>
       <td><span class="comment code">      // DOM can load HTML soup. But, HTML soup can throw warnings, suppress
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1908</span></td>
       <td><span class="comment code">      // them.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1909</span></td>
       <td><span class="covered code">      $htmlDom = new DOMDocument();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1910</span></td>
       <td><span class="covered code">      @$htmlDom-&gt;loadHTML($this-&gt;drupalGetContent());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1911</span></td>
       <td><span class="covered code">      if ($htmlDom) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1912</span></td>
       <td><span class="covered code">        $this-&gt;pass(t('Valid HTML found on &quot;@path&quot;', array('@path' =&gt; $this-&gt;getUrl())), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1913</span></td>
       <td><span class="comment code">        // It's much easier to work with simplexml than DOM, luckily enough
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1914</span></td>
       <td><span class="comment code">        // we can just simply import our DOM tree.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1915</span></td>
       <td><span class="covered code">        $this-&gt;elements = simplexml_import_dom($htmlDom);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1916</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1917</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1918</span></td>
       <td><span class="covered code">    if (!$this-&gt;elements) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1919</span></td>
       <td><span class="missed code">      $this-&gt;fail(t('Parsed page successfully.'), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1920</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1921</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1922</span></td>
       <td><span class="covered code">    return $this-&gt;elements;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1923</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1924</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1925</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1926</span></td>
       <td><span class="comment code">   * Retrieves a Drupal path or an absolute path.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1927</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1928</span></td>
       <td><span class="comment code">   * @param $path
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1929</span></td>
       <td><span class="comment code">   *   Drupal path or URL to load into internal browser
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1930</span></td>
       <td><span class="comment code">   * @param $options
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1931</span></td>
       <td><span class="comment code">   *   Options to be forwarded to url().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1932</span></td>
       <td><span class="comment code">   * @param $headers
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1933</span></td>
       <td><span class="comment code">   *   An array containing additional HTTP request headers, each formatted as
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1934</span></td>
       <td><span class="comment code">   *   &quot;name: value&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1935</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1936</span></td>
       <td><span class="comment code">   *   The retrieved HTML string, also available as $this-&gt;drupalGetContent()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1937</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1938</span></td>
       <td><span class="comment code">  protected function drupalGet($path, array $options = array(), array $headers = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1939</span></td>
       <td><span class="covered code">    $options['absolute'] = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1940</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1941</span></td>
       <td><span class="comment code">    // We re-using a CURL connection here. If that connection still has certain
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1942</span></td>
       <td><span class="comment code">    // options set, it might change the GET into a POST. Make sure we clear out
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1943</span></td>
       <td><span class="comment code">    // previous options.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1944</span></td>
       <td><span class="covered code">    $out = $this-&gt;curlExec(array(CURLOPT_HTTPGET =&gt; TRUE, CURLOPT_URL =&gt; url($path, $options), CURLOPT_NOBODY =&gt; FALSE, CURLOPT_HTTPHEADER =&gt; $headers));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1945</span></td>
       <td><span class="covered code">    $this-&gt;refreshVariables(); // Ensure that any changes to variables in the other thread are picked up.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1946</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1947</span></td>
       <td><span class="comment code">    // Replace original page output with new output from redirected page(s).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1948</span></td>
       <td><span class="covered code">    if ($new = $this-&gt;checkForMetaRefresh()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1949</span></td>
       <td><span class="missed code">      $out = $new;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1950</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1951</span></td>
       <td><span class="covered code">    $this-&gt;verbose('GET request to: ' . $path .
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1952</span></td>
       <td><span class="covered code">                   '&lt;hr /&gt;Ending URL: ' . $this-&gt;getUrl() .
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1953</span></td>
       <td><span class="covered code">                   '&lt;hr /&gt;' . $out);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1954</span></td>
       <td><span class="covered code">    return $out;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1955</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1956</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1957</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1958</span></td>
       <td><span class="comment code">   * Retrieve a Drupal path or an absolute path and JSON decode the result.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1959</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1960</span></td>
       <td><span class="comment code">  protected function drupalGetAJAX($path, array $options = array(), array $headers = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1961</span></td>
       <td><span class="missed code">    return drupal_json_decode($this-&gt;drupalGet($path, $options, $headers));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1962</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1963</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1964</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1965</span></td>
       <td><span class="comment code">   * Execute a POST request on a Drupal page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1966</span></td>
       <td><span class="comment code">   * It will be done as usual POST request with SimpleBrowser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1967</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1968</span></td>
       <td><span class="comment code">   * @param $path
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1969</span></td>
       <td><span class="comment code">   *   Location of the post form. Either a Drupal path or an absolute path or
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1970</span></td>
       <td><span class="comment code">   *   NULL to post to the current page. For multi-stage forms you can set the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1971</span></td>
       <td><span class="comment code">   *   path to NULL and have it post to the last received page. Example:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1972</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1973</span></td>
       <td><span class="comment code">   *   @code
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1974</span></td>
       <td><span class="comment code">   *   // First step in form.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1975</span></td>
       <td><span class="comment code">   *   $edit = array(...);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1976</span></td>
       <td><span class="comment code">   *   $this-&gt;drupalPost('some_url', $edit, t('Save'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1977</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1978</span></td>
       <td><span class="comment code">   *   // Second step in form.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1979</span></td>
       <td><span class="comment code">   *   $edit = array(...);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1980</span></td>
       <td><span class="comment code">   *   $this-&gt;drupalPost(NULL, $edit, t('Save'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1981</span></td>
       <td><span class="comment code">   *   @endcode
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1982</span></td>
       <td><span class="comment code">   * @param  $edit
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1983</span></td>
       <td><span class="comment code">   *   Field data in an associative array. Changes the current input fields
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1984</span></td>
       <td><span class="comment code">   *   (where possible) to the values indicated. A checkbox can be set to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1985</span></td>
       <td><span class="comment code">   *   TRUE to be checked and FALSE to be unchecked. Note that when a form
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1986</span></td>
       <td><span class="comment code">   *   contains file upload fields, other fields cannot start with the '@'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1987</span></td>
       <td><span class="comment code">   *   character.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1988</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1989</span></td>
       <td><span class="comment code">   *   Multiple select fields can be set using name[] and setting each of the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1990</span></td>
       <td><span class="comment code">   *   possible values. Example:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1991</span></td>
       <td><span class="comment code">   *   @code
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1992</span></td>
       <td><span class="comment code">   *   $edit = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1993</span></td>
       <td><span class="comment code">   *   $edit['name[]'] = array('value1', 'value2');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1994</span></td>
       <td><span class="comment code">   *   @endcode
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1995</span></td>
       <td><span class="comment code">   * @param $submit
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1996</span></td>
       <td><span class="comment code">   *   Value of the submit button whose click is to be emulated. For example,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1997</span></td>
       <td><span class="comment code">   *   t('Save'). The processing of the request depends on this value. For
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1998</span></td>
       <td><span class="comment code">   *   example, a form may have one button with the value t('Save') and another
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">1999</span></td>
       <td><span class="comment code">   *   button with the value t('Delete'), and execute different code depending
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2000</span></td>
       <td><span class="comment code">   *   on which one is clicked.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2001</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2002</span></td>
       <td><span class="comment code">   *   This function can also be called to emulate an Ajax submission. In this
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2003</span></td>
       <td><span class="comment code">   *   case, this value needs to be an array with the following keys:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2004</span></td>
       <td><span class="comment code">   *   - path: A path to submit the form values to for Ajax-specific processing,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2005</span></td>
       <td><span class="comment code">   *     which is likely different than the $path parameter used for retrieving
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2006</span></td>
       <td><span class="comment code">   *     the initial form. Defaults to 'system/ajax'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2007</span></td>
       <td><span class="comment code">   *   - triggering_element: If the value for the 'path' key is 'system/ajax' or
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2008</span></td>
       <td><span class="comment code">   *     another generic Ajax processing path, this needs to be set to the name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2009</span></td>
       <td><span class="comment code">   *     of the element. If the name doesn't identify the element uniquely, then
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2010</span></td>
       <td><span class="comment code">   *     this should instead be an array with a single key/value pair,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2011</span></td>
       <td><span class="comment code">   *     corresponding to the element name and value. The callback for the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2012</span></td>
       <td><span class="comment code">   *     generic Ajax processing path uses this to find the #ajax information
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2013</span></td>
       <td><span class="comment code">   *     for the element, including which specific callback to use for
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2014</span></td>
       <td><span class="comment code">   *     processing the request.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2015</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2016</span></td>
       <td><span class="comment code">   *   This can also be set to NULL in order to emulate an Internet Explorer
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2017</span></td>
       <td><span class="comment code">   *   submission of a form with a single text field, and pressing ENTER in that
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2018</span></td>
       <td><span class="comment code">   *   textfield: under these conditions, no button information is added to the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2019</span></td>
       <td><span class="comment code">   *   POST data.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2020</span></td>
       <td><span class="comment code">   * @param $options
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2021</span></td>
       <td><span class="comment code">   *   Options to be forwarded to url().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2022</span></td>
       <td><span class="comment code">   * @param $headers
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2023</span></td>
       <td><span class="comment code">   *   An array containing additional HTTP request headers, each formatted as
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2024</span></td>
       <td><span class="comment code">   *   &quot;name: value&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2025</span></td>
       <td><span class="comment code">   * @param $form_html_id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2026</span></td>
       <td><span class="comment code">   *   (optional) HTML ID of the form to be submitted. On some pages
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2027</span></td>
       <td><span class="comment code">   *   there are many identical forms, so just using the value of the submit
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2028</span></td>
       <td><span class="comment code">   *   button is not enough. For example: 'trigger-node-presave-assign-form'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2029</span></td>
       <td><span class="comment code">   *   Note that this is not the Drupal $form_id, but rather the HTML ID of the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2030</span></td>
       <td><span class="comment code">   *   form, which is typically the same thing but with hyphens replacing the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2031</span></td>
       <td><span class="comment code">   *   underscores.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2032</span></td>
       <td><span class="comment code">   * @param $extra_post
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2033</span></td>
       <td><span class="comment code">   *   (optional) A string of additional data to append to the POST submission.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2034</span></td>
       <td><span class="comment code">   *   This can be used to add POST data for which there are no HTML fields, as
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2035</span></td>
       <td><span class="comment code">   *   is done by drupalPostAJAX(). This string is literally appended to the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2036</span></td>
       <td><span class="comment code">   *   POST data, so it must already be urlencoded and contain a leading &quot;&amp;&quot;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2037</span></td>
       <td><span class="comment code">   *   (e.g., &quot;&amp;extra_var1=hello+world&amp;extra_var2=you%26me&quot;).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2038</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2039</span></td>
       <td><span class="comment code">  protected function drupalPost($path, $edit, $submit, array $options = array(), array $headers = array(), $form_html_id = NULL, $extra_post = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2040</span></td>
       <td><span class="covered code">    $submit_matches = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2041</span></td>
       <td><span class="covered code">    $ajax = is_array($submit);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2042</span></td>
       <td><span class="covered code">    if (isset($path)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2043</span></td>
       <td><span class="covered code">      $this-&gt;drupalGet($path, $options);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2044</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2045</span></td>
       <td><span class="covered code">    if ($this-&gt;parse()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2046</span></td>
       <td><span class="covered code">      $edit_save = $edit;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2047</span></td>
       <td><span class="comment code">      // Let's iterate over all the forms.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2048</span></td>
       <td><span class="covered code">      $xpath = &quot;//form&quot;;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2049</span></td>
       <td><span class="covered code">      if (!empty($form_html_id)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2050</span></td>
       <td><span class="missed code">        $xpath .= &quot;[@id='&quot; . $form_html_id . &quot;']&quot;;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2051</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2052</span></td>
       <td><span class="covered code">      $forms = $this-&gt;xpath($xpath);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2053</span></td>
       <td><span class="covered code">      foreach ($forms as $form) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2054</span></td>
       <td><span class="comment code">        // We try to set the fields of this form as specified in $edit.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2055</span></td>
       <td><span class="covered code">        $edit = $edit_save;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2056</span></td>
       <td><span class="covered code">        $post = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2057</span></td>
       <td><span class="covered code">        $upload = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2058</span></td>
       <td><span class="covered code">        $submit_matches = $this-&gt;handleForm($post, $edit, $upload, $ajax ? NULL : $submit, $form);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2059</span></td>
       <td><span class="covered code">        $action = isset($form['action']) ? $this-&gt;getAbsoluteUrl((string) $form['action']) : $this-&gt;getUrl();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2060</span></td>
       <td><span class="covered code">        if ($ajax) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2061</span></td>
       <td><span class="missed code">          $action = $this-&gt;getAbsoluteUrl(!empty($submit['path']) ? $submit['path'] : 'system/ajax');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2062</span></td>
       <td><span class="comment code">          // Ajax callbacks verify the triggering element if necessary, so while
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2063</span></td>
       <td><span class="comment code">          // we may eventually want extra code that verifies it in the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2064</span></td>
       <td><span class="comment code">          // handleForm() function, it's not currently a requirement.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2065</span></td>
       <td><span class="missed code">          $submit_matches = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2066</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2067</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2068</span></td>
       <td><span class="comment code">        // We post only if we managed to handle every field in edit and the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2069</span></td>
       <td><span class="comment code">        // submit button matches.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2070</span></td>
       <td><span class="covered code">        if (!$edit &amp;&amp; ($submit_matches || !isset($submit))) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2071</span></td>
       <td><span class="covered code">          $post_array = $post;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2072</span></td>
       <td><span class="covered code">          if ($upload) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2073</span></td>
       <td><span class="comment code">            // TODO: cURL handles file uploads for us, but the implementation
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2074</span></td>
       <td><span class="comment code">            // is broken. This is a less than elegant workaround. Alternatives
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2075</span></td>
       <td><span class="comment code">            // are being explored at #253506.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2076</span></td>
       <td><span class="missed code">            foreach ($upload as $key =&gt; $file) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2077</span></td>
       <td><span class="missed code">              $file = drupal_realpath($file);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2078</span></td>
       <td><span class="missed code">              if ($file &amp;&amp; is_file($file)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2079</span></td>
       <td><span class="comment code">                // Use the new CurlFile class for file uploads when using PHP
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2080</span></td>
       <td><span class="comment code">                // 5.5 or higher.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2081</span></td>
       <td><span class="missed code">                if (class_exists('CurlFile')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2082</span></td>
       <td><span class="missed code">                  $post[$key] = curl_file_create($file);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2083</span></td>
       <td><span class="missed code">                }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2084</span></td>
       <td><span class="comment code">                else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2085</span></td>
       <td><span class="missed code">                  $post[$key] = '@' . $file;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2086</span></td>
       <td><span class="comment code">                }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2087</span></td>
       <td><span class="missed code">              }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2088</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2089</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2090</span></td>
       <td><span class="comment code">          else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2091</span></td>
       <td><span class="covered code">            foreach ($post as $key =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2092</span></td>
       <td><span class="comment code">              // Encode according to application/x-www-form-urlencoded
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2093</span></td>
       <td><span class="comment code">              // Both names and values needs to be urlencoded, according to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2094</span></td>
       <td><span class="comment code">              // http://www.w3.org/TR/html4/interact/forms.html#h-17.13.4.1
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2095</span></td>
       <td><span class="covered code">              $post[$key] = urlencode($key) . '=' . urlencode($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2096</span></td>
       <td><span class="covered code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2097</span></td>
       <td><span class="covered code">            $post = implode('&amp;', $post) . $extra_post;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2098</span></td>
       <td><span class="comment code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2099</span></td>
       <td><span class="covered code">          $out = $this-&gt;curlExec(array(CURLOPT_URL =&gt; $action, CURLOPT_POST =&gt; TRUE, CURLOPT_POSTFIELDS =&gt; $post, CURLOPT_HTTPHEADER =&gt; $headers));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2100</span></td>
       <td><span class="comment code">          // Ensure that any changes to variables in the other thread are picked up.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2101</span></td>
       <td><span class="covered code">          $this-&gt;refreshVariables();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2102</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2103</span></td>
       <td><span class="comment code">          // Replace original page output with new output from redirected page(s).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2104</span></td>
       <td><span class="covered code">          if ($new = $this-&gt;checkForMetaRefresh()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2105</span></td>
       <td><span class="missed code">            $out = $new;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2106</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2107</span></td>
       <td><span class="covered code">          $this-&gt;verbose('POST request to: ' . $path .
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2108</span></td>
       <td><span class="covered code">                         '&lt;hr /&gt;Ending URL: ' . $this-&gt;getUrl() .
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2109</span></td>
       <td><span class="covered code">                         '&lt;hr /&gt;Fields: ' . highlight_string('&lt;?php ' . var_export($post_array, TRUE), TRUE) .
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2110</span></td>
       <td><span class="covered code">                         '&lt;hr /&gt;' . $out);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2111</span></td>
       <td><span class="covered code">          return $out;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2112</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2113</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2114</span></td>
       <td><span class="comment code">      // We have not found a form which contained all fields of $edit.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2115</span></td>
       <td><span class="missed code">      foreach ($edit as $name =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2116</span></td>
       <td><span class="missed code">        $this-&gt;fail(t('Failed to set field @name to @value', array('@name' =&gt; $name, '@value' =&gt; $value)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2117</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2118</span></td>
       <td><span class="missed code">      if (!$ajax &amp;&amp; isset($submit)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2119</span></td>
       <td><span class="missed code">        $this-&gt;assertTrue($submit_matches, t('Found the @submit button', array('@submit' =&gt; $submit)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2120</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2121</span></td>
       <td><span class="missed code">      $this-&gt;fail(t('Found the requested form fields at @path', array('@path' =&gt; $path)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2122</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2123</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2124</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2125</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2126</span></td>
       <td><span class="comment code">   * Execute an Ajax submission.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2127</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2128</span></td>
       <td><span class="comment code">   * This executes a POST as ajax.js does. It uses the returned JSON data, an
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2129</span></td>
       <td><span class="comment code">   * array of commands, to update $this-&gt;content using equivalent DOM
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2130</span></td>
       <td><span class="comment code">   * manipulation as is used by ajax.js. It also returns the array of commands.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2131</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2132</span></td>
       <td><span class="comment code">   * @param $path
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2133</span></td>
       <td><span class="comment code">   *   Location of the form containing the Ajax enabled element to test. Can be
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2134</span></td>
       <td><span class="comment code">   *   either a Drupal path or an absolute path or NULL to use the current page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2135</span></td>
       <td><span class="comment code">   * @param $edit
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2136</span></td>
       <td><span class="comment code">   *   Field data in an associative array. Changes the current input fields
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2137</span></td>
       <td><span class="comment code">   *   (where possible) to the values indicated.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2138</span></td>
       <td><span class="comment code">   * @param $triggering_element
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2139</span></td>
       <td><span class="comment code">   *   The name of the form element that is responsible for triggering the Ajax
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2140</span></td>
       <td><span class="comment code">   *   functionality to test. May be a string or, if the triggering element is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2141</span></td>
       <td><span class="comment code">   *   a button, an associative array where the key is the name of the button
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2142</span></td>
       <td><span class="comment code">   *   and the value is the button label. i.e.) array('op' =&gt; t('Refresh')).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2143</span></td>
       <td><span class="comment code">   * @param $ajax_path
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2144</span></td>
       <td><span class="comment code">   *   (optional) Override the path set by the Ajax settings of the triggering
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2145</span></td>
       <td><span class="comment code">   *   element. In the absence of both the triggering element's Ajax path and
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2146</span></td>
       <td><span class="comment code">   *   $ajax_path 'system/ajax' will be used.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2147</span></td>
       <td><span class="comment code">   * @param $options
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2148</span></td>
       <td><span class="comment code">   *   (optional) Options to be forwarded to url().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2149</span></td>
       <td><span class="comment code">   * @param $headers
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2150</span></td>
       <td><span class="comment code">   *   (optional) An array containing additional HTTP request headers, each
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2151</span></td>
       <td><span class="comment code">   *   formatted as &quot;name: value&quot;. Forwarded to drupalPost().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2152</span></td>
       <td><span class="comment code">   * @param $form_html_id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2153</span></td>
       <td><span class="comment code">   *   (optional) HTML ID of the form to be submitted, use when there is more
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2154</span></td>
       <td><span class="comment code">   *   than one identical form on the same page and the value of the triggering
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2155</span></td>
       <td><span class="comment code">   *   element is not enough to identify the form. Note this is not the Drupal
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2156</span></td>
       <td><span class="comment code">   *   ID of the form but rather the HTML ID of the form.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2157</span></td>
       <td><span class="comment code">   * @param $ajax_settings
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2158</span></td>
       <td><span class="comment code">   *   (optional) An array of Ajax settings which if specified will be used in
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2159</span></td>
       <td><span class="comment code">   *   place of the Ajax settings of the triggering element.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2160</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2161</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2162</span></td>
       <td><span class="comment code">   *   An array of Ajax commands.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2163</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2164</span></td>
       <td><span class="comment code">   * @see drupalPost()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2165</span></td>
       <td><span class="comment code">   * @see ajax.js
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2166</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2167</span></td>
       <td><span class="comment code">  protected function drupalPostAJAX($path, $edit, $triggering_element, $ajax_path = NULL, array $options = array(), array $headers = array(), $form_html_id = NULL, $ajax_settings = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2168</span></td>
       <td><span class="comment code">    // Get the content of the initial page prior to calling drupalPost(), since
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2169</span></td>
       <td><span class="comment code">    // drupalPost() replaces $this-&gt;content.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2170</span></td>
       <td><span class="missed code">    if (isset($path)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2171</span></td>
       <td><span class="missed code">      $this-&gt;drupalGet($path, $options);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2172</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2173</span></td>
       <td><span class="missed code">    $content = $this-&gt;content;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2174</span></td>
       <td><span class="missed code">    $drupal_settings = $this-&gt;drupalSettings;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2175</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2176</span></td>
       <td><span class="comment code">    // Get the Ajax settings bound to the triggering element.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2177</span></td>
       <td><span class="missed code">    if (!isset($ajax_settings)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2178</span></td>
       <td><span class="missed code">      if (is_array($triggering_element)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2179</span></td>
       <td><span class="missed code">        $xpath = '//*[@name=&quot;' . key($triggering_element) . '&quot; and @value=&quot;' . current($triggering_element) . '&quot;]';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2180</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2181</span></td>
       <td><span class="comment code">      else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2182</span></td>
       <td><span class="missed code">        $xpath = '//*[@name=&quot;' . $triggering_element . '&quot;]';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2183</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2184</span></td>
       <td><span class="missed code">      if (isset($form_html_id)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2185</span></td>
       <td><span class="missed code">        $xpath = '//form[@id=&quot;' . $form_html_id . '&quot;]' . $xpath;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2186</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2187</span></td>
       <td><span class="missed code">      $element = $this-&gt;xpath($xpath);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2188</span></td>
       <td><span class="missed code">      $element_id = (string) $element[0]['id'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2189</span></td>
       <td><span class="missed code">      $ajax_settings = $drupal_settings['ajax'][$element_id];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2190</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2191</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2192</span></td>
       <td><span class="comment code">    // Add extra information to the POST data as ajax.js does.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2193</span></td>
       <td><span class="missed code">    $extra_post = '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2194</span></td>
       <td><span class="missed code">    if (isset($ajax_settings['submit'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2195</span></td>
       <td><span class="missed code">      foreach ($ajax_settings['submit'] as $key =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2196</span></td>
       <td><span class="missed code">        $extra_post .= '&amp;' . urlencode($key) . '=' . urlencode($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2197</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2198</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2199</span></td>
       <td><span class="missed code">    foreach ($this-&gt;xpath('//*[@id]') as $element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2200</span></td>
       <td><span class="missed code">      $id = (string) $element['id'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2201</span></td>
       <td><span class="missed code">      $extra_post .= '&amp;' . urlencode('ajax_html_ids[]') . '=' . urlencode($id);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2202</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2203</span></td>
       <td><span class="missed code">    if (isset($drupal_settings['ajaxPageState'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2204</span></td>
       <td><span class="missed code">      $extra_post .= '&amp;' . urlencode('ajax_page_state[theme]') . '=' . urlencode($drupal_settings['ajaxPageState']['theme']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2205</span></td>
       <td><span class="missed code">      $extra_post .= '&amp;' . urlencode('ajax_page_state[theme_token]') . '=' . urlencode($drupal_settings['ajaxPageState']['theme_token']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2206</span></td>
       <td><span class="missed code">      foreach ($drupal_settings['ajaxPageState']['css'] as $key =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2207</span></td>
       <td><span class="missed code">        $extra_post .= '&amp;' . urlencode(&quot;ajax_page_state[css][$key]&quot;) . '=1';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2208</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2209</span></td>
       <td><span class="missed code">      foreach ($drupal_settings['ajaxPageState']['js'] as $key =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2210</span></td>
       <td><span class="missed code">        $extra_post .= '&amp;' . urlencode(&quot;ajax_page_state[js][$key]&quot;) . '=1';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2211</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2212</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2213</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2214</span></td>
       <td><span class="comment code">    // Unless a particular path is specified, use the one specified by the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2215</span></td>
       <td><span class="comment code">    // Ajax settings, or else 'system/ajax'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2216</span></td>
       <td><span class="missed code">    if (!isset($ajax_path)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2217</span></td>
       <td><span class="missed code">      $ajax_path = isset($ajax_settings['url']) ? $ajax_settings['url'] : 'system/ajax';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2218</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2219</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2220</span></td>
       <td><span class="comment code">    // Submit the POST request.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2221</span></td>
       <td><span class="missed code">    $return = drupal_json_decode($this-&gt;drupalPost(NULL, $edit, array('path' =&gt; $ajax_path, 'triggering_element' =&gt; $triggering_element), $options, $headers, $form_html_id, $extra_post));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2222</span></td>
       <td><span class="missed code">    $this-&gt;assertIdentical($this-&gt;drupalGetHeader('X-Drupal-Ajax-Token'), '1', 'Ajax response header found.');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2223</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2224</span></td>
       <td><span class="comment code">    // Change the page content by applying the returned commands.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2225</span></td>
       <td><span class="missed code">    if (!empty($ajax_settings) &amp;&amp; !empty($return)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2226</span></td>
       <td><span class="comment code">      // ajax.js applies some defaults to the settings object, so do the same
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2227</span></td>
       <td><span class="comment code">      // for what's used by this function.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2228</span></td>
       <td><span class="comment code">      $ajax_settings += array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2229</span></td>
       <td><span class="missed code">        'method' =&gt; 'replaceWith',
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2230</span></td>
       <td><span class="missed code">      );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2231</span></td>
       <td><span class="comment code">      // DOM can load HTML soup. But, HTML soup can throw warnings, suppress
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2232</span></td>
       <td><span class="comment code">      // them.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2233</span></td>
       <td><span class="missed code">      $dom = new DOMDocument();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2234</span></td>
       <td><span class="missed code">      @$dom-&gt;loadHTML($content);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2235</span></td>
       <td><span class="comment code">      // XPath allows for finding wrapper nodes better than DOM does.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2236</span></td>
       <td><span class="missed code">      $xpath = new DOMXPath($dom);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2237</span></td>
       <td><span class="missed code">      foreach ($return as $command) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2238</span></td>
       <td><span class="missed code">        switch ($command['command']) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2239</span></td>
       <td><span class="missed code">          case 'settings':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2240</span></td>
       <td><span class="missed code">            $drupal_settings = drupal_array_merge_deep($drupal_settings, $command['settings']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2241</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2242</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2243</span></td>
       <td><span class="missed code">          case 'insert':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2244</span></td>
       <td><span class="missed code">            $wrapperNode = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2245</span></td>
       <td><span class="comment code">            // When a command doesn't specify a selector, use the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2246</span></td>
       <td><span class="comment code">            // #ajax['wrapper'] which is always an HTML ID.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2247</span></td>
       <td><span class="missed code">            if (!isset($command['selector'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2248</span></td>
       <td><span class="missed code">              $wrapperNode = $xpath-&gt;query('//*[@id=&quot;' . $ajax_settings['wrapper'] . '&quot;]')-&gt;item(0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2249</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2250</span></td>
       <td><span class="comment code">            // @todo Ajax commands can target any jQuery selector, but these are
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2251</span></td>
       <td><span class="comment code">            //   hard to fully emulate with XPath. For now, just handle 'head'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2252</span></td>
       <td><span class="comment code">            //   and 'body', since these are used by ajax_render().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2253</span></td>
       <td><span class="missed code">            elseif (in_array($command['selector'], array('head', 'body'))) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2254</span></td>
       <td><span class="missed code">              $wrapperNode = $xpath-&gt;query('//' . $command['selector'])-&gt;item(0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2255</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2256</span></td>
       <td><span class="missed code">            if ($wrapperNode) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2257</span></td>
       <td><span class="comment code">              // ajax.js adds an enclosing DIV to work around a Safari bug.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2258</span></td>
       <td><span class="missed code">              $newDom = new DOMDocument();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2259</span></td>
       <td><span class="comment code">              // DOM can load HTML soup. But, HTML soup can throw warnings,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2260</span></td>
       <td><span class="comment code">              // suppress them.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2261</span></td>
       <td><span class="missed code">              $newDom-&gt;loadHTML('&lt;div&gt;' . $command['data'] . '&lt;/div&gt;');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2262</span></td>
       <td><span class="comment code">              // Suppress warnings thrown when duplicate HTML IDs are
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2263</span></td>
       <td><span class="comment code">              // encountered. This probably means we are replacing an element
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2264</span></td>
       <td><span class="comment code">              // with the same ID.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2265</span></td>
       <td><span class="missed code">              $newNode = @$dom-&gt;importNode($newDom-&gt;documentElement-&gt;firstChild-&gt;firstChild, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2266</span></td>
       <td><span class="missed code">              $method = isset($command['method']) ? $command['method'] : $ajax_settings['method'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2267</span></td>
       <td><span class="comment code">              // The &quot;method&quot; is a jQuery DOM manipulation function. Emulate
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2268</span></td>
       <td><span class="comment code">              // each one using PHP's DOMNode API.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2269</span></td>
       <td><span class="comment code">              switch ($method) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2270</span></td>
       <td><span class="missed code">                case 'replaceWith':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2271</span></td>
       <td><span class="missed code">                  $wrapperNode-&gt;parentNode-&gt;replaceChild($newNode, $wrapperNode);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2272</span></td>
       <td><span class="missed code">                  break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2273</span></td>
       <td><span class="missed code">                case 'append':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2274</span></td>
       <td><span class="missed code">                  $wrapperNode-&gt;appendChild($newNode);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2275</span></td>
       <td><span class="missed code">                  break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2276</span></td>
       <td><span class="missed code">                case 'prepend':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2277</span></td>
       <td><span class="comment code">                  // If no firstChild, insertBefore() falls back to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2278</span></td>
       <td><span class="comment code">                  // appendChild().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2279</span></td>
       <td><span class="missed code">                  $wrapperNode-&gt;insertBefore($newNode, $wrapperNode-&gt;firstChild);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2280</span></td>
       <td><span class="missed code">                  break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2281</span></td>
       <td><span class="missed code">                case 'before':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2282</span></td>
       <td><span class="missed code">                  $wrapperNode-&gt;parentNode-&gt;insertBefore($newNode, $wrapperNode);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2283</span></td>
       <td><span class="missed code">                  break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2284</span></td>
       <td><span class="missed code">                case 'after':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2285</span></td>
       <td><span class="comment code">                  // If no nextSibling, insertBefore() falls back to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2286</span></td>
       <td><span class="comment code">                  // appendChild().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2287</span></td>
       <td><span class="missed code">                  $wrapperNode-&gt;parentNode-&gt;insertBefore($newNode, $wrapperNode-&gt;nextSibling);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2288</span></td>
       <td><span class="missed code">                  break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2289</span></td>
       <td><span class="missed code">                case 'html':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2290</span></td>
       <td><span class="missed code">                  foreach ($wrapperNode-&gt;childNodes as $childNode) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2291</span></td>
       <td><span class="missed code">                    $wrapperNode-&gt;removeChild($childNode);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2292</span></td>
       <td><span class="missed code">                  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2293</span></td>
       <td><span class="missed code">                  $wrapperNode-&gt;appendChild($newNode);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2294</span></td>
       <td><span class="missed code">                  break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2295</span></td>
       <td><span class="dead code">              }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2296</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2297</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2298</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2299</span></td>
       <td><span class="missed code">          case 'updateBuildId':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2300</span></td>
       <td><span class="missed code">            $buildId = $xpath-&gt;query('//input[@name=&quot;form_build_id&quot; and @value=&quot;' . $command['old'] . '&quot;]')-&gt;item(0);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2301</span></td>
       <td><span class="missed code">            if ($buildId) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2302</span></td>
       <td><span class="missed code">              $buildId-&gt;setAttribute('value', $command['new']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2303</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2304</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2305</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2306</span></td>
       <td><span class="comment code">          // @todo Add suitable implementations for these commands in order to
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2307</span></td>
       <td><span class="comment code">          //   have full test coverage of what ajax.js can do.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2308</span></td>
       <td><span class="missed code">          case 'remove':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2309</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2310</span></td>
       <td><span class="missed code">          case 'changed':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2311</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2312</span></td>
       <td><span class="missed code">          case 'css':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2313</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2314</span></td>
       <td><span class="missed code">          case 'data':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2315</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2316</span></td>
       <td><span class="missed code">          case 'restripe':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2317</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2318</span></td>
       <td><span class="missed code">          case 'add_css':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2319</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2320</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2321</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2322</span></td>
       <td><span class="missed code">      $content = $dom-&gt;saveHTML();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2323</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2324</span></td>
       <td><span class="missed code">    $this-&gt;drupalSetContent($content);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2325</span></td>
       <td><span class="missed code">    $this-&gt;drupalSetSettings($drupal_settings);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2326</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2327</span></td>
       <td><span class="missed code">    $verbose = 'AJAX POST request to: ' . $path;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2328</span></td>
       <td><span class="missed code">    $verbose .= '&lt;br /&gt;AJAX callback path: ' . $ajax_path;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2329</span></td>
       <td><span class="missed code">    $verbose .= '&lt;hr /&gt;Ending URL: ' . $this-&gt;getUrl();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2330</span></td>
       <td><span class="missed code">    $verbose .= '&lt;hr /&gt;' . $this-&gt;content;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2331</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2332</span></td>
       <td><span class="missed code">    $this-&gt;verbose($verbose);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2333</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2334</span></td>
       <td><span class="missed code">    return $return;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2335</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2336</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2337</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2338</span></td>
       <td><span class="comment code">   * Runs cron in the Drupal installed by Simpletest.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2339</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2340</span></td>
       <td><span class="comment code">  protected function cronRun() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2341</span></td>
       <td><span class="covered code">    $this-&gt;drupalGet($GLOBALS['base_url'] . '/cron.php', array('external' =&gt; TRUE, 'query' =&gt; array('cron_key' =&gt; variable_get('cron_key', 'drupal'))));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2342</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2343</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2344</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2345</span></td>
       <td><span class="comment code">   * Check for meta refresh tag and if found call drupalGet() recursively. This
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2346</span></td>
       <td><span class="comment code">   * function looks for the http-equiv attribute to be set to &quot;Refresh&quot;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2347</span></td>
       <td><span class="comment code">   * and is case-sensitive.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2348</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2349</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2350</span></td>
       <td><span class="comment code">   *   Either the new page content or FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2351</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2352</span></td>
       <td><span class="comment code">  protected function checkForMetaRefresh() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2353</span></td>
       <td><span class="covered code">    if (strpos($this-&gt;drupalGetContent(), '&lt;meta ') &amp;&amp; $this-&gt;parse()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2354</span></td>
       <td><span class="covered code">      $refresh = $this-&gt;xpath('//meta[@http-equiv=&quot;Refresh&quot;]');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2355</span></td>
       <td><span class="covered code">      if (!empty($refresh)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2356</span></td>
       <td><span class="comment code">        // Parse the content attribute of the meta tag for the format:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2357</span></td>
       <td><span class="comment code">        // &quot;[delay]: URL=[page_to_redirect_to]&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2358</span></td>
       <td><span class="missed code">        if (preg_match('/\d+;\s*URL=(?P&lt;url&gt;.*)/i', $refresh[0]['content'], $match)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2359</span></td>
       <td><span class="missed code">          return $this-&gt;drupalGet($this-&gt;getAbsoluteUrl(decode_entities($match['url'])));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2360</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2361</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2362</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2363</span></td>
       <td><span class="covered code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2364</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2365</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2366</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2367</span></td>
       <td><span class="comment code">   * Retrieves only the headers for a Drupal path or an absolute path.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2368</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2369</span></td>
       <td><span class="comment code">   * @param $path
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2370</span></td>
       <td><span class="comment code">   *   Drupal path or URL to load into internal browser
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2371</span></td>
       <td><span class="comment code">   * @param $options
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2372</span></td>
       <td><span class="comment code">   *   Options to be forwarded to url().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2373</span></td>
       <td><span class="comment code">   * @param $headers
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2374</span></td>
       <td><span class="comment code">   *   An array containing additional HTTP request headers, each formatted as
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2375</span></td>
       <td><span class="comment code">   *   &quot;name: value&quot;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2376</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2377</span></td>
       <td><span class="comment code">   *   The retrieved headers, also available as $this-&gt;drupalGetContent()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2378</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2379</span></td>
       <td><span class="comment code">  protected function drupalHead($path, array $options = array(), array $headers = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2380</span></td>
       <td><span class="missed code">    $options['absolute'] = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2381</span></td>
       <td><span class="missed code">    $out = $this-&gt;curlExec(array(CURLOPT_NOBODY =&gt; TRUE, CURLOPT_URL =&gt; url($path, $options), CURLOPT_HTTPHEADER =&gt; $headers));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2382</span></td>
       <td><span class="missed code">    $this-&gt;refreshVariables(); // Ensure that any changes to variables in the other thread are picked up.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2383</span></td>
       <td><span class="missed code">    return $out;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2384</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2385</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2386</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2387</span></td>
       <td><span class="comment code">   * Handle form input related to drupalPost(). Ensure that the specified fields
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2388</span></td>
       <td><span class="comment code">   * exist and attempt to create POST data in the correct manner for the particular
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2389</span></td>
       <td><span class="comment code">   * field type.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2390</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2391</span></td>
       <td><span class="comment code">   * @param $post
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2392</span></td>
       <td><span class="comment code">   *   Reference to array of post values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2393</span></td>
       <td><span class="comment code">   * @param $edit
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2394</span></td>
       <td><span class="comment code">   *   Reference to array of edit values to be checked against the form.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2395</span></td>
       <td><span class="comment code">   * @param $submit
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2396</span></td>
       <td><span class="comment code">   *   Form submit button value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2397</span></td>
       <td><span class="comment code">   * @param $form
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2398</span></td>
       <td><span class="comment code">   *   Array of form elements.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2399</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2400</span></td>
       <td><span class="comment code">   *   Submit value matches a valid submit input in the form.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2401</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2402</span></td>
       <td><span class="comment code">  protected function handleForm(&amp;$post, &amp;$edit, &amp;$upload, $submit, $form) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2403</span></td>
       <td><span class="comment code">    // Retrieve the form elements.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2404</span></td>
       <td><span class="covered code">    $elements = $form-&gt;xpath('.//input[not(@disabled)]|.//textarea[not(@disabled)]|.//select[not(@disabled)]');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2405</span></td>
       <td><span class="covered code">    $submit_matches = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2406</span></td>
       <td><span class="covered code">    foreach ($elements as $element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2407</span></td>
       <td><span class="comment code">      // SimpleXML objects need string casting all the time.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2408</span></td>
       <td><span class="covered code">      $name = (string) $element['name'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2409</span></td>
       <td><span class="comment code">      // This can either be the type of &lt;input&gt; or the name of the tag itself
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2410</span></td>
       <td><span class="comment code">      // for &lt;select&gt; or &lt;textarea&gt;.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2411</span></td>
       <td><span class="covered code">      $type = isset($element['type']) ? (string) $element['type'] : $element-&gt;getName();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2412</span></td>
       <td><span class="covered code">      $value = isset($element['value']) ? (string) $element['value'] : '';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2413</span></td>
       <td><span class="covered code">      $done = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2414</span></td>
       <td><span class="covered code">      if (isset($edit[$name])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2415</span></td>
       <td><span class="comment code">        switch ($type) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2416</span></td>
       <td><span class="covered code">          case 'text':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2417</span></td>
       <td><span class="covered code">          case 'tel':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2418</span></td>
       <td><span class="covered code">          case 'textarea':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2419</span></td>
       <td><span class="covered code">          case 'url':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2420</span></td>
       <td><span class="covered code">          case 'number':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2421</span></td>
       <td><span class="covered code">          case 'range':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2422</span></td>
       <td><span class="covered code">          case 'color':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2423</span></td>
       <td><span class="covered code">          case 'hidden':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2424</span></td>
       <td><span class="covered code">          case 'password':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2425</span></td>
       <td><span class="covered code">          case 'email':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2426</span></td>
       <td><span class="covered code">          case 'search':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2427</span></td>
       <td><span class="covered code">            $post[$name] = $edit[$name];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2428</span></td>
       <td><span class="covered code">            unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2429</span></td>
       <td><span class="covered code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2430</span></td>
       <td><span class="covered code">          case 'radio':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2431</span></td>
       <td><span class="covered code">            if ($edit[$name] == $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2432</span></td>
       <td><span class="covered code">              $post[$name] = $edit[$name];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2433</span></td>
       <td><span class="covered code">              unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2434</span></td>
       <td><span class="covered code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2435</span></td>
       <td><span class="covered code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2436</span></td>
       <td><span class="covered code">          case 'checkbox':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2437</span></td>
       <td><span class="comment code">            // To prevent checkbox from being checked.pass in a FALSE,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2438</span></td>
       <td><span class="comment code">            // otherwise the checkbox will be set to its value regardless
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2439</span></td>
       <td><span class="comment code">            // of $edit.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2440</span></td>
       <td><span class="covered code">            if ($edit[$name] === FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2441</span></td>
       <td><span class="covered code">              unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2442</span></td>
       <td><span class="covered code">              continue 2;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2443</span></td>
       <td><span class="dead code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2444</span></td>
       <td><span class="comment code">            else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2445</span></td>
       <td><span class="covered code">              unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2446</span></td>
       <td><span class="covered code">              $post[$name] = $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2447</span></td>
       <td><span class="comment code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2448</span></td>
       <td><span class="covered code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2449</span></td>
       <td><span class="missed code">          case 'select':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2450</span></td>
       <td><span class="missed code">            $new_value = $edit[$name];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2451</span></td>
       <td><span class="missed code">            $options = $this-&gt;getAllOptions($element);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2452</span></td>
       <td><span class="missed code">            if (is_array($new_value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2453</span></td>
       <td><span class="comment code">              // Multiple select box.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2454</span></td>
       <td><span class="missed code">              if (!empty($new_value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2455</span></td>
       <td><span class="missed code">                $index = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2456</span></td>
       <td><span class="missed code">                $key = preg_replace('/\[\]$/', '', $name);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2457</span></td>
       <td><span class="missed code">                foreach ($options as $option) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2458</span></td>
       <td><span class="missed code">                  $option_value = (string) $option['value'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2459</span></td>
       <td><span class="missed code">                  if (in_array($option_value, $new_value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2460</span></td>
       <td><span class="missed code">                    $post[$key . '[' . $index++ . ']'] = $option_value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2461</span></td>
       <td><span class="missed code">                    $done = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2462</span></td>
       <td><span class="missed code">                    unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2463</span></td>
       <td><span class="missed code">                  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2464</span></td>
       <td><span class="missed code">                }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2465</span></td>
       <td><span class="missed code">              }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2466</span></td>
       <td><span class="comment code">              else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2467</span></td>
       <td><span class="comment code">                // No options selected: do not include any POST data for the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2468</span></td>
       <td><span class="comment code">                // element.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2469</span></td>
       <td><span class="missed code">                $done = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2470</span></td>
       <td><span class="missed code">                unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2471</span></td>
       <td><span class="comment code">              }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2472</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2473</span></td>
       <td><span class="comment code">            else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2474</span></td>
       <td><span class="comment code">              // Single select box.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2475</span></td>
       <td><span class="missed code">              foreach ($options as $option) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2476</span></td>
       <td><span class="missed code">                if ($new_value == $option['value']) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2477</span></td>
       <td><span class="missed code">                  $post[$name] = $new_value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2478</span></td>
       <td><span class="missed code">                  unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2479</span></td>
       <td><span class="missed code">                  $done = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2480</span></td>
       <td><span class="missed code">                  break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2481</span></td>
       <td><span class="dead code">                }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2482</span></td>
       <td><span class="missed code">              }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2483</span></td>
       <td><span class="comment code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2484</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2485</span></td>
       <td><span class="missed code">          case 'file':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2486</span></td>
       <td><span class="missed code">            $upload[$name] = $edit[$name];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2487</span></td>
       <td><span class="missed code">            unset($edit[$name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2488</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2489</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2490</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2491</span></td>
       <td><span class="covered code">      if (!isset($post[$name]) &amp;&amp; !$done) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2492</span></td>
       <td><span class="comment code">        switch ($type) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2493</span></td>
       <td><span class="covered code">          case 'textarea':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2494</span></td>
       <td><span class="covered code">            $post[$name] = (string) $element;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2495</span></td>
       <td><span class="covered code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2496</span></td>
       <td><span class="covered code">          case 'select':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2497</span></td>
       <td><span class="missed code">            $single = empty($element['multiple']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2498</span></td>
       <td><span class="missed code">            $first = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2499</span></td>
       <td><span class="missed code">            $index = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2500</span></td>
       <td><span class="missed code">            $key = preg_replace('/\[\]$/', '', $name);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2501</span></td>
       <td><span class="missed code">            $options = $this-&gt;getAllOptions($element);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2502</span></td>
       <td><span class="missed code">            foreach ($options as $option) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2503</span></td>
       <td><span class="comment code">              // For single select, we load the first option, if there is a
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2504</span></td>
       <td><span class="comment code">              // selected option that will overwrite it later.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2505</span></td>
       <td><span class="missed code">              if ($option['selected'] || ($first &amp;&amp; $single)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2506</span></td>
       <td><span class="missed code">                $first = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2507</span></td>
       <td><span class="missed code">                if ($single) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2508</span></td>
       <td><span class="missed code">                  $post[$name] = (string) $option['value'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2509</span></td>
       <td><span class="missed code">                }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2510</span></td>
       <td><span class="comment code">                else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2511</span></td>
       <td><span class="missed code">                  $post[$key . '[' . $index++ . ']'] = (string) $option['value'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2512</span></td>
       <td><span class="comment code">                }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2513</span></td>
       <td><span class="missed code">              }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2514</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2515</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2516</span></td>
       <td><span class="covered code">          case 'file':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2517</span></td>
       <td><span class="missed code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2518</span></td>
       <td><span class="covered code">          case 'submit':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2519</span></td>
       <td><span class="covered code">          case 'image':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2520</span></td>
       <td><span class="covered code">            if (isset($submit) &amp;&amp; $submit == $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2521</span></td>
       <td><span class="covered code">              $post[$name] = $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2522</span></td>
       <td><span class="covered code">              $submit_matches = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2523</span></td>
       <td><span class="covered code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2524</span></td>
       <td><span class="covered code">            break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2525</span></td>
       <td><span class="covered code">          case 'radio':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2526</span></td>
       <td><span class="covered code">          case 'checkbox':
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2527</span></td>
       <td><span class="covered code">            if (!isset($element['checked'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2528</span></td>
       <td><span class="covered code">              break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2529</span></td>
       <td><span class="dead code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2530</span></td>
       <td><span class="comment code">            // Deliberate no break.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2531</span></td>
       <td><span class="covered code">          default:
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2532</span></td>
       <td><span class="covered code">            $post[$name] = $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2533</span></td>
       <td><span class="covered code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2534</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2535</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2536</span></td>
       <td><span class="covered code">    return $submit_matches;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2537</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2538</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2539</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2540</span></td>
       <td><span class="comment code">   * Builds an XPath query.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2541</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2542</span></td>
       <td><span class="comment code">   * Builds an XPath query by replacing placeholders in the query by the value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2543</span></td>
       <td><span class="comment code">   * of the arguments.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2544</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2545</span></td>
       <td><span class="comment code">   * XPath 1.0 (the version supported by libxml2, the underlying XML library
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2546</span></td>
       <td><span class="comment code">   * used by PHP) doesn't support any form of quotation. This function
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2547</span></td>
       <td><span class="comment code">   * simplifies the building of XPath expression.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2548</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2549</span></td>
       <td><span class="comment code">   * @param $xpath
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2550</span></td>
       <td><span class="comment code">   *   An XPath query, possibly with placeholders in the form ':name'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2551</span></td>
       <td><span class="comment code">   * @param $args
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2552</span></td>
       <td><span class="comment code">   *   An array of arguments with keys in the form ':name' matching the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2553</span></td>
       <td><span class="comment code">   *   placeholders in the query. The values may be either strings or numeric
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2554</span></td>
       <td><span class="comment code">   *   values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2555</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2556</span></td>
       <td><span class="comment code">   *   An XPath query with arguments replaced.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2557</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2558</span></td>
       <td><span class="comment code">  protected function buildXPathQuery($xpath, array $args = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2559</span></td>
       <td><span class="comment code">    // Replace placeholders.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2560</span></td>
       <td><span class="covered code">    foreach ($args as $placeholder =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2561</span></td>
       <td><span class="comment code">      // XPath 1.0 doesn't support a way to escape single or double quotes in a
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2562</span></td>
       <td><span class="comment code">      // string literal. We split double quotes out of the string, and encode
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2563</span></td>
       <td><span class="comment code">      // them separately.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2564</span></td>
       <td><span class="covered code">      if (is_string($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2565</span></td>
       <td><span class="comment code">        // Explode the text at the quote characters.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2566</span></td>
       <td><span class="covered code">        $parts = explode('&quot;', $value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2567</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2568</span></td>
       <td><span class="comment code">        // Quote the parts.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2569</span></td>
       <td><span class="covered code">        foreach ($parts as &amp;$part) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2570</span></td>
       <td><span class="covered code">          $part = '&quot;' . $part . '&quot;';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2571</span></td>
       <td><span class="covered code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2572</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2573</span></td>
       <td><span class="comment code">        // Return the string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2574</span></td>
       <td><span class="covered code">        $value = count($parts) &gt; 1 ? 'concat(' . implode(', \'&quot;\', ', $parts) . ')' : $parts[0];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2575</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2576</span></td>
       <td><span class="covered code">      $xpath = preg_replace('/' . preg_quote($placeholder) . '\b/', $value, $xpath);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2577</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2578</span></td>
       <td><span class="covered code">    return $xpath;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2579</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2580</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2581</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2582</span></td>
       <td><span class="comment code">   * Perform an xpath search on the contents of the internal browser. The search
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2583</span></td>
       <td><span class="comment code">   * is relative to the root element (HTML tag normally) of the page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2584</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2585</span></td>
       <td><span class="comment code">   * @param $xpath
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2586</span></td>
       <td><span class="comment code">   *   The xpath string to use in the search.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2587</span></td>
       <td><span class="comment code">   * @param array $arguments
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2588</span></td>
       <td><span class="comment code">   *   An array of arguments with keys in the form ':name' matching the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2589</span></td>
       <td><span class="comment code">   *   placeholders in the query. The values may be either strings or numeric
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2590</span></td>
       <td><span class="comment code">   *   values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2591</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2592</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2593</span></td>
       <td><span class="comment code">   *   The return value of the xpath search. For details on the xpath string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2594</span></td>
       <td><span class="comment code">   *   format and return values see the SimpleXML documentation,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2595</span></td>
       <td><span class="comment code">   *   http://us.php.net/manual/function.simplexml-element-xpath.php.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2596</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2597</span></td>
       <td><span class="comment code">  protected function xpath($xpath, array $arguments = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2598</span></td>
       <td><span class="covered code">    if ($this-&gt;parse()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2599</span></td>
       <td><span class="covered code">      $xpath = $this-&gt;buildXPathQuery($xpath, $arguments);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2600</span></td>
       <td><span class="covered code">      $result = $this-&gt;elements-&gt;xpath($xpath);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2601</span></td>
       <td><span class="comment code">      // Some combinations of PHP / libxml versions return an empty array
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2602</span></td>
       <td><span class="comment code">      // instead of the documented FALSE. Forcefully convert any falsish values
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2603</span></td>
       <td><span class="comment code">      // to an empty array to allow foreach(...) constructions.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2604</span></td>
       <td><span class="covered code">      return $result ? $result : array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2605</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2606</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2607</span></td>
       <td><span class="missed code">      return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2608</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2609</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2610</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2611</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2612</span></td>
       <td><span class="comment code">   * Get all option elements, including nested options, in a select.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2613</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2614</span></td>
       <td><span class="comment code">   * @param $element
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2615</span></td>
       <td><span class="comment code">   *   The element for which to get the options.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2616</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2617</span></td>
       <td><span class="comment code">   *   Option elements in select.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2618</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2619</span></td>
       <td><span class="comment code">  protected function getAllOptions(SimpleXMLElement $element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2620</span></td>
       <td><span class="missed code">    $options = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2621</span></td>
       <td><span class="comment code">    // Add all options items.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2622</span></td>
       <td><span class="missed code">    foreach ($element-&gt;option as $option) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2623</span></td>
       <td><span class="missed code">      $options[] = $option;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2624</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2625</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2626</span></td>
       <td><span class="comment code">    // Search option group children.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2627</span></td>
       <td><span class="missed code">    if (isset($element-&gt;optgroup)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2628</span></td>
       <td><span class="missed code">      foreach ($element-&gt;optgroup as $group) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2629</span></td>
       <td><span class="missed code">        $options = array_merge($options, $this-&gt;getAllOptions($group));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2630</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2631</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2632</span></td>
       <td><span class="missed code">    return $options;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2633</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2634</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2635</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2636</span></td>
       <td><span class="comment code">   * Pass if a link with the specified label is found, and optional with the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2637</span></td>
       <td><span class="comment code">   * specified index.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2638</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2639</span></td>
       <td><span class="comment code">   * @param $label
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2640</span></td>
       <td><span class="comment code">   *   Text between the anchor tags.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2641</span></td>
       <td><span class="comment code">   * @param $index
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2642</span></td>
       <td><span class="comment code">   *   Link position counting from zero.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2643</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2644</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2645</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2646</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2647</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2648</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2649</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2650</span></td>
       <td><span class="comment code">  protected function assertLink($label, $index = 0, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2651</span></td>
       <td><span class="covered code">    $links = $this-&gt;xpath('//a[normalize-space(text())=:label]', array(':label' =&gt; $label));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2652</span></td>
       <td><span class="covered code">    $message = ($message ?  $message : t('Link with label %label found.', array('%label' =&gt; $label)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2653</span></td>
       <td><span class="covered code">    return $this-&gt;assert(isset($links[$index]), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2654</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2655</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2656</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2657</span></td>
       <td><span class="comment code">   * Pass if a link with the specified label is not found.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2658</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2659</span></td>
       <td><span class="comment code">   * @param $label
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2660</span></td>
       <td><span class="comment code">   *   Text between the anchor tags.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2661</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2662</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2663</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2664</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2665</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2666</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2667</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2668</span></td>
       <td><span class="comment code">  protected function assertNoLink($label, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2669</span></td>
       <td><span class="missed code">    $links = $this-&gt;xpath('//a[normalize-space(text())=:label]', array(':label' =&gt; $label));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2670</span></td>
       <td><span class="missed code">    $message = ($message ?  $message : t('Link with label %label not found.', array('%label' =&gt; $label)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2671</span></td>
       <td><span class="missed code">    return $this-&gt;assert(empty($links), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2672</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2673</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2674</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2675</span></td>
       <td><span class="comment code">   * Pass if a link containing a given href (part) is found.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2676</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2677</span></td>
       <td><span class="comment code">   * @param $href
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2678</span></td>
       <td><span class="comment code">   *   The full or partial value of the 'href' attribute of the anchor tag.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2679</span></td>
       <td><span class="comment code">   * @param $index
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2680</span></td>
       <td><span class="comment code">   *   Link position counting from zero.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2681</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2682</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2683</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2684</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2685</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2686</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2687</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2688</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2689</span></td>
       <td><span class="comment code">  protected function assertLinkByHref($href, $index = 0, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2690</span></td>
       <td><span class="missed code">    $links = $this-&gt;xpath('//a[contains(@href, :href)]', array(':href' =&gt; $href));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2691</span></td>
       <td><span class="missed code">    $message = ($message ?  $message : t('Link containing href %href found.', array('%href' =&gt; $href)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2692</span></td>
       <td><span class="missed code">    return $this-&gt;assert(isset($links[$index]), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2693</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2694</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2695</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2696</span></td>
       <td><span class="comment code">   * Pass if a link containing a given href (part) is not found.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2697</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2698</span></td>
       <td><span class="comment code">   * @param $href
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2699</span></td>
       <td><span class="comment code">   *   The full or partial value of the 'href' attribute of the anchor tag.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2700</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2701</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2702</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2703</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2704</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2705</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2706</span></td>
       <td><span class="comment code">   *   TRUE if the assertion succeeded, FALSE otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2707</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2708</span></td>
       <td><span class="comment code">  protected function assertNoLinkByHref($href, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2709</span></td>
       <td><span class="missed code">    $links = $this-&gt;xpath('//a[contains(@href, :href)]', array(':href' =&gt; $href));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2710</span></td>
       <td><span class="missed code">    $message = ($message ?  $message : t('No link containing href %href found.', array('%href' =&gt; $href)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2711</span></td>
       <td><span class="missed code">    return $this-&gt;assert(empty($links), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2712</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2713</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2714</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2715</span></td>
       <td><span class="comment code">   * Follows a link by name.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2716</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2717</span></td>
       <td><span class="comment code">   * Will click the first link found with this link text by default, or a later
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2718</span></td>
       <td><span class="comment code">   * one if an index is given. Match is case sensitive with normalized space.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2719</span></td>
       <td><span class="comment code">   * The label is translated label.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2720</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2721</span></td>
       <td><span class="comment code">   * If the link is discovered and clicked, the test passes. Fail otherwise.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2722</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2723</span></td>
       <td><span class="comment code">   * @param $label
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2724</span></td>
       <td><span class="comment code">   *   Text between the anchor tags.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2725</span></td>
       <td><span class="comment code">   * @param $index
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2726</span></td>
       <td><span class="comment code">   *   Link position counting from zero.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2727</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2728</span></td>
       <td><span class="comment code">   *   Page contents on success, or FALSE on failure.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2729</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2730</span></td>
       <td><span class="comment code">  protected function clickLink($label, $index = 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2731</span></td>
       <td><span class="covered code">    $url_before = $this-&gt;getUrl();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2732</span></td>
       <td><span class="covered code">    $urls = $this-&gt;xpath('//a[normalize-space(text())=:label]', array(':label' =&gt; $label));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2733</span></td>
       <td><span class="covered code">    if (isset($urls[$index])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2734</span></td>
       <td><span class="covered code">      $url_target = $this-&gt;getAbsoluteUrl($urls[$index]['href']);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2735</span></td>
       <td><span class="covered code">      $this-&gt;pass(t('Clicked link %label (@url_target) from @url_before', array('%label' =&gt; $label, '@url_target' =&gt; $url_target, '@url_before' =&gt; $url_before)), 'Browser');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2736</span></td>
       <td><span class="covered code">      return $this-&gt;drupalGet($url_target);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2737</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2738</span></td>
       <td><span class="missed code">    $this-&gt;fail(t('Link %label does not exist on @url_before', array('%label' =&gt; $label, '@url_before' =&gt; $url_before)), 'Browser');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2739</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2740</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2741</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2742</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2743</span></td>
       <td><span class="comment code">   * Takes a path and returns an absolute path.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2744</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2745</span></td>
       <td><span class="comment code">   * @param $path
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2746</span></td>
       <td><span class="comment code">   *   A path from the internal browser content.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2747</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2748</span></td>
       <td><span class="comment code">   *   The $path with $base_url prepended, if necessary.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2749</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2750</span></td>
       <td><span class="comment code">  protected function getAbsoluteUrl($path) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2751</span></td>
       <td><span class="covered code">    global $base_url, $base_path;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2752</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2753</span></td>
       <td><span class="covered code">    $parts = parse_url($path);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2754</span></td>
       <td><span class="covered code">    if (empty($parts['host'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2755</span></td>
       <td><span class="comment code">      // Ensure that we have a string (and no xpath object).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2756</span></td>
       <td><span class="covered code">      $path = (string) $path;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2757</span></td>
       <td><span class="comment code">      // Strip $base_path, if existent.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2758</span></td>
       <td><span class="covered code">      $length = strlen($base_path);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2759</span></td>
       <td><span class="covered code">      if (substr($path, 0, $length) === $base_path) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2760</span></td>
       <td><span class="covered code">        $path = substr($path, $length);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2761</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2762</span></td>
       <td><span class="comment code">      // Ensure that we have an absolute path.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2763</span></td>
       <td><span class="covered code">      if ($path[0] !== '/') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2764</span></td>
       <td><span class="covered code">        $path = '/' . $path;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2765</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2766</span></td>
       <td><span class="comment code">      // Finally, prepend the $base_url.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2767</span></td>
       <td><span class="covered code">      $path = $base_url . $path;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2768</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2769</span></td>
       <td><span class="covered code">    return $path;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2770</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2771</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2772</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2773</span></td>
       <td><span class="comment code">   * Get the current URL from the cURL handler.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2774</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2775</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2776</span></td>
       <td><span class="comment code">   *   The current URL.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2777</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2778</span></td>
       <td><span class="comment code">  protected function getUrl() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2779</span></td>
       <td><span class="covered code">    return $this-&gt;url;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2780</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2781</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2782</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2783</span></td>
       <td><span class="comment code">   * Gets the HTTP response headers of the requested page. Normally we are only
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2784</span></td>
       <td><span class="comment code">   * interested in the headers returned by the last request. However, if a page
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2785</span></td>
       <td><span class="comment code">   * is redirected or HTTP authentication is in use, multiple requests will be
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2786</span></td>
       <td><span class="comment code">   * required to retrieve the page. Headers from all requests may be requested
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2787</span></td>
       <td><span class="comment code">   * by passing TRUE to this function.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2788</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2789</span></td>
       <td><span class="comment code">   * @param $all_requests
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2790</span></td>
       <td><span class="comment code">   *   Boolean value specifying whether to return headers from all requests
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2791</span></td>
       <td><span class="comment code">   *   instead of just the last request. Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2792</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2793</span></td>
       <td><span class="comment code">   *   A name/value array if headers from only the last request are requested.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2794</span></td>
       <td><span class="comment code">   *   If headers from all requests are requested, an array of name/value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2795</span></td>
       <td><span class="comment code">   *   arrays, one for each request.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2796</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2797</span></td>
       <td><span class="comment code">   *   The pseudonym &quot;:status&quot; is used for the HTTP status line.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2798</span></td>
       <td><span class="covered code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2799</span></td>
       <td><span class="comment code">   *   Values for duplicate headers are stored as a single comma-separated list.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2800</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2801</span></td>
       <td><span class="comment code">  protected function drupalGetHeaders($all_requests = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2802</span></td>
       <td><span class="covered code">    $request = 0;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2803</span></td>
       <td><span class="covered code">    $headers = array($request =&gt; array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2804</span></td>
       <td><span class="covered code">    foreach ($this-&gt;headers as $header) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2805</span></td>
       <td><span class="covered code">      $header = trim($header);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2806</span></td>
       <td><span class="covered code">      if ($header === '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2807</span></td>
       <td><span class="covered code">        $request++;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2808</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2809</span></td>
       <td><span class="comment code">      else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2810</span></td>
       <td><span class="covered code">        if (strpos($header, 'HTTP/') === 0) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2811</span></td>
       <td><span class="covered code">          $name = ':status';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2812</span></td>
       <td><span class="covered code">          $value = $header;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2813</span></td>
       <td><span class="covered code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2814</span></td>
       <td><span class="comment code">        else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2815</span></td>
       <td><span class="covered code">          list($name, $value) = explode(':', $header, 2);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2816</span></td>
       <td><span class="covered code">          $name = strtolower($name);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2817</span></td>
       <td><span class="comment code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2818</span></td>
       <td><span class="covered code">        if (isset($headers[$request][$name])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2819</span></td>
       <td><span class="missed code">          $headers[$request][$name] .= ',' . trim($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2820</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2821</span></td>
       <td><span class="comment code">        else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2822</span></td>
       <td><span class="covered code">          $headers[$request][$name] = trim($value);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2823</span></td>
       <td><span class="comment code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2824</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2825</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2826</span></td>
       <td><span class="covered code">    if (!$all_requests) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2827</span></td>
       <td><span class="covered code">      $headers = array_pop($headers);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2828</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2829</span></td>
       <td><span class="covered code">    return $headers;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2830</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2831</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2832</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2833</span></td>
       <td><span class="comment code">   * Gets the value of an HTTP response header. If multiple requests were
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2834</span></td>
       <td><span class="comment code">   * required to retrieve the page, only the headers from the last request will
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2835</span></td>
       <td><span class="comment code">   * be checked by default. However, if TRUE is passed as the second argument,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2836</span></td>
       <td><span class="comment code">   * all requests will be processed from last to first until the header is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2837</span></td>
       <td><span class="comment code">   * found.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2838</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2839</span></td>
       <td><span class="comment code">   * @param $name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2840</span></td>
       <td><span class="comment code">   *   The name of the header to retrieve. Names are case-insensitive (see RFC
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2841</span></td>
       <td><span class="comment code">   *   2616 section 4.2).
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2842</span></td>
       <td><span class="comment code">   * @param $all_requests
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2843</span></td>
       <td><span class="comment code">   *   Boolean value specifying whether to check all requests if the header is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2844</span></td>
       <td><span class="comment code">   *   not found in the last request. Defaults to FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2845</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2846</span></td>
       <td><span class="comment code">   *   The HTTP header value or FALSE if not found.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2847</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2848</span></td>
       <td><span class="comment code">  protected function drupalGetHeader($name, $all_requests = FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2849</span></td>
       <td><span class="covered code">    $name = strtolower($name);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2850</span></td>
       <td><span class="covered code">    $header = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2851</span></td>
       <td><span class="covered code">    if ($all_requests) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2852</span></td>
       <td><span class="missed code">      foreach (array_reverse($this-&gt;drupalGetHeaders(TRUE)) as $headers) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2853</span></td>
       <td><span class="missed code">        if (isset($headers[$name])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2854</span></td>
       <td><span class="missed code">          $header = $headers[$name];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2855</span></td>
       <td><span class="missed code">          break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2856</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2857</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2858</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2859</span></td>
       <td><span class="comment code">    else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2860</span></td>
       <td><span class="covered code">      $headers = $this-&gt;drupalGetHeaders();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2861</span></td>
       <td><span class="covered code">      if (isset($headers[$name])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2862</span></td>
       <td><span class="covered code">        $header = $headers[$name];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2863</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2864</span></td>
       <td><span class="comment code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2865</span></td>
       <td><span class="covered code">    return $header;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2866</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2867</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2868</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2869</span></td>
       <td><span class="comment code">   * Gets the current raw HTML of requested page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2870</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2871</span></td>
       <td><span class="comment code">  protected function drupalGetContent() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2872</span></td>
       <td><span class="covered code">    return $this-&gt;content;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2873</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2874</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2875</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2876</span></td>
       <td><span class="comment code">   * Gets the value of the Drupal.settings JavaScript variable for the currently loaded page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2877</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2878</span></td>
       <td><span class="comment code">  protected function drupalGetSettings() {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2879</span></td>
       <td><span class="missed code">    return $this-&gt;drupalSettings;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2880</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2881</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2882</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2883</span></td>
       <td><span class="comment code">   * Gets an array containing all e-mails sent during this test case.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2884</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2885</span></td>
       <td><span class="comment code">   * @param $filter
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2886</span></td>
       <td><span class="comment code">   *   An array containing key/value pairs used to filter the e-mails that are returned.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2887</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2888</span></td>
       <td><span class="comment code">   *   An array containing e-mail messages captured during the current test.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2889</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2890</span></td>
       <td><span class="comment code">  protected function drupalGetMails($filter = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2891</span></td>
       <td><span class="missed code">    $captured_emails = variable_get('drupal_test_email_collector', array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2892</span></td>
       <td><span class="missed code">    $filtered_emails = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2893</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2894</span></td>
       <td><span class="missed code">    foreach ($captured_emails as $message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2895</span></td>
       <td><span class="missed code">      foreach ($filter as $key =&gt; $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2896</span></td>
       <td><span class="missed code">        if (!isset($message[$key]) || $message[$key] != $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2897</span></td>
       <td><span class="missed code">          continue 2;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2898</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2899</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2900</span></td>
       <td><span class="missed code">      $filtered_emails[] = $message;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2901</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2902</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2903</span></td>
       <td><span class="missed code">    return $filtered_emails;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2904</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2905</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2906</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2907</span></td>
       <td><span class="comment code">   * Sets the raw HTML content. This can be useful when a page has been fetched
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2908</span></td>
       <td><span class="comment code">   * outside of the internal browser and assertions need to be made on the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2909</span></td>
       <td><span class="comment code">   * returned page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2910</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2911</span></td>
       <td><span class="comment code">   * A good example would be when testing drupal_http_request(). After fetching
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2912</span></td>
       <td><span class="comment code">   * the page the content can be set and page elements can be checked to ensure
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2913</span></td>
       <td><span class="comment code">   * that the function worked properly.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2914</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2915</span></td>
       <td><span class="comment code">  protected function drupalSetContent($content, $url = 'internal:') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2916</span></td>
       <td><span class="covered code">    $this-&gt;content = $content;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2917</span></td>
       <td><span class="covered code">    $this-&gt;url = $url;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2918</span></td>
       <td><span class="covered code">    $this-&gt;plainTextContent = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2919</span></td>
       <td><span class="covered code">    $this-&gt;elements = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2920</span></td>
       <td><span class="covered code">    $this-&gt;drupalSettings = array();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2921</span></td>
       <td><span class="covered code">    if (preg_match('/jQuery\.extend\(Drupal\.settings, (.*?)\);/', $content, $matches)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2922</span></td>
       <td><span class="covered code">      $this-&gt;drupalSettings = drupal_json_decode($matches[1]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2923</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2924</span></td>
       <td><span class="covered code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2925</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2926</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2927</span></td>
       <td><span class="comment code">   * Sets the value of the Drupal.settings JavaScript variable for the currently loaded page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2928</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2929</span></td>
       <td><span class="comment code">  protected function drupalSetSettings($settings) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2930</span></td>
       <td><span class="missed code">    $this-&gt;drupalSettings = $settings;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2931</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2932</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2933</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2934</span></td>
       <td><span class="comment code">   * Pass if the internal browser's URL matches the given path.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2935</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2936</span></td>
       <td><span class="comment code">   * @param $path
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2937</span></td>
       <td><span class="comment code">   *   The expected system path.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2938</span></td>
       <td><span class="comment code">   * @param $options
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2939</span></td>
       <td><span class="comment code">   *   (optional) Any additional options to pass for $path to url().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2940</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2941</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2942</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2943</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2944</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2945</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2946</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2947</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2948</span></td>
       <td><span class="comment code">  protected function assertUrl($path, array $options = array(), $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2949</span></td>
       <td><span class="missed code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2950</span></td>
       <td><span class="missed code">      $message = t('Current URL is @url.', array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2951</span></td>
       <td><span class="missed code">        '@url' =&gt; var_export(url($path, $options), TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2952</span></td>
       <td><span class="missed code">      ));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2953</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2954</span></td>
       <td><span class="missed code">    $options['absolute'] = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2955</span></td>
       <td><span class="missed code">    return $this-&gt;assertEqual($this-&gt;getUrl(), url($path, $options), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2956</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2957</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2958</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2959</span></td>
       <td><span class="comment code">   * Pass if the raw text IS found on the loaded page, fail otherwise. Raw text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2960</span></td>
       <td><span class="comment code">   * refers to the raw HTML that the page generated.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2961</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2962</span></td>
       <td><span class="comment code">   * @param $raw
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2963</span></td>
       <td><span class="comment code">   *   Raw (HTML) string to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2964</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2965</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2966</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2967</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2968</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2969</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2970</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2971</span></td>
       <td><span class="comment code">  protected function assertRaw($raw, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2972</span></td>
       <td><span class="covered code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2973</span></td>
       <td><span class="missed code">      $message = t('Raw &quot;@raw&quot; found', array('@raw' =&gt; $raw));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2974</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2975</span></td>
       <td><span class="covered code">    return $this-&gt;assert(strpos($this-&gt;drupalGetContent(), $raw) !== FALSE, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2976</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2977</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2978</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2979</span></td>
       <td><span class="comment code">   * Pass if the raw text is NOT found on the loaded page, fail otherwise. Raw text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2980</span></td>
       <td><span class="comment code">   * refers to the raw HTML that the page generated.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2981</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2982</span></td>
       <td><span class="comment code">   * @param $raw
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2983</span></td>
       <td><span class="comment code">   *   Raw (HTML) string to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2984</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2985</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2986</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2987</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2988</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2989</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2990</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2991</span></td>
       <td><span class="comment code">  protected function assertNoRaw($raw, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2992</span></td>
       <td><span class="covered code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2993</span></td>
       <td><span class="missed code">      $message = t('Raw &quot;@raw&quot; not found', array('@raw' =&gt; $raw));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2994</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2995</span></td>
       <td><span class="covered code">    return $this-&gt;assert(strpos($this-&gt;drupalGetContent(), $raw) === FALSE, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2996</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2997</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2998</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">2999</span></td>
       <td><span class="comment code">   * Pass if the text IS found on the text version of the page. The text version
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3000</span></td>
       <td><span class="comment code">   * is the equivalent of what a user would see when viewing through a web browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3001</span></td>
       <td><span class="comment code">   * In other words the HTML has been filtered out of the contents.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3002</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3003</span></td>
       <td><span class="comment code">   * @param $text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3004</span></td>
       <td><span class="comment code">   *   Plain text to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3005</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3006</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3007</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3008</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3009</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3010</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3011</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3012</span></td>
       <td><span class="comment code">  protected function assertText($text, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3013</span></td>
       <td><span class="covered code">    return $this-&gt;assertTextHelper($text, $message, $group, FALSE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3014</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3015</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3016</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3017</span></td>
       <td><span class="comment code">   * Pass if the text is NOT found on the text version of the page. The text version
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3018</span></td>
       <td><span class="comment code">   * is the equivalent of what a user would see when viewing through a web browser.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3019</span></td>
       <td><span class="comment code">   * In other words the HTML has been filtered out of the contents.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3020</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3021</span></td>
       <td><span class="comment code">   * @param $text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3022</span></td>
       <td><span class="comment code">   *   Plain text to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3023</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3024</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3025</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3026</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3027</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3028</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3029</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3030</span></td>
       <td><span class="comment code">  protected function assertNoText($text, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3031</span></td>
       <td><span class="missed code">    return $this-&gt;assertTextHelper($text, $message, $group, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3032</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3033</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3034</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3035</span></td>
       <td><span class="comment code">   * Helper for assertText and assertNoText.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3036</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3037</span></td>
       <td><span class="comment code">   * It is not recommended to call this function directly.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3038</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3039</span></td>
       <td><span class="comment code">   * @param $text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3040</span></td>
       <td><span class="comment code">   *   Plain text to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3041</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3042</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3043</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3044</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3045</span></td>
       <td><span class="comment code">   * @param $not_exists
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3046</span></td>
       <td><span class="comment code">   *   TRUE if this text should not exist, FALSE if it should.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3047</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3048</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3049</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3050</span></td>
       <td><span class="comment code">  protected function assertTextHelper($text, $message = '', $group, $not_exists) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3051</span></td>
       <td><span class="covered code">    if ($this-&gt;plainTextContent === FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3052</span></td>
       <td><span class="covered code">      $this-&gt;plainTextContent = filter_xss($this-&gt;drupalGetContent(), array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3053</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3054</span></td>
       <td><span class="covered code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3055</span></td>
       <td><span class="missed code">      $message = !$not_exists ? t('&quot;@text&quot; found', array('@text' =&gt; $text)) : t('&quot;@text&quot; not found', array('@text' =&gt; $text));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3056</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3057</span></td>
       <td><span class="covered code">    return $this-&gt;assert($not_exists == (strpos($this-&gt;plainTextContent, $text) === FALSE), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3058</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3059</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3060</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3061</span></td>
       <td><span class="comment code">   * Pass if the text is found ONLY ONCE on the text version of the page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3062</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3063</span></td>
       <td><span class="comment code">   * The text version is the equivalent of what a user would see when viewing
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3064</span></td>
       <td><span class="comment code">   * through a web browser. In other words the HTML has been filtered out of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3065</span></td>
       <td><span class="comment code">   * the contents.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3066</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3067</span></td>
       <td><span class="comment code">   * @param $text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3068</span></td>
       <td><span class="comment code">   *   Plain text to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3069</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3070</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3071</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3072</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3073</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3074</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3075</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3076</span></td>
       <td><span class="comment code">  protected function assertUniqueText($text, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3077</span></td>
       <td><span class="missed code">    return $this-&gt;assertUniqueTextHelper($text, $message, $group, TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3078</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3079</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3080</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3081</span></td>
       <td><span class="comment code">   * Pass if the text is found MORE THAN ONCE on the text version of the page.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3082</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3083</span></td>
       <td><span class="comment code">   * The text version is the equivalent of what a user would see when viewing
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3084</span></td>
       <td><span class="comment code">   * through a web browser. In other words the HTML has been filtered out of
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3085</span></td>
       <td><span class="comment code">   * the contents.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3086</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3087</span></td>
       <td><span class="comment code">   * @param $text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3088</span></td>
       <td><span class="comment code">   *   Plain text to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3089</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3090</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3091</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3092</span></td>
       <td><span class="comment code">   *   The group this message belongs to, defaults to 'Other'.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3093</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3094</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3095</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3096</span></td>
       <td><span class="comment code">  protected function assertNoUniqueText($text, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3097</span></td>
       <td><span class="missed code">    return $this-&gt;assertUniqueTextHelper($text, $message, $group, FALSE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3098</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3099</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3100</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3101</span></td>
       <td><span class="comment code">   * Helper for assertUniqueText and assertNoUniqueText.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3102</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3103</span></td>
       <td><span class="comment code">   * It is not recommended to call this function directly.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3104</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3105</span></td>
       <td><span class="comment code">   * @param $text
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3106</span></td>
       <td><span class="comment code">   *   Plain text to look for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3107</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3108</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3109</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3110</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3111</span></td>
       <td><span class="comment code">   * @param $be_unique
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3112</span></td>
       <td><span class="comment code">   *   TRUE if this text should be found only once, FALSE if it should be found more than once.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3113</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3114</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3115</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3116</span></td>
       <td><span class="comment code">  protected function assertUniqueTextHelper($text, $message = '', $group, $be_unique) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3117</span></td>
       <td><span class="missed code">    if ($this-&gt;plainTextContent === FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3118</span></td>
       <td><span class="missed code">      $this-&gt;plainTextContent = filter_xss($this-&gt;drupalGetContent(), array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3119</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3120</span></td>
       <td><span class="missed code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3121</span></td>
       <td><span class="missed code">      $message = '&quot;' . $text . '&quot;' . ($be_unique ? ' found only once' : ' found more than once');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3122</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3123</span></td>
       <td><span class="missed code">    $first_occurance = strpos($this-&gt;plainTextContent, $text);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3124</span></td>
       <td><span class="missed code">    if ($first_occurance === FALSE) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3125</span></td>
       <td><span class="missed code">      return $this-&gt;assert(FALSE, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3126</span></td>
       <td><span class="dead code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3127</span></td>
       <td><span class="missed code">    $offset = $first_occurance + strlen($text);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3128</span></td>
       <td><span class="missed code">    $second_occurance = strpos($this-&gt;plainTextContent, $text, $offset);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3129</span></td>
       <td><span class="missed code">    return $this-&gt;assert($be_unique == ($second_occurance === FALSE), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3130</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3131</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3132</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3133</span></td>
       <td><span class="comment code">   * Will trigger a pass if the Perl regex pattern is found in the raw content.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3134</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3135</span></td>
       <td><span class="comment code">   * @param $pattern
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3136</span></td>
       <td><span class="comment code">   *   Perl regex to look for including the regex delimiters.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3137</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3138</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3139</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3140</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3141</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3142</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3143</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3144</span></td>
       <td><span class="comment code">  protected function assertPattern($pattern, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3145</span></td>
       <td><span class="missed code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3146</span></td>
       <td><span class="missed code">      $message = t('Pattern &quot;@pattern&quot; found', array('@pattern' =&gt; $pattern));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3147</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3148</span></td>
       <td><span class="missed code">    return $this-&gt;assert((bool) preg_match($pattern, $this-&gt;drupalGetContent()), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3149</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3150</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3151</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3152</span></td>
       <td><span class="comment code">   * Will trigger a pass if the perl regex pattern is not present in raw content.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3153</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3154</span></td>
       <td><span class="comment code">   * @param $pattern
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3155</span></td>
       <td><span class="comment code">   *   Perl regex to look for including the regex delimiters.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3156</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3157</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3158</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3159</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3160</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3161</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3162</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3163</span></td>
       <td><span class="comment code">  protected function assertNoPattern($pattern, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3164</span></td>
       <td><span class="missed code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3165</span></td>
       <td><span class="missed code">      $message = t('Pattern &quot;@pattern&quot; not found', array('@pattern' =&gt; $pattern));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3166</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3167</span></td>
       <td><span class="missed code">    return $this-&gt;assert(!preg_match($pattern, $this-&gt;drupalGetContent()), $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3168</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3169</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3170</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3171</span></td>
       <td><span class="comment code">   * Pass if the page title is the given string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3172</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3173</span></td>
       <td><span class="comment code">   * @param $title
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3174</span></td>
       <td><span class="comment code">   *   The string the title should be.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3175</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3176</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3177</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3178</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3179</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3180</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3181</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3182</span></td>
       <td><span class="comment code">  protected function assertTitle($title, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3183</span></td>
       <td><span class="missed code">    $actual = (string) current($this-&gt;xpath('//title'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3184</span></td>
       <td><span class="missed code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3185</span></td>
       <td><span class="missed code">      $message = t('Page title @actual is equal to @expected.', array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3186</span></td>
       <td><span class="missed code">        '@actual' =&gt; var_export($actual, TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3187</span></td>
       <td><span class="missed code">        '@expected' =&gt; var_export($title, TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3188</span></td>
       <td><span class="missed code">      ));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3189</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3190</span></td>
       <td><span class="missed code">    return $this-&gt;assertEqual($actual, $title, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3191</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3192</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3193</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3194</span></td>
       <td><span class="comment code">   * Pass if the page title is not the given string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3195</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3196</span></td>
       <td><span class="comment code">   * @param $title
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3197</span></td>
       <td><span class="comment code">   *   The string the title should not be.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3198</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3199</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3200</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3201</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3202</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3203</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3204</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3205</span></td>
       <td><span class="comment code">  protected function assertNoTitle($title, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3206</span></td>
       <td><span class="missed code">    $actual = (string) current($this-&gt;xpath('//title'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3207</span></td>
       <td><span class="missed code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3208</span></td>
       <td><span class="missed code">      $message = t('Page title @actual is not equal to @unexpected.', array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3209</span></td>
       <td><span class="missed code">        '@actual' =&gt; var_export($actual, TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3210</span></td>
       <td><span class="missed code">        '@unexpected' =&gt; var_export($title, TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3211</span></td>
       <td><span class="missed code">      ));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3212</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3213</span></td>
       <td><span class="missed code">    return $this-&gt;assertNotEqual($actual, $title, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3214</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3215</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3216</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3217</span></td>
       <td><span class="comment code">   * Asserts themed output.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3218</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3219</span></td>
       <td><span class="comment code">   * @param $callback
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3220</span></td>
       <td><span class="comment code">   *   The name of the theme function to invoke; e.g. 'links' for theme_links().
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3221</span></td>
       <td><span class="comment code">   * @param $variables
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3222</span></td>
       <td><span class="comment code">   *   (optional) An array of variables to pass to the theme function.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3223</span></td>
       <td><span class="comment code">   * @param $expected
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3224</span></td>
       <td><span class="comment code">   *   The expected themed output string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3225</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3226</span></td>
       <td><span class="comment code">   *   (optional) A message to display with the assertion. Do not translate
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3227</span></td>
       <td><span class="comment code">   *   messages: use format_string() to embed variables in the message text, not
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3228</span></td>
       <td><span class="comment code">   *   t(). If left blank, a default message will be displayed.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3229</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3230</span></td>
       <td><span class="comment code">   *   (optional) The group this message is in, which is displayed in a column
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3231</span></td>
       <td><span class="comment code">   *   in test output. Use 'Debug' to indicate this is debugging output. Do not
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3232</span></td>
       <td><span class="comment code">   *   translate this string. Defaults to 'Other'; most tests do not override
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3233</span></td>
       <td><span class="comment code">   *   this default.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3234</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3235</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3236</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3237</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3238</span></td>
       <td><span class="comment code">  protected function assertThemeOutput($callback, array $variables = array(), $expected, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3239</span></td>
       <td><span class="missed code">    $output = theme($callback, $variables);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3240</span></td>
       <td><span class="missed code">    $this-&gt;verbose('Variables:' . '&lt;pre&gt;' .  check_plain(var_export($variables, TRUE)) . '&lt;/pre&gt;'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3241</span></td>
       <td><span class="missed code">      . '&lt;hr /&gt;' . 'Result:' . '&lt;pre&gt;' .  check_plain(var_export($output, TRUE)) . '&lt;/pre&gt;'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3242</span></td>
       <td><span class="missed code">      . '&lt;hr /&gt;' . 'Expected:' . '&lt;pre&gt;' .  check_plain(var_export($expected, TRUE)) . '&lt;/pre&gt;'
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3243</span></td>
       <td><span class="missed code">      . '&lt;hr /&gt;' . $output
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3244</span></td>
       <td><span class="missed code">    );
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3245</span></td>
       <td><span class="missed code">    if (!$message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3246</span></td>
       <td><span class="missed code">      $message = '%callback rendered correctly.';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3247</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3248</span></td>
       <td><span class="missed code">    $message = format_string($message, array('%callback' =&gt; 'theme_' . $callback . '()'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3249</span></td>
       <td><span class="missed code">    return $this-&gt;assertIdentical($output, $expected, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3250</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3251</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3252</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3253</span></td>
       <td><span class="comment code">   * Asserts that a field exists in the current page by the given XPath.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3254</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3255</span></td>
       <td><span class="comment code">   * @param $xpath
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3256</span></td>
       <td><span class="comment code">   *   XPath used to find the field.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3257</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3258</span></td>
       <td><span class="comment code">   *   (optional) Value of the field to assert. You may pass in NULL (default)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3259</span></td>
       <td><span class="comment code">   *   to skip checking the actual value, while still checking that the field
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3260</span></td>
       <td><span class="comment code">   *   exists.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3261</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3262</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3263</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3264</span></td>
       <td><span class="comment code">   *   (optional) The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3265</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3266</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3267</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3268</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3269</span></td>
       <td><span class="comment code">  protected function assertFieldByXPath($xpath, $value = NULL, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3270</span></td>
       <td><span class="covered code">    $fields = $this-&gt;xpath($xpath);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3271</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3272</span></td>
       <td><span class="comment code">    // If value specified then check array for match.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3273</span></td>
       <td><span class="covered code">    $found = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3274</span></td>
       <td><span class="covered code">    if (isset($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3275</span></td>
       <td><span class="covered code">      $found = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3276</span></td>
       <td><span class="covered code">      if ($fields) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3277</span></td>
       <td><span class="covered code">        foreach ($fields as $field) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3278</span></td>
       <td><span class="covered code">          if (isset($field['value']) &amp;&amp; $field['value'] == $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3279</span></td>
       <td><span class="comment code">            // Input element with correct value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3280</span></td>
       <td><span class="covered code">            $found = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3281</span></td>
       <td><span class="covered code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3282</span></td>
       <td><span class="missed code">          elseif (isset($field-&gt;option)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3283</span></td>
       <td><span class="comment code">            // Select element found.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3284</span></td>
       <td><span class="missed code">            if ($this-&gt;getSelectedItem($field) == $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3285</span></td>
       <td><span class="missed code">              $found = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3286</span></td>
       <td><span class="missed code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3287</span></td>
       <td><span class="comment code">            else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3288</span></td>
       <td><span class="comment code">              // No item selected so use first item.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3289</span></td>
       <td><span class="missed code">              $items = $this-&gt;getAllOptions($field);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3290</span></td>
       <td><span class="missed code">              if (!empty($items) &amp;&amp; $items[0]['value'] == $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3291</span></td>
       <td><span class="missed code">                $found = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3292</span></td>
       <td><span class="missed code">              }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3293</span></td>
       <td><span class="comment code">            }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3294</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3295</span></td>
       <td><span class="missed code">          elseif ((string) $field == $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3296</span></td>
       <td><span class="comment code">            // Text area with correct text.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3297</span></td>
       <td><span class="missed code">            $found = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3298</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3299</span></td>
       <td><span class="covered code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3300</span></td>
       <td><span class="covered code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3301</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3302</span></td>
       <td><span class="covered code">    return $this-&gt;assertTrue($fields &amp;&amp; $found, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3303</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3304</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3305</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3306</span></td>
       <td><span class="comment code">   * Get the selected value from a select field.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3307</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3308</span></td>
       <td><span class="comment code">   * @param $element
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3309</span></td>
       <td><span class="comment code">   *   SimpleXMLElement select element.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3310</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3311</span></td>
       <td><span class="comment code">   *   The selected value or FALSE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3312</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3313</span></td>
       <td><span class="comment code">  protected function getSelectedItem(SimpleXMLElement $element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3314</span></td>
       <td><span class="missed code">    foreach ($element-&gt;children() as $item) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3315</span></td>
       <td><span class="missed code">      if (isset($item['selected'])) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3316</span></td>
       <td><span class="missed code">        return $item['value'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3317</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3318</span></td>
       <td><span class="missed code">      elseif ($item-&gt;getName() == 'optgroup') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3319</span></td>
       <td><span class="missed code">        if ($value = $this-&gt;getSelectedItem($item)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3320</span></td>
       <td><span class="missed code">          return $value;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3321</span></td>
       <td><span class="dead code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3322</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3323</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3324</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3325</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3326</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3327</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3328</span></td>
       <td><span class="comment code">   * Asserts that a field doesn't exist or its value doesn't match, by XPath.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3329</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3330</span></td>
       <td><span class="comment code">   * @param $xpath
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3331</span></td>
       <td><span class="comment code">   *   XPath used to find the field.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3332</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3333</span></td>
       <td><span class="comment code">   *   (optional) Value for the field, to assert that the field's value on the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3334</span></td>
       <td><span class="comment code">   *   page doesn't match it. You may pass in NULL to skip checking the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3335</span></td>
       <td><span class="comment code">   *   value, while still checking that the field doesn't exist.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3336</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3337</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3338</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3339</span></td>
       <td><span class="comment code">   *   (optional) The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3340</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3341</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3342</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3343</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3344</span></td>
       <td><span class="comment code">  protected function assertNoFieldByXPath($xpath, $value = NULL, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3345</span></td>
       <td><span class="covered code">    $fields = $this-&gt;xpath($xpath);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3346</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3347</span></td>
       <td><span class="comment code">    // If value specified then check array for match.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3348</span></td>
       <td><span class="covered code">    $found = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3349</span></td>
       <td><span class="covered code">    if (isset($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3350</span></td>
       <td><span class="covered code">      $found = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3351</span></td>
       <td><span class="covered code">      if ($fields) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3352</span></td>
       <td><span class="missed code">        foreach ($fields as $field) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3353</span></td>
       <td><span class="missed code">          if ($field['value'] == $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3354</span></td>
       <td><span class="missed code">            $found = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3355</span></td>
       <td><span class="missed code">          }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3356</span></td>
       <td><span class="missed code">        }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3357</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3358</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3359</span></td>
       <td><span class="covered code">    return $this-&gt;assertFalse($fields &amp;&amp; $found, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3360</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3361</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3362</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3363</span></td>
       <td><span class="comment code">   * Asserts that a field exists in the current page with the given name and value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3364</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3365</span></td>
       <td><span class="comment code">   * @param $name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3366</span></td>
       <td><span class="comment code">   *   Name of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3367</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3368</span></td>
       <td><span class="comment code">   *   (optional) Value of the field to assert. You may pass in NULL (default)
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3369</span></td>
       <td><span class="comment code">   *   to skip checking the actual value, while still checking that the field
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3370</span></td>
       <td><span class="comment code">   *   exists.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3371</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3372</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3373</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3374</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3375</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3376</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3377</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3378</span></td>
       <td><span class="comment code">  protected function assertFieldByName($name, $value = NULL, $message = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3379</span></td>
       <td><span class="covered code">    if (!isset($message)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3380</span></td>
       <td><span class="missed code">      if (!isset($value)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3381</span></td>
       <td><span class="missed code">        $message = t('Found field with name @name', array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3382</span></td>
       <td><span class="missed code">          '@name' =&gt; var_export($name, TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3383</span></td>
       <td><span class="missed code">        ));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3384</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3385</span></td>
       <td><span class="comment code">      else {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3386</span></td>
       <td><span class="missed code">        $message = t('Found field with name @name and value @value', array(
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3387</span></td>
       <td><span class="missed code">          '@name' =&gt; var_export($name, TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3388</span></td>
       <td><span class="missed code">          '@value' =&gt; var_export($value, TRUE),
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3389</span></td>
       <td><span class="missed code">        ));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3390</span></td>
       <td><span class="comment code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3391</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3392</span></td>
       <td><span class="covered code">    return $this-&gt;assertFieldByXPath($this-&gt;constructFieldXpath('name', $name), $value, $message, t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3393</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3394</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3395</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3396</span></td>
       <td><span class="comment code">   * Asserts that a field does not exist with the given name and value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3397</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3398</span></td>
       <td><span class="comment code">   * @param $name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3399</span></td>
       <td><span class="comment code">   *   Name of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3400</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3401</span></td>
       <td><span class="comment code">   *   (optional) Value for the field, to assert that the field's value on the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3402</span></td>
       <td><span class="comment code">   *   page doesn't match it. You may pass in NULL to skip checking the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3403</span></td>
       <td><span class="comment code">   *   value, while still checking that the field doesn't exist. However, the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3404</span></td>
       <td><span class="comment code">   *   default value ('') asserts that the field value is not an empty string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3405</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3406</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3407</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3408</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3409</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3410</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3411</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3412</span></td>
       <td><span class="comment code">  protected function assertNoFieldByName($name, $value = '', $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3413</span></td>
       <td><span class="covered code">    return $this-&gt;assertNoFieldByXPath($this-&gt;constructFieldXpath('name', $name), $value, $message ? $message : t('Did not find field by name @name', array('@name' =&gt; $name)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3414</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3415</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3416</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3417</span></td>
       <td><span class="comment code">   * Asserts that a field exists in the current page with the given ID and value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3418</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3419</span></td>
       <td><span class="comment code">   * @param $id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3420</span></td>
       <td><span class="comment code">   *   ID of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3421</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3422</span></td>
       <td><span class="comment code">   *   (optional) Value for the field to assert. You may pass in NULL to skip
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3423</span></td>
       <td><span class="comment code">   *   checking the value, while still checking that the field exists.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3424</span></td>
       <td><span class="comment code">   *   However, the default value ('') asserts that the field value is an empty
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3425</span></td>
       <td><span class="comment code">   *   string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3426</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3427</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3428</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3429</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3430</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3431</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3432</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3433</span></td>
       <td><span class="comment code">  protected function assertFieldById($id, $value = '', $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3434</span></td>
       <td><span class="missed code">    return $this-&gt;assertFieldByXPath($this-&gt;constructFieldXpath('id', $id), $value, $message ? $message : t('Found field by id @id', array('@id' =&gt; $id)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3435</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3436</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3437</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3438</span></td>
       <td><span class="comment code">   * Asserts that a field does not exist with the given ID and value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3439</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3440</span></td>
       <td><span class="comment code">   * @param $id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3441</span></td>
       <td><span class="comment code">   *   ID of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3442</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3443</span></td>
       <td><span class="comment code">   *   (optional) Value for the field, to assert that the field's value on the
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3444</span></td>
       <td><span class="comment code">   *   page doesn't match it. You may pass in NULL to skip checking the value,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3445</span></td>
       <td><span class="comment code">   *   while still checking that the field doesn't exist. However, the default
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3446</span></td>
       <td><span class="comment code">   *   value ('') asserts that the field value is not an empty string.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3447</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3448</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3449</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3450</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3451</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3452</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3453</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3454</span></td>
       <td><span class="comment code">  protected function assertNoFieldById($id, $value = '', $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3455</span></td>
       <td><span class="missed code">    return $this-&gt;assertNoFieldByXPath($this-&gt;constructFieldXpath('id', $id), $value, $message ? $message : t('Did not find field by id @id', array('@id' =&gt; $id)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3456</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3457</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3458</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3459</span></td>
       <td><span class="comment code">   * Asserts that a checkbox field in the current page is checked.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3460</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3461</span></td>
       <td><span class="comment code">   * @param $id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3462</span></td>
       <td><span class="comment code">   *   ID of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3463</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3464</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3465</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3466</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3467</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3468</span></td>
       <td><span class="comment code">  protected function assertFieldChecked($id, $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3469</span></td>
       <td><span class="missed code">    $elements = $this-&gt;xpath('//input[@id=:id]', array(':id' =&gt; $id));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3470</span></td>
       <td><span class="missed code">    return $this-&gt;assertTrue(isset($elements[0]) &amp;&amp; !empty($elements[0]['checked']), $message ? $message : t('Checkbox field @id is checked.', array('@id' =&gt; $id)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3471</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3472</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3473</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3474</span></td>
       <td><span class="comment code">   * Asserts that a checkbox field in the current page is not checked.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3475</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3476</span></td>
       <td><span class="comment code">   * @param $id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3477</span></td>
       <td><span class="comment code">   *   ID of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3478</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3479</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3480</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3481</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3482</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3483</span></td>
       <td><span class="comment code">  protected function assertNoFieldChecked($id, $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3484</span></td>
       <td><span class="missed code">    $elements = $this-&gt;xpath('//input[@id=:id]', array(':id' =&gt; $id));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3485</span></td>
       <td><span class="missed code">    return $this-&gt;assertTrue(isset($elements[0]) &amp;&amp; empty($elements[0]['checked']), $message ? $message : t('Checkbox field @id is not checked.', array('@id' =&gt; $id)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3486</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3487</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3488</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3489</span></td>
       <td><span class="comment code">   * Asserts that a select option in the current page is checked.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3490</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3491</span></td>
       <td><span class="comment code">   * @param $id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3492</span></td>
       <td><span class="comment code">   *   ID of select field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3493</span></td>
       <td><span class="comment code">   * @param $option
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3494</span></td>
       <td><span class="comment code">   *   Option to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3495</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3496</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3497</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3498</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3499</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3500</span></td>
       <td><span class="comment code">   * @todo $id is unusable. Replace with $name.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3501</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3502</span></td>
       <td><span class="comment code">  protected function assertOptionSelected($id, $option, $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3503</span></td>
       <td><span class="missed code">    $elements = $this-&gt;xpath('//select[@id=:id]//option[@value=:option]', array(':id' =&gt; $id, ':option' =&gt; $option));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3504</span></td>
       <td><span class="missed code">    return $this-&gt;assertTrue(isset($elements[0]) &amp;&amp; !empty($elements[0]['selected']), $message ? $message : t('Option @option for field @id is selected.', array('@option' =&gt; $option, '@id' =&gt; $id)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3505</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3506</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3507</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3508</span></td>
       <td><span class="comment code">   * Asserts that a select option in the current page is not checked.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3509</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3510</span></td>
       <td><span class="comment code">   * @param $id
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3511</span></td>
       <td><span class="comment code">   *   ID of select field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3512</span></td>
       <td><span class="comment code">   * @param $option
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3513</span></td>
       <td><span class="comment code">   *   Option to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3514</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3515</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3516</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3517</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3518</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3519</span></td>
       <td><span class="comment code">  protected function assertNoOptionSelected($id, $option, $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3520</span></td>
       <td><span class="missed code">    $elements = $this-&gt;xpath('//select[@id=:id]//option[@value=:option]', array(':id' =&gt; $id, ':option' =&gt; $option));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3521</span></td>
       <td><span class="missed code">    return $this-&gt;assertTrue(isset($elements[0]) &amp;&amp; empty($elements[0]['selected']), $message ? $message : t('Option @option for field @id is not selected.', array('@option' =&gt; $option, '@id' =&gt; $id)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3522</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3523</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3524</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3525</span></td>
       <td><span class="comment code">   * Asserts that a field exists with the given name or ID.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3526</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3527</span></td>
       <td><span class="comment code">   * @param $field
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3528</span></td>
       <td><span class="comment code">   *   Name or ID of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3529</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3530</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3531</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3532</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3533</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3534</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3535</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3536</span></td>
       <td><span class="comment code">  protected function assertField($field, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3537</span></td>
       <td><span class="covered code">    return $this-&gt;assertFieldByXPath($this-&gt;constructFieldXpath('name', $field) . '|' . $this-&gt;constructFieldXpath('id', $field), NULL, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3538</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3539</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3540</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3541</span></td>
       <td><span class="comment code">   * Asserts that a field does not exist with the given name or ID.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3542</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3543</span></td>
       <td><span class="comment code">   * @param $field
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3544</span></td>
       <td><span class="comment code">   *   Name or ID of field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3545</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3546</span></td>
       <td><span class="comment code">   *   (optional) Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3547</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3548</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3549</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3550</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3551</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3552</span></td>
       <td><span class="comment code">  protected function assertNoField($field, $message = '', $group = 'Other') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3553</span></td>
       <td><span class="missed code">    return $this-&gt;assertNoFieldByXPath($this-&gt;constructFieldXpath('name', $field) . '|' . $this-&gt;constructFieldXpath('id', $field), NULL, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3554</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3555</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3556</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3557</span></td>
       <td><span class="comment code">   * Asserts that each HTML ID is used for just a single element.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3558</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3559</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3560</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3561</span></td>
       <td><span class="comment code">   * @param $group
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3562</span></td>
       <td><span class="comment code">   *   The group this message belongs to.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3563</span></td>
       <td><span class="comment code">   * @param $ids_to_skip
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3564</span></td>
       <td><span class="comment code">   *   An optional array of ids to skip when checking for duplicates. It is
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3565</span></td>
       <td><span class="comment code">   *   always a bug to have duplicate HTML IDs, so this parameter is to enable
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3566</span></td>
       <td><span class="comment code">   *   incremental fixing of core code. Whenever a test passes this parameter,
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3567</span></td>
       <td><span class="comment code">   *   it should add a &quot;todo&quot; comment above the call to this function explaining
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3568</span></td>
       <td><span class="comment code">   *   the legacy bug that the test wishes to ignore and including a link to an
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3569</span></td>
       <td><span class="comment code">   *   issue that is working to fix that legacy bug.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3570</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3571</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3572</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3573</span></td>
       <td><span class="comment code">  protected function assertNoDuplicateIds($message = '', $group = 'Other', $ids_to_skip = array()) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3574</span></td>
       <td><span class="missed code">    $status = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3575</span></td>
       <td><span class="missed code">    foreach ($this-&gt;xpath('//*[@id]') as $element) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3576</span></td>
       <td><span class="missed code">      $id = (string) $element['id'];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3577</span></td>
       <td><span class="missed code">      if (isset($seen_ids[$id]) &amp;&amp; !in_array($id, $ids_to_skip)) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3578</span></td>
       <td><span class="missed code">        $this-&gt;fail(t('The HTML ID %id is unique.', array('%id' =&gt; $id)), $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3579</span></td>
       <td><span class="missed code">        $status = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3580</span></td>
       <td><span class="missed code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3581</span></td>
       <td><span class="missed code">      $seen_ids[$id] = TRUE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3582</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3583</span></td>
       <td><span class="missed code">    return $this-&gt;assert($status, $message, $group);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3584</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3585</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3586</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3587</span></td>
       <td><span class="comment code">   * Helper function: construct an XPath for the given set of attributes and value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3588</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3589</span></td>
       <td><span class="comment code">   * @param $attribute
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3590</span></td>
       <td><span class="comment code">   *   Field attributes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3591</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3592</span></td>
       <td><span class="comment code">   *   Value of field.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3593</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3594</span></td>
       <td><span class="comment code">   *   XPath for specified values.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3595</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3596</span></td>
       <td><span class="comment code">  protected function constructFieldXpath($attribute, $value) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3597</span></td>
       <td><span class="covered code">    $xpath = '//textarea[@' . $attribute . '=:value]|//input[@' . $attribute . '=:value]|//select[@' . $attribute . '=:value]';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3598</span></td>
       <td><span class="covered code">    return $this-&gt;buildXPathQuery($xpath, array(':value' =&gt; $value));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3599</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3600</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3601</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3602</span></td>
       <td><span class="comment code">   * Asserts the page responds with the specified response code.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3603</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3604</span></td>
       <td><span class="comment code">   * @param $code
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3605</span></td>
       <td><span class="comment code">   *   Response code. For example 200 is a successful page request. For a list
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3606</span></td>
       <td><span class="comment code">   *   of all codes see http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3607</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3608</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3609</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3610</span></td>
       <td><span class="comment code">   *   Assertion result.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3611</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3612</span></td>
       <td><span class="comment code">  protected function assertResponse($code, $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3613</span></td>
       <td><span class="covered code">    $curl_code = curl_getinfo($this-&gt;curlHandle, CURLINFO_HTTP_CODE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3614</span></td>
       <td><span class="covered code">    $match = is_array($code) ? in_array($curl_code, $code) : $curl_code == $code;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3615</span></td>
       <td><span class="covered code">    return $this-&gt;assertTrue($match, $message ? $message : t('HTTP response expected !code, actual !curl_code', array('!code' =&gt; $code, '!curl_code' =&gt; $curl_code)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3616</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3617</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3618</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3619</span></td>
       <td><span class="comment code">   * Asserts the page did not return the specified response code.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3620</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3621</span></td>
       <td><span class="comment code">   * @param $code
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3622</span></td>
       <td><span class="comment code">   *   Response code. For example 200 is a successful page request. For a list
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3623</span></td>
       <td><span class="comment code">   *   of all codes see http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3624</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3625</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3626</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3627</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3628</span></td>
       <td><span class="comment code">   *   Assertion result.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3629</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3630</span></td>
       <td><span class="comment code">  protected function assertNoResponse($code, $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3631</span></td>
       <td><span class="missed code">    $curl_code = curl_getinfo($this-&gt;curlHandle, CURLINFO_HTTP_CODE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3632</span></td>
       <td><span class="missed code">    $match = is_array($code) ? in_array($curl_code, $code) : $curl_code == $code;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3633</span></td>
       <td><span class="missed code">    return $this-&gt;assertFalse($match, $message ? $message : t('HTTP response not expected !code, actual !curl_code', array('!code' =&gt; $code, '!curl_code' =&gt; $curl_code)), t('Browser'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3634</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3635</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3636</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3637</span></td>
       <td><span class="comment code">   * Asserts that the most recently sent e-mail message has the given value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3638</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3639</span></td>
       <td><span class="comment code">   * The field in $name must have the content described in $value.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3640</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3641</span></td>
       <td><span class="comment code">   * @param $name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3642</span></td>
       <td><span class="comment code">   *   Name of field or message property to assert. Examples: subject, body, id, ...
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3643</span></td>
       <td><span class="comment code">   * @param $value
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3644</span></td>
       <td><span class="comment code">   *   Value of the field to assert.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3645</span></td>
       <td><span class="comment code">   * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3646</span></td>
       <td><span class="comment code">   *   Message to display.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3647</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3648</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3649</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3650</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3651</span></td>
       <td><span class="comment code">  protected function assertMail($name, $value = '', $message = '') {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3652</span></td>
       <td><span class="missed code">    $captured_emails = variable_get('drupal_test_email_collector', array());
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3653</span></td>
       <td><span class="missed code">    $email = end($captured_emails);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3654</span></td>
       <td><span class="missed code">    return $this-&gt;assertTrue($email &amp;&amp; isset($email[$name]) &amp;&amp; $email[$name] == $value, $message, t('E-mail'));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3655</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3656</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3657</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3658</span></td>
       <td><span class="comment code">   * Asserts that the most recently sent e-mail message has the string in it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3659</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3660</span></td>
       <td><span class="comment code">   * @param $field_name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3661</span></td>
       <td><span class="comment code">   *   Name of field or message property to assert: subject, body, id, ...
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3662</span></td>
       <td><span class="comment code">   * @param $string
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3663</span></td>
       <td><span class="comment code">   *   String to search for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3664</span></td>
       <td><span class="comment code">   * @param $email_depth
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3665</span></td>
       <td><span class="comment code">   *   Number of emails to search for string, starting with most recent.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3666</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3667</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3668</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3669</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3670</span></td>
       <td><span class="comment code">  protected function assertMailString($field_name, $string, $email_depth) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3671</span></td>
       <td><span class="missed code">    $mails = $this-&gt;drupalGetMails();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3672</span></td>
       <td><span class="missed code">    $string_found = FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3673</span></td>
       <td><span class="missed code">    for ($i = sizeof($mails) -1; $i &gt;= sizeof($mails) - $email_depth &amp;&amp; $i &gt;= 0; $i--) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3674</span></td>
       <td><span class="missed code">      $mail = $mails[$i];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3675</span></td>
       <td><span class="comment code">      // Normalize whitespace, as we don't know what the mail system might have
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3676</span></td>
       <td><span class="comment code">      // done. Any run of whitespace becomes a single space.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3677</span></td>
       <td><span class="missed code">      $normalized_mail = preg_replace('/\s+/', ' ', $mail[$field_name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3678</span></td>
       <td><span class="missed code">      $normalized_string = preg_replace('/\s+/', ' ', $string);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3679</span></td>
       <td><span class="missed code">      $string_found = (FALSE !== strpos($normalized_mail, $normalized_string));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3680</span></td>
       <td><span class="missed code">      if ($string_found) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3681</span></td>
       <td><span class="missed code">        break;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3682</span></td>
       <td><span class="dead code">      }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3683</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3684</span></td>
       <td><span class="missed code">    return $this-&gt;assertTrue($string_found, t('Expected text found in @field of email message: &quot;@expected&quot;.', array('@field' =&gt; $field_name, '@expected' =&gt; $string)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3685</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3686</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3687</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3688</span></td>
       <td><span class="comment code">   * Asserts that the most recently sent e-mail message has the pattern in it.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3689</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3690</span></td>
       <td><span class="comment code">   * @param $field_name
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3691</span></td>
       <td><span class="comment code">   *   Name of field or message property to assert: subject, body, id, ...
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3692</span></td>
       <td><span class="comment code">   * @param $regex
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3693</span></td>
       <td><span class="comment code">   *   Pattern to search for.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3694</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3695</span></td>
       <td><span class="comment code">   * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3696</span></td>
       <td><span class="comment code">   *   TRUE on pass, FALSE on fail.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3697</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3698</span></td>
       <td><span class="comment code">  protected function assertMailPattern($field_name, $regex, $message) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3699</span></td>
       <td><span class="missed code">    $mails = $this-&gt;drupalGetMails();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3700</span></td>
       <td><span class="missed code">    $mail = end($mails);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3701</span></td>
       <td><span class="missed code">    $regex_found = preg_match(&quot;/$regex/&quot;, $mail[$field_name]);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3702</span></td>
       <td><span class="missed code">    return $this-&gt;assertTrue($regex_found, t('Expected text found in @field of email message: &quot;@expected&quot;.', array('@field' =&gt; $field_name, '@expected' =&gt; $regex)));
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3703</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3704</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3705</span></td>
       <td><span class="comment code">  /**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3706</span></td>
       <td><span class="comment code">   * Outputs to verbose the most recent $count emails sent.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3707</span></td>
       <td><span class="comment code">   *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3708</span></td>
       <td><span class="comment code">   * @param $count
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3709</span></td>
       <td><span class="comment code">   *   Optional number of emails to output.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3710</span></td>
       <td><span class="comment code">   */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3711</span></td>
       <td><span class="comment code">  protected function verboseEmail($count = 1) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3712</span></td>
       <td><span class="missed code">    $mails = $this-&gt;drupalGetMails();
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3713</span></td>
       <td><span class="missed code">    for ($i = sizeof($mails) -1; $i &gt;= sizeof($mails) - $count &amp;&amp; $i &gt;= 0; $i--) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3714</span></td>
       <td><span class="missed code">      $mail = $mails[$i];
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3715</span></td>
       <td><span class="missed code">      $this-&gt;verbose(t('Email:') . '&lt;pre&gt;' . print_r($mail, TRUE) . '&lt;/pre&gt;');
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3716</span></td>
       <td><span class="missed code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3717</span></td>
       <td><span class="missed code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3718</span></td>
       <td><span class="comment code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3719</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3720</span></td>
       <td><span class="comment code">/**
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3721</span></td>
       <td><span class="comment code"> * Logs verbose message in a text file.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3722</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3723</span></td>
       <td><span class="comment code"> * If verbose mode is enabled then page requests will be dumped to a file and
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3724</span></td>
       <td><span class="comment code"> * presented on the test result screen. The messages will be placed in a file
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3725</span></td>
       <td><span class="comment code"> * located in the simpletest directory in the original file system.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3726</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3727</span></td>
       <td><span class="comment code"> * @param $message
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3728</span></td>
       <td><span class="comment code"> *   The verbose message to be stored.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3729</span></td>
       <td><span class="comment code"> * @param $original_file_directory
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3730</span></td>
       <td><span class="comment code"> *   The original file directory, before it was changed for testing purposes.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3731</span></td>
       <td><span class="comment code"> * @param $test_class
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3732</span></td>
       <td><span class="comment code"> *   The active test case class.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3733</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3734</span></td>
       <td><span class="comment code"> * @return
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3735</span></td>
       <td><span class="comment code"> *   The ID of the message to be placed in related assertion messages.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3736</span></td>
       <td><span class="comment code"> *
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3737</span></td>
       <td><span class="comment code"> * @see DrupalTestCase-&gt;originalFileDirectory
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3738</span></td>
       <td><span class="comment code"> * @see DrupalWebTestCase-&gt;verbose()
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3739</span></td>
       <td><span class="comment code"> */
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3740</span></td>
       <td><span class="covered code">function simpletest_verbose($message, $original_file_directory = NULL, $test_class = NULL) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3741</span></td>
       <td><span class="covered code">  static $file_directory = NULL, $class = NULL, $id = 1, $verbose = NULL;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3742</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3743</span></td>
       <td><span class="comment code">  // Will pass first time during setup phase, and when verbose is TRUE.
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3744</span></td>
       <td><span class="covered code">  if (!isset($original_file_directory) &amp;&amp; !$verbose) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3745</span></td>
       <td><span class="missed code">    return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3746</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3747</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3748</span></td>
       <td><span class="covered code">  if ($message &amp;&amp; $file_directory) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3749</span></td>
       <td><span class="covered code">    $message = '&lt;hr /&gt;ID #' . $id . ' (&lt;a href=&quot;' . $class . '-' . ($id - 1) . '.html&quot;&gt;Previous&lt;/a&gt; | &lt;a href=&quot;' . $class . '-' . ($id + 1) . '.html&quot;&gt;Next&lt;/a&gt;)&lt;hr /&gt;' . $message;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3750</span></td>
       <td><span class="covered code">    file_put_contents($file_directory . &quot;/simpletest/verbose/$class-$id.html&quot;, $message, FILE_APPEND);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3751</span></td>
       <td><span class="covered code">    return $id++;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3752</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3753</span></td>
       <td><span class="comment code">
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3754</span></td>
       <td><span class="covered code">  if ($original_file_directory) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3755</span></td>
       <td><span class="covered code">    $file_directory = $original_file_directory;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3756</span></td>
       <td><span class="covered code">    $class = $test_class;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3757</span></td>
       <td><span class="covered code">    $verbose = variable_get('simpletest_verbose', TRUE);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3758</span></td>
       <td><span class="covered code">    $directory = $file_directory . '/simpletest/verbose';
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3759</span></td>
       <td><span class="covered code">    $writable = file_prepare_directory($directory, FILE_CREATE_DIRECTORY);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3760</span></td>
       <td><span class="covered code">    if ($writable &amp;&amp; !file_exists($directory . '/.htaccess')) {
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3761</span></td>
       <td><span class="covered code">      file_put_contents($directory . '/.htaccess', &quot;&lt;IfModule mod_expires.c&gt;\nExpiresActive Off\n&lt;/IfModule&gt;\n&quot;);
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3762</span></td>
       <td><span class="covered code">    }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3763</span></td>
       <td><span class="covered code">    return $writable;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3764</span></td>
       <td><span class="dead code">  }
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3765</span></td>
       <td><span class="missed code">  return FALSE;
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3766</span></td>
       <td><span class="dead code">}
</span></td>
    </tr>
    <tr>
       <td><span class="lineNo">3767</span></td>
       <td><span class="covered code"></span></td>
    </tr>
  </tbody>
</table>
<h2>Legend</h2>
<dl>
  <dt><span class="missed">Missed</span></dt>
  <dd>lines code that <strong>were not</strong> excersized during program execution.</dd>
  <dt><span class="covered">Covered</span></dt>
  <dd>lines code <strong>were</strong> excersized during program execution.</dd>
  <dt><span class="comment">Comment/non executable</span></dt>
  <dd>Comment or non-executable line of code.</dd>
  <dt><span class="dead">Dead</span></dt>
  <dd>lines of code that according to xdebug could not be executed.  This is counted as coverage code because 
  in almost all cases it is code that runnable.</dd>
</dl>
</body>
</html>
